import{w as _e,r as Tr}from"./index.02505c89.js";import{a5 as Rr,s as Ir,r as Dr,v as Lr,w as Nr,x as Ur,I as Or,_ as We,o as Br,a0 as jr,K as Mr}from"./scheduler.82920f87.js";import{S as Hr,i as Vr,a as Kr,t as qr}from"./index.5b80c364.js";const ze={};function lr(vt){return vt==="local"?localStorage:sessionStorage}function Ge(vt,_t,rt){const p=(rt==null?void 0:rt.serializer)??JSON,N=(rt==null?void 0:rt.storage)??"local";function P(l,C){lr(N).setItem(l,p.stringify(C))}if(!ze[vt]){const l=_e(_t,s=>{const u=lr(N).getItem(vt);u&&s(p.parse(u));{const o=d=>{d.key===vt&&s(d.newValue?p.parse(d.newValue):null)};return window.addEventListener("storage",o),()=>window.removeEventListener("storage",o)}}),{subscribe:C,set:m}=l;ze[vt]={set(s){P(vt,s),m(s)},update(s){const u=s(Rr(l));P(vt,u),m(u)},subscribe:C}}return ze[vt]}Ge("modeOsPrefers",!1);Ge("modeUserPrefers",void 0);Ge("modeCurrent",!1);const pr="(prefers-reduced-motion: reduce)";function Jr(){return window.matchMedia(pr).matches}const un=Tr(Jr(),vt=>{{const _t=p=>{vt(p.matches)},rt=window.matchMedia(pr);return rt.addEventListener("change",_t),()=>{rt.removeEventListener("change",_t)}}});var Wr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zr(vt){return vt&&vt.__esModule&&Object.prototype.hasOwnProperty.call(vt,"default")?vt.default:vt}var vr={exports:{}};(function(vt,_t){(function(p,N){vt.exports=N()})(Wr,function(){return function(rt){var p={};function N(P){if(p[P])return p[P].exports;var l=p[P]={i:P,l:!1,exports:{}};return rt[P].call(l.exports,l,l.exports,N),l.l=!0,l.exports}return N.m=rt,N.c=p,N.d=function(P,l,C){N.o(P,l)||Object.defineProperty(P,l,{enumerable:!0,get:C})},N.r=function(P){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(P,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(P,"__esModule",{value:!0})},N.t=function(P,l){if(1&l&&(P=N(P)),8&l||4&l&&typeof P=="object"&&P&&P.__esModule)return P;var C=Object.create(null);if(N.r(C),Object.defineProperty(C,"default",{enumerable:!0,value:P}),2&l&&typeof P!="string")for(var m in P)N.d(C,m,(function(s){return P[s]}).bind(null,m));return C},N.n=function(P){var l=P&&P.__esModule?function(){return P.default}:function(){return P};return N.d(l,"a",l),l},N.o=function(P,l){return Object.prototype.hasOwnProperty.call(P,l)},N.p="",N(N.s=22)}([function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0});var P=function(){function s(u,o){for(var d=0;d<o.length;d++){var T=o[d];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(u,T.key,T)}}return function(u,o,d){return o&&s(u.prototype,o),d&&s(u,d),u}}(),l={debug:function(){},info:function(){},warn:function(){},error:function(){}},C=void 0,m=void 0;(p.Log=function(){function s(){(function(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")})(this,s)}return s.reset=function(){m=3,C=l},s.debug=function(){if(m>=4){for(var o=arguments.length,d=Array(o),T=0;T<o;T++)d[T]=arguments[T];C.debug.apply(C,Array.from(d))}},s.info=function(){if(m>=3){for(var o=arguments.length,d=Array(o),T=0;T<o;T++)d[T]=arguments[T];C.info.apply(C,Array.from(d))}},s.warn=function(){if(m>=2){for(var o=arguments.length,d=Array(o),T=0;T<o;T++)d[T]=arguments[T];C.warn.apply(C,Array.from(d))}},s.error=function(){if(m>=1){for(var o=arguments.length,d=Array(o),T=0;T<o;T++)d[T]=arguments[T];C.error.apply(C,Array.from(d))}},P(s,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return m},set:function(o){if(!(0<=o&&o<=4))throw new Error("Invalid log level");m=o}},{key:"logger",get:function(){return C},set:function(o){if(!o.debug&&o.info&&(o.debug=o.info),!(o.debug&&o.info&&o.warn&&o.error))throw new Error("Invalid logger");C=o}}]),s}()).reset()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0});var P=function(){function s(u,o){for(var d=0;d<o.length;d++){var T=o[d];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(u,T.key,T)}}return function(u,o,d){return o&&s(u.prototype,o),d&&s(u,d),u}}(),l={setInterval:function(s){function u(o,d){return s.apply(this,arguments)}return u.toString=function(){return s.toString()},u}(function(s,u){return setInterval(s,u)}),clearInterval:function(s){function u(o){return s.apply(this,arguments)}return u.toString=function(){return s.toString()},u}(function(s){return clearInterval(s)})},C=!1,m=null;p.Global=function(){function s(){(function(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")})(this,s)}return s._testing=function(){C=!0},s.setXMLHttpRequest=function(o){m=o},P(s,null,[{key:"location",get:function(){if(!C)return location}},{key:"localStorage",get:function(){if(!C&&typeof window<"u")return localStorage}},{key:"sessionStorage",get:function(){if(!C&&typeof window<"u")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!C&&typeof window<"u")return m||XMLHttpRequest}},{key:"timer",get:function(){if(!C)return l}}]),s}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.MetadataService=void 0;var P=function(){function u(o,d){for(var T=0;T<d.length;T++){var w=d[T];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(o,w.key,w)}}return function(o,d,T){return d&&u(o.prototype,d),T&&u(o,T),o}}(),l=N(0),C=N(7);function m(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")}var s=".well-known/openid-configuration";p.MetadataService=function(){function u(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.JsonService;if(m(this,u),!o)throw l.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=o,this._jsonService=new d(["application/jwk-set+json"])}return u.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},u.prototype.getMetadata=function(){var d=this;return this._settings.metadata?(l.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(l.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(T){l.Log.debug("MetadataService.getMetadata: json received");var w=d._settings.metadataSeed||{};return d._settings.metadata=Object.assign({},w,T),d._settings.metadata})):(l.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},u.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},u.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},u.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},u.prototype.getTokenEndpoint=function(){var d=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",d)},u.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},u.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},u.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},u.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},u.prototype._getMetadataProperty=function(d){var T=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return l.Log.debug("MetadataService.getMetadataProperty for: "+d),this.getMetadata().then(function(w){if(l.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),w[d]===void 0){if(T===!0)return void l.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+d);throw l.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+d),new Error("Metadata does not contain property "+d)}return w[d]})},u.prototype.getSigningKeys=function(){var d=this;return this._settings.signingKeys?(l.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(T){return l.Log.debug("MetadataService.getSigningKeys: jwks_uri received",T),d._jsonService.getJson(T).then(function(w){if(l.Log.debug("MetadataService.getSigningKeys: key set received",w),!w.keys)throw l.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return d._settings.signingKeys=w.keys,d._settings.signingKeys})})},P(u,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(s)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=s))),this._metadataUrl}}]),u}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.UrlUtility=void 0;var P=N(0),l=N(1);p.UrlUtility=function(){function C(){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,C)}return C.addQueryParam=function(s,u,o){return s.indexOf("?")<0&&(s+="?"),s[s.length-1]!=="?"&&(s+="&"),s+=encodeURIComponent(u),s+="=",s+=encodeURIComponent(o)},C.parseUrlFragment=function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.Global;typeof s!="string"&&(s=o.location.href);var d=s.lastIndexOf(u);d>=0&&(s=s.substr(d+1)),u==="?"&&(d=s.indexOf("#"))>=0&&(s=s.substr(0,d));for(var T,w={},j=/([^&=]+)=([^&]*)/g,k=0;T=j.exec(s);)if(w[decodeURIComponent(T[1])]=decodeURIComponent(T[2].replace(/\+/g," ")),k++>50)return P.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",s),{error:"Response exceeded expected number of parameters"};for(var A in w)return w;return{}},C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.JoseUtil=void 0;var P=N(26),l=function(m){return m&&m.__esModule?m:{default:m}}(N(33));p.JoseUtil=(0,l.default)({jws:P.jws,KeyUtil:P.KeyUtil,X509:P.X509,crypto:P.crypto,hextob64u:P.hextob64u,b64tohex:P.b64tohex,AllowedSigningAlgs:P.AllowedSigningAlgs})},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.OidcClientSettings=void 0;var P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},l=function(){function A(_,O){for(var z=0;z<O.length;z++){var M=O[z];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(_,M.key,M)}}return function(_,O,z){return O&&A(_.prototype,O),z&&A(_,z),_}}(),C=N(0),m=N(23),s=N(6),u=N(24),o=N(2);function d(A,_){if(!(A instanceof _))throw new TypeError("Cannot call a class as a function")}var T=".well-known/openid-configuration",w="id_token",j="openid",k="client_secret_post";p.OidcClientSettings=function(){function A(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},O=_.authority,z=_.metadataUrl,M=_.metadata,q=_.signingKeys,B=_.metadataSeed,$=_.client_id,et=_.client_secret,it=_.response_type,V=it===void 0?w:it,ut=_.scope,bt=ut===void 0?j:ut,Et=_.redirect_uri,Ht=_.post_logout_redirect_uri,kt=_.client_authentication,te=kt===void 0?k:kt,It=_.prompt,gt=_.display,dt=_.max_age,Pt=_.ui_locales,Yt=_.acr_values,qt=_.resource,Gt=_.response_mode,ee=_.filterProtocolClaims,le=ee===void 0||ee,ne=_.loadUserInfo,Bt=ne===void 0||ne,Xt=_.staleStateAge,Jt=Xt===void 0?900:Xt,U=_.clockSkew,c=U===void 0?300:U,h=_.clockService,L=h===void 0?new m.ClockService:h,K=_.userInfoJwtIssuer,J=K===void 0?"OP":K,Z=_.mergeClaims,st=Z!==void 0&&Z,lt=_.stateStore,mt=lt===void 0?new s.WebStorageStateStore:lt,pt=_.ResponseValidatorCtor,Tt=pt===void 0?u.ResponseValidator:pt,Vt=_.MetadataServiceCtor,Qt=Vt===void 0?o.MetadataService:Vt,oe=_.extraQueryParams,ht=oe===void 0?{}:oe,Ct=_.extraTokenParams,yt=Ct===void 0?{}:Ct;d(this,A),this._authority=O,this._metadataUrl=z,this._metadata=M,this._metadataSeed=B,this._signingKeys=q,this._client_id=$,this._client_secret=et,this._response_type=V,this._scope=bt,this._redirect_uri=Et,this._post_logout_redirect_uri=Ht,this._client_authentication=te,this._prompt=It,this._display=gt,this._max_age=dt,this._ui_locales=Pt,this._acr_values=Yt,this._resource=qt,this._response_mode=Gt,this._filterProtocolClaims=!!le,this._loadUserInfo=!!Bt,this._staleStateAge=Jt,this._clockSkew=c,this._clockService=L,this._userInfoJwtIssuer=J,this._mergeClaims=!!st,this._stateStore=mt,this._validator=new Tt(this),this._metadataService=new Qt(this),this._extraQueryParams=(ht===void 0?"undefined":P(ht))==="object"?ht:{},this._extraTokenParams=(yt===void 0?"undefined":P(yt))==="object"?yt:{}}return A.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},l(A,[{key:"client_id",get:function(){return this._client_id},set:function(O){if(this._client_id)throw C.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=O}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(O){if(this._authority)throw C.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=O}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(T)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=T)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(O){this._metadata=O}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(O){this._metadataSeed=O}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(O){this._signingKeys=O}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(O){(O===void 0?"undefined":P(O))==="object"?this._extraQueryParams=O:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(O){(O===void 0?"undefined":P(O))==="object"?this._extraTokenParams=O:this._extraTokenParams={}}}]),A}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.WebStorageStateStore=void 0;var P=N(0),l=N(1);function C(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")}p.WebStorageStateStore=function(){function m(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=s.prefix,o=u===void 0?"oidc.":u,d=s.store,T=d===void 0?l.Global.localStorage:d;C(this,m),this._store=T,this._prefix=o}return m.prototype.set=function(u,o){return P.Log.debug("WebStorageStateStore.set",u),u=this._prefix+u,this._store.setItem(u,o),Promise.resolve()},m.prototype.get=function(u){P.Log.debug("WebStorageStateStore.get",u),u=this._prefix+u;var o=this._store.getItem(u);return Promise.resolve(o)},m.prototype.remove=function(u){P.Log.debug("WebStorageStateStore.remove",u),u=this._prefix+u;var o=this._store.getItem(u);return this._store.removeItem(u),Promise.resolve(o)},m.prototype.getAllKeys=function(){P.Log.debug("WebStorageStateStore.getAllKeys");for(var u=[],o=0;o<this._store.length;o++){var d=this._store.key(o);d.indexOf(this._prefix)===0&&u.push(d.substr(this._prefix.length))}return Promise.resolve(u)},m}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.JsonService=void 0;var P=N(0),l=N(1);function C(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")}p.JsonService=function(){function m(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.Global.XMLHttpRequest,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;C(this,m),s&&Array.isArray(s)?this._contentTypes=s.slice():this._contentTypes=[],this._contentTypes.push("application/json"),o&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=u,this._jwtHandler=o}return m.prototype.getJson=function(u,o){var d=this;if(!u)throw P.Log.error("JsonService.getJson: No url passed"),new Error("url");return P.Log.debug("JsonService.getJson, url: ",u),new Promise(function(T,w){var j=new d._XMLHttpRequest;j.open("GET",u);var k=d._contentTypes,A=d._jwtHandler;j.onload=function(){if(P.Log.debug("JsonService.getJson: HTTP response received, status",j.status),j.status===200){var _=j.getResponseHeader("Content-Type");if(_){var O=k.find(function(z){if(_.startsWith(z))return!0});if(O=="application/jwt")return void A(j).then(T,w);if(O)try{return void T(JSON.parse(j.responseText))}catch(z){return P.Log.error("JsonService.getJson: Error parsing JSON response",z.message),void w(z)}}w(Error("Invalid response Content-Type: "+_+", from URL: "+u))}else w(Error(j.statusText+" ("+j.status+")"))},j.onerror=function(){P.Log.error("JsonService.getJson: network error"),w(Error("Network Error"))},o&&(P.Log.debug("JsonService.getJson: token passed, setting Authorization header"),j.setRequestHeader("Authorization","Bearer "+o)),j.send()})},m.prototype.postForm=function(u,o,d){var T=this;if(!u)throw P.Log.error("JsonService.postForm: No url passed"),new Error("url");return P.Log.debug("JsonService.postForm, url: ",u),new Promise(function(w,j){var k=new T._XMLHttpRequest;k.open("POST",u);var A=T._contentTypes;k.onload=function(){if(P.Log.debug("JsonService.postForm: HTTP response received, status",k.status),k.status!==200){if(k.status===400&&(q=k.getResponseHeader("Content-Type"))&&A.find(function(B){if(q.startsWith(B))return!0}))try{var M=JSON.parse(k.responseText);if(M&&M.error)return P.Log.error("JsonService.postForm: Error from server: ",M.error),void j(new Error(M.error))}catch(B){return P.Log.error("JsonService.postForm: Error parsing JSON response",B.message),void j(B)}j(Error(k.statusText+" ("+k.status+")"))}else{var q;if((q=k.getResponseHeader("Content-Type"))&&A.find(function(B){if(q.startsWith(B))return!0}))try{return void w(JSON.parse(k.responseText))}catch(B){return P.Log.error("JsonService.postForm: Error parsing JSON response",B.message),void j(B)}j(Error("Invalid response Content-Type: "+q+", from URL: "+u))}},k.onerror=function(){P.Log.error("JsonService.postForm: network error"),j(Error("Network Error"))};var _="";for(var O in o){var z=o[O];z&&(_.length>0&&(_+="&"),_+=encodeURIComponent(O),_+="=",_+=encodeURIComponent(z))}k.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d!==void 0&&k.setRequestHeader("Authorization","Basic "+btoa(d)),k.send(_)})},m}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SigninRequest=void 0;var P=N(0),l=N(3),C=N(13);p.SigninRequest=function(){function m(s){var u=s.url,o=s.client_id,d=s.redirect_uri,T=s.response_type,w=s.scope,j=s.authority,k=s.data,A=s.prompt,_=s.display,O=s.max_age,z=s.ui_locales,M=s.id_token_hint,q=s.login_hint,B=s.acr_values,$=s.resource,et=s.response_mode,it=s.request,V=s.request_uri,ut=s.extraQueryParams,bt=s.request_type,Et=s.client_secret,Ht=s.extraTokenParams,kt=s.skipUserInfo;if(function(qt,Gt){if(!(qt instanceof Gt))throw new TypeError("Cannot call a class as a function")}(this,m),!u)throw P.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!o)throw P.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!d)throw P.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!T)throw P.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!w)throw P.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!j)throw P.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var te=m.isOidc(T),It=m.isCode(T);et||(et=m.isCode(T)?"query":null),this.state=new C.SigninState({nonce:te,data:k,client_id:o,authority:j,redirect_uri:d,code_verifier:It,request_type:bt,response_mode:et,client_secret:Et,scope:w,extraTokenParams:Ht,skipUserInfo:kt}),u=l.UrlUtility.addQueryParam(u,"client_id",o),u=l.UrlUtility.addQueryParam(u,"redirect_uri",d),u=l.UrlUtility.addQueryParam(u,"response_type",T),u=l.UrlUtility.addQueryParam(u,"scope",w),u=l.UrlUtility.addQueryParam(u,"state",this.state.id),te&&(u=l.UrlUtility.addQueryParam(u,"nonce",this.state.nonce)),It&&(u=l.UrlUtility.addQueryParam(u,"code_challenge",this.state.code_challenge),u=l.UrlUtility.addQueryParam(u,"code_challenge_method","S256"));var gt={prompt:A,display:_,max_age:O,ui_locales:z,id_token_hint:M,login_hint:q,acr_values:B,resource:$,request:it,request_uri:V,response_mode:et};for(var dt in gt)gt[dt]&&(u=l.UrlUtility.addQueryParam(u,dt,gt[dt]));for(var Pt in ut)u=l.UrlUtility.addQueryParam(u,Pt,ut[Pt]);this.url=u}return m.isOidc=function(u){return!!u.split(/\s+/g).filter(function(o){return o==="id_token"})[0]},m.isOAuth=function(u){return!!u.split(/\s+/g).filter(function(o){return o==="token"})[0]},m.isCode=function(u){return!!u.split(/\s+/g).filter(function(o){return o==="code"})[0]},m}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.State=void 0;var P=function(){function s(u,o){for(var d=0;d<o.length;d++){var T=o[d];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(u,T.key,T)}}return function(u,o,d){return o&&s(u.prototype,o),d&&s(u,d),u}}(),l=N(0),C=function(u){return u&&u.__esModule?u:{default:u}}(N(14));function m(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")}p.State=function(){function s(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=u.id,d=u.data,T=u.created,w=u.request_type;m(this,s),this._id=o||(0,C.default)(),this._data=d,this._created=typeof T=="number"&&T>0?T:parseInt(Date.now()/1e3),this._request_type=w}return s.prototype.toStorageString=function(){return l.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},s.fromStorageString=function(o){return l.Log.debug("State.fromStorageString"),new s(JSON.parse(o))},s.clearStaleState=function(o,d){var T=Date.now()/1e3-d;return o.getAllKeys().then(function(w){l.Log.debug("State.clearStaleState: got keys",w);for(var j=[],k=function(z){var M=w[z];_=o.get(M).then(function(q){var B=!1;if(q)try{var $=s.fromStorageString(q);l.Log.debug("State.clearStaleState: got item from key: ",M,$.created),$.created<=T&&(B=!0)}catch(et){l.Log.error("State.clearStaleState: Error parsing state for key",M,et.message),B=!0}else l.Log.debug("State.clearStaleState: no item in storage for key: ",M),B=!0;if(B)return l.Log.debug("State.clearStaleState: removed item for key: ",M),o.remove(M)}),j.push(_)},A=0;A<w.length;A++){var _;k(A)}return l.Log.debug("State.clearStaleState: waiting on promise count:",j.length),Promise.all(j)})},P(s,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),s}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.OidcClient=void 0;var P=function(){function k(A,_){for(var O=0;O<_.length;O++){var z=_[O];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(A,z.key,z)}}return function(A,_,O){return _&&k(A.prototype,_),O&&k(A,O),A}}(),l=N(0),C=N(5),m=N(12),s=N(8),u=N(34),o=N(35),d=N(36),T=N(13),w=N(9);function j(k,A){if(!(k instanceof A))throw new TypeError("Cannot call a class as a function")}p.OidcClient=function(){function k(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};j(this,k),A instanceof C.OidcClientSettings?this._settings=A:this._settings=new C.OidcClientSettings(A)}return k.prototype.createSigninRequest=function(){var _=this,O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=O.response_type,M=O.scope,q=O.redirect_uri,B=O.data,$=O.state,et=O.prompt,it=O.display,V=O.max_age,ut=O.ui_locales,bt=O.id_token_hint,Et=O.login_hint,Ht=O.acr_values,kt=O.resource,te=O.request,It=O.request_uri,gt=O.response_mode,dt=O.extraQueryParams,Pt=O.extraTokenParams,Yt=O.request_type,qt=O.skipUserInfo,Gt=arguments[1];l.Log.debug("OidcClient.createSigninRequest");var ee=this._settings.client_id;z=z||this._settings.response_type,M=M||this._settings.scope,q=q||this._settings.redirect_uri,et=et||this._settings.prompt,it=it||this._settings.display,V=V||this._settings.max_age,ut=ut||this._settings.ui_locales,Ht=Ht||this._settings.acr_values,kt=kt||this._settings.resource,gt=gt||this._settings.response_mode,dt=dt||this._settings.extraQueryParams,Pt=Pt||this._settings.extraTokenParams;var le=this._settings.authority;return s.SigninRequest.isCode(z)&&z!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(ne){l.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",ne);var Bt=new s.SigninRequest({url:ne,client_id:ee,redirect_uri:q,response_type:z,scope:M,data:B||$,authority:le,prompt:et,display:it,max_age:V,ui_locales:ut,id_token_hint:bt,login_hint:Et,acr_values:Ht,resource:kt,request:te,request_uri:It,extraQueryParams:dt,extraTokenParams:Pt,request_type:Yt,response_mode:gt,client_secret:_._settings.client_secret,skipUserInfo:qt}),Xt=Bt.state;return(Gt=Gt||_._stateStore).set(Xt.id,Xt.toStorageString()).then(function(){return Bt})})},k.prototype.readSigninResponseState=function(_,O){var z=arguments.length>2&&arguments[2]!==void 0&&arguments[2];l.Log.debug("OidcClient.readSigninResponseState");var M=this._settings.response_mode==="query"||!this._settings.response_mode&&s.SigninRequest.isCode(this._settings.response_type),q=M?"?":"#",B=new u.SigninResponse(_,q);if(!B.state)return l.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));O=O||this._stateStore;var $=z?O.remove.bind(O):O.get.bind(O);return $(B.state).then(function(et){if(!et)throw l.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:T.SigninState.fromStorageString(et),response:B}})},k.prototype.processSigninResponse=function(_,O){var z=this;return l.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(_,O,!0).then(function(M){var q=M.state,B=M.response;return l.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),z._validator.validateSigninResponse(q,B)})},k.prototype.createSignoutRequest=function(){var _=this,O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=O.id_token_hint,M=O.data,q=O.state,B=O.post_logout_redirect_uri,$=O.extraQueryParams,et=O.request_type,it=arguments[1];return l.Log.debug("OidcClient.createSignoutRequest"),B=B||this._settings.post_logout_redirect_uri,$=$||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(V){if(!V)throw l.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");l.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",V);var ut=new o.SignoutRequest({url:V,id_token_hint:z,post_logout_redirect_uri:B,data:M||q,extraQueryParams:$,request_type:et}),bt=ut.state;return bt&&(l.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(it=it||_._stateStore).set(bt.id,bt.toStorageString())),ut})},k.prototype.readSignoutResponseState=function(_,O){var z=arguments.length>2&&arguments[2]!==void 0&&arguments[2];l.Log.debug("OidcClient.readSignoutResponseState");var M=new d.SignoutResponse(_);if(!M.state)return l.Log.debug("OidcClient.readSignoutResponseState: No state in response"),M.error?(l.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",M.error),Promise.reject(new m.ErrorResponse(M))):Promise.resolve({state:void 0,response:M});var q=M.state;O=O||this._stateStore;var B=z?O.remove.bind(O):O.get.bind(O);return B(q).then(function($){if(!$)throw l.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:w.State.fromStorageString($),response:M}})},k.prototype.processSignoutResponse=function(_,O){var z=this;return l.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(_,O,!0).then(function(M){var q=M.state,B=M.response;return q?(l.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),z._validator.validateSignoutResponse(q,B)):(l.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),B)})},k.prototype.clearStaleState=function(_){return l.Log.debug("OidcClient.clearStaleState"),_=_||this._stateStore,w.State.clearStaleState(_,this.settings.staleStateAge)},P(k,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),k}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.TokenClient=void 0;var P=N(7),l=N(2),C=N(0);function m(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")}p.TokenClient=function(){function s(u){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:P.JsonService,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService;if(m(this,s),!u)throw C.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=u,this._jsonService=new o,this._metadataService=new d(this._settings)}return s.prototype.exchangeCode=function(){var o=this,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(d=Object.assign({},d)).grant_type=d.grant_type||"authorization_code",d.client_id=d.client_id||this._settings.client_id,d.client_secret=d.client_secret||this._settings.client_secret,d.redirect_uri=d.redirect_uri||this._settings.redirect_uri;var T=void 0,w=d._client_authentication||this._settings._client_authentication;return delete d._client_authentication,d.code?d.redirect_uri?d.code_verifier?d.client_id?d.client_secret||w!="client_secret_basic"?(w=="client_secret_basic"&&(T=d.client_id+":"+d.client_secret,delete d.client_id,delete d.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(j){return C.Log.debug("TokenClient.exchangeCode: Received token endpoint"),o._jsonService.postForm(j,d,T).then(function(k){return C.Log.debug("TokenClient.exchangeCode: response received"),k})})):(C.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(C.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(C.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(C.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(C.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},s.prototype.exchangeRefreshToken=function(){var o=this,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(d=Object.assign({},d)).grant_type=d.grant_type||"refresh_token",d.client_id=d.client_id||this._settings.client_id,d.client_secret=d.client_secret||this._settings.client_secret;var T=void 0,w=d._client_authentication||this._settings._client_authentication;return delete d._client_authentication,d.refresh_token?d.client_id?(w=="client_secret_basic"&&(T=d.client_id+":"+d.client_secret,delete d.client_id,delete d.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(j){return C.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),o._jsonService.postForm(j,d,T).then(function(k){return C.Log.debug("TokenClient.exchangeRefreshToken: response received"),k})})):(C.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(C.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},s}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.ErrorResponse=void 0;var P=N(0);function l(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")}function C(m,s){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!s||typeof s!="object"&&typeof s!="function"?m:s}p.ErrorResponse=function(m){function s(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=u.error,d=u.error_description,T=u.error_uri,w=u.state,j=u.session_state;if(l(this,s),!o)throw P.Log.error("No error passed to ErrorResponse"),new Error("error");var k=C(this,m.call(this,d||o));return k.name="ErrorResponse",k.error=o,k.error_description=d,k.error_uri=T,k.state=w,k.session_state=j,k}return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);o.prototype=Object.create(d&&d.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(o,d):o.__proto__=d)}(s,m),s}(Error)},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SigninState=void 0;var P=function(){function d(T,w){for(var j=0;j<w.length;j++){var k=w[j];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(T,k.key,k)}}return function(T,w,j){return w&&d(T.prototype,w),j&&d(T,j),T}}(),l=N(0),C=N(9),m=N(4),s=function(T){return T&&T.__esModule?T:{default:T}}(N(14));function u(d,T){if(!(d instanceof T))throw new TypeError("Cannot call a class as a function")}function o(d,T){if(!d)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!T||typeof T!="object"&&typeof T!="function"?d:T}p.SigninState=function(d){function T(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=w.nonce,k=w.authority,A=w.client_id,_=w.redirect_uri,O=w.code_verifier,z=w.response_mode,M=w.client_secret,q=w.scope,B=w.extraTokenParams,$=w.skipUserInfo;u(this,T);var et=o(this,d.call(this,arguments[0]));if(j===!0?et._nonce=(0,s.default)():j&&(et._nonce=j),O===!0?et._code_verifier=(0,s.default)()+(0,s.default)()+(0,s.default)():O&&(et._code_verifier=O),et.code_verifier){var it=m.JoseUtil.hashString(et.code_verifier,"SHA256");et._code_challenge=m.JoseUtil.hexToBase64Url(it)}return et._redirect_uri=_,et._authority=k,et._client_id=A,et._response_mode=z,et._client_secret=M,et._scope=q,et._extraTokenParams=B,et._skipUserInfo=$,et}return function(j,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);j.prototype=Object.create(k&&k.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(j,k):j.__proto__=k)}(T,d),T.prototype.toStorageString=function(){return l.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},T.fromStorageString=function(j){return l.Log.debug("SigninState.fromStorageString"),new T(JSON.parse(j))},P(T,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),T}(C.State)},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.default=function(){return(P!="undefined"&&P!==null&&P.getRandomValues!==void 0?l:C)().replace(/-/g,"")};var P=typeof window<"u"?window.crypto||window.msCrypto:null;function l(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(m){return(m^P.getRandomValues(new Uint8Array(1))[0]&15>>m/4).toString(16)})}function C(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(m){return(m^16*Math.random()>>m/4).toString(16)})}rt.exports=p.default},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.User=void 0;var P=function(){function C(m,s){for(var u=0;u<s.length;u++){var o=s[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}return function(m,s,u){return s&&C(m.prototype,s),u&&C(m,u),m}}(),l=N(0);p.User=function(){function C(m){var s=m.id_token,u=m.session_state,o=m.access_token,d=m.refresh_token,T=m.token_type,w=m.scope,j=m.profile,k=m.expires_at,A=m.state;(function(O,z){if(!(O instanceof z))throw new TypeError("Cannot call a class as a function")})(this,C),this.id_token=s,this.session_state=u,this.access_token=o,this.refresh_token=d,this.token_type=T,this.scope=w,this.profile=j,this.expires_at=k,this.state=A}return C.prototype.toStorageString=function(){return l.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},C.fromStorageString=function(s){return l.Log.debug("User.fromStorageString"),new C(JSON.parse(s))},P(C,[{key:"expires_in",get:function(){if(this.expires_at){var s=parseInt(Date.now()/1e3);return this.expires_at-s}},set:function(s){var u=parseInt(s);if(typeof u=="number"&&u>0){var o=parseInt(Date.now()/1e3);this.expires_at=o+u}}},{key:"expired",get:function(){var s=this.expires_in;if(s!==void 0)return s<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.AccessTokenEvents=void 0;var P=N(0),l=N(46);function C(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")}p.AccessTokenEvents=function(){function m(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=s.accessTokenExpiringNotificationTime,o=u===void 0?60:u,d=s.accessTokenExpiringTimer,T=d===void 0?new l.Timer("Access token expiring"):d,w=s.accessTokenExpiredTimer,j=w===void 0?new l.Timer("Access token expired"):w;C(this,m),this._accessTokenExpiringNotificationTime=o,this._accessTokenExpiring=T,this._accessTokenExpired=j}return m.prototype.load=function(u){if(u.access_token&&u.expires_in!==void 0){var o=u.expires_in;if(P.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",o),o>0){var d=o-this._accessTokenExpiringNotificationTime;d<=0&&(d=1),P.Log.debug("AccessTokenEvents.load: registering expiring timer in:",d),this._accessTokenExpiring.init(d)}else P.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var T=o+1;P.Log.debug("AccessTokenEvents.load: registering expired timer in:",T),this._accessTokenExpired.init(T)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},m.prototype.unload=function(){P.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},m.prototype.addAccessTokenExpiring=function(u){this._accessTokenExpiring.addHandler(u)},m.prototype.removeAccessTokenExpiring=function(u){this._accessTokenExpiring.removeHandler(u)},m.prototype.addAccessTokenExpired=function(u){this._accessTokenExpired.addHandler(u)},m.prototype.removeAccessTokenExpired=function(u){this._accessTokenExpired.removeHandler(u)},m}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.Event=void 0;var P=N(0);p.Event=function(){function l(C){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,l),this._name=C,this._callbacks=[]}return l.prototype.addHandler=function(m){this._callbacks.push(m)},l.prototype.removeHandler=function(m){var s=this._callbacks.findIndex(function(u){return u===m});s>=0&&this._callbacks.splice(s,1)},l.prototype.raise=function(){P.Log.debug("Event: Raising event: "+this._name);for(var m=0;m<this._callbacks.length;m++){var s;(s=this._callbacks)[m].apply(s,arguments)}},l}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SessionMonitor=void 0;var P=function(){function u(o,d){for(var T=0;T<d.length;T++){var w=d[T];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(o,w.key,w)}}return function(o,d,T){return d&&u(o.prototype,d),T&&u(o,T),o}}(),l=N(0),C=N(19),m=N(1);function s(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")}p.SessionMonitor=function(){function u(o){var d=this,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.CheckSessionIFrame,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:m.Global.timer;if(s(this,u),!o)throw l.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=o,this._CheckSessionIFrameCtor=T,this._timer=w,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(j){j?d._start(j):d._settings.monitorAnonymousSession&&d._userManager.querySessionStatus().then(function(k){var A={session_state:k.session_state};k.sub&&k.sid&&(A.profile={sub:k.sub,sid:k.sid}),d._start(A)}).catch(function(k){l.Log.error("SessionMonitor ctor: error from querySessionStatus:",k.message)})}).catch(function(j){l.Log.error("SessionMonitor ctor: error from getUser:",j.message)}))}return u.prototype._start=function(d){var T=this,w=d.session_state;w&&(d.profile?(this._sub=d.profile.sub,this._sid=d.profile.sid,l.Log.debug("SessionMonitor._start: session_state:",w,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,l.Log.debug("SessionMonitor._start: session_state:",w,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(w):this._metadataService.getCheckSessionIframe().then(function(j){if(j){l.Log.debug("SessionMonitor._start: Initializing check session iframe");var k=T._client_id,A=T._checkSessionInterval,_=T._stopCheckSessionOnError;T._checkSessionIFrame=new T._CheckSessionIFrameCtor(T._callback.bind(T),k,j,A,_),T._checkSessionIFrame.load().then(function(){T._checkSessionIFrame.start(w)})}else l.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(j){l.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",j.message)}))},u.prototype._stop=function(){var d=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(l.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var T=this._timer.setInterval(function(){d._timer.clearInterval(T),d._userManager.querySessionStatus().then(function(w){var j={session_state:w.session_state};w.sub&&w.sid&&(j.profile={sub:w.sub,sid:w.sid}),d._start(j)}).catch(function(w){l.Log.error("SessionMonitor: error from querySessionStatus:",w.message)})},1e3)},u.prototype._callback=function(){var d=this;this._userManager.querySessionStatus().then(function(T){var w=!0;T?T.sub===d._sub?(w=!1,d._checkSessionIFrame.start(T.session_state),T.sid===d._sid?l.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",T.session_state):(l.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",T.session_state),d._userManager.events._raiseUserSessionChanged())):l.Log.debug("SessionMonitor._callback: Different subject signed into OP:",T.sub):l.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),w&&(d._sub?(l.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),d._userManager.events._raiseUserSignedOut()):(l.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),d._userManager.events._raiseUserSignedIn()))}).catch(function(T){d._sub&&(l.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",T.message),d._userManager.events._raiseUserSignedOut())})},P(u,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),u}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.CheckSessionIFrame=void 0;var P=N(0);function l(C,m){if(!(C instanceof m))throw new TypeError("Cannot call a class as a function")}p.CheckSessionIFrame=function(){function C(m,s,u,o){var d=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];l(this,C),this._callback=m,this._client_id=s,this._url=u,this._interval=o||2e3,this._stopOnError=d;var T=u.indexOf("/",u.indexOf("//")+2);this._frame_origin=u.substr(0,T),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=u}return C.prototype.load=function(){var s=this;return new Promise(function(u){s._frame.onload=function(){u()},window.document.body.appendChild(s._frame),s._boundMessageEvent=s._message.bind(s),window.addEventListener("message",s._boundMessageEvent,!1)})},C.prototype._message=function(s){s.origin===this._frame_origin&&s.source===this._frame.contentWindow&&(s.data==="error"?(P.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):s.data==="changed"?(P.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):P.Log.debug("CheckSessionIFrame: "+s.data+" message from check session op iframe"))},C.prototype.start=function(s){var u=this;if(this._session_state!==s){P.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=s;var o=function(){u._frame.contentWindow.postMessage(u._client_id+" "+u._session_state,u._frame_origin)};o(),this._timer=window.setInterval(o,this._interval)}},C.prototype.stop=function(){this._session_state=null,this._timer&&(P.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.TokenRevocationClient=void 0;var P=N(0),l=N(2),C=N(1);function m(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")}var s="access_token",u="refresh_token";p.TokenRevocationClient=function(){function o(d){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.Global.XMLHttpRequest,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService;if(m(this,o),!d)throw P.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=d,this._XMLHttpRequestCtor=T,this._metadataService=new w(this._settings)}return o.prototype.revoke=function(T,w){var j=this,k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!T)throw P.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(k!==s&&k!=u)throw P.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(A){if(A){P.Log.debug("TokenRevocationClient.revoke: Revoking "+k);var _=j._settings.client_id,O=j._settings.client_secret;return j._revoke(A,_,O,T,k)}if(w)throw P.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},o.prototype._revoke=function(T,w,j,k,A){var _=this;return new Promise(function(O,z){var M=new _._XMLHttpRequestCtor;M.open("POST",T),M.onload=function(){P.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",M.status),M.status===200?O():z(Error(M.statusText+" ("+M.status+")"))},M.onerror=function(){P.Log.debug("TokenRevocationClient.revoke: Network Error."),z("Network Error")};var q="client_id="+encodeURIComponent(w);j&&(q+="&client_secret="+encodeURIComponent(j)),q+="&token_type_hint="+encodeURIComponent(A),q+="&token="+encodeURIComponent(k),M.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),M.send(q)})},o}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.CordovaPopupWindow=void 0;var P=function(){function C(m,s){for(var u=0;u<s.length;u++){var o=s[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}return function(m,s,u){return s&&C(m.prototype,s),u&&C(m,u),m}}(),l=N(0);p.CordovaPopupWindow=function(){function C(m){var s=this;(function(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")})(this,C),this._promise=new Promise(function(u,o){s._resolve=u,s._reject=o}),this.features=m.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=m.popupWindowTarget||"_blank",this.redirect_uri=m.startUrl,l.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return C.prototype._isInAppBrowserInstalled=function(s){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(u){return s.hasOwnProperty(u)})},C.prototype.navigate=function(s){if(s&&s.url){if(!window.cordova)return this._error("cordova is undefined");var u=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(u)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(s.url,this.target,this.features),this._popup?(l.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},C.prototype._loadStartCallback=function(s){s.url.indexOf(this.redirect_uri)===0&&this._success({url:s.url})},C.prototype._exitCallback=function(s){this._error(s)},C.prototype._success=function(s){this._cleanup(),l.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(s)},C.prototype._error=function(s){this._cleanup(),l.Log.error(s),this._reject(new Error(s))},C.prototype.close=function(){this._cleanup()},C.prototype._cleanup=function(){this._popup&&(l.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},P(C,[{key:"promise",get:function(){return this._promise}}]),C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0});var P=N(0),l=N(10),C=N(5),m=N(6),s=N(37),u=N(38),o=N(16),d=N(2),T=N(48),w=N(49),j=N(19),k=N(20),A=N(18),_=N(1),O=N(15),z=N(50);p.default={Version:z.Version,Log:P.Log,OidcClient:l.OidcClient,OidcClientSettings:C.OidcClientSettings,WebStorageStateStore:m.WebStorageStateStore,InMemoryWebStorage:s.InMemoryWebStorage,UserManager:u.UserManager,AccessTokenEvents:o.AccessTokenEvents,MetadataService:d.MetadataService,CordovaPopupNavigator:T.CordovaPopupNavigator,CordovaIFrameNavigator:w.CordovaIFrameNavigator,CheckSessionIFrame:j.CheckSessionIFrame,TokenRevocationClient:k.TokenRevocationClient,SessionMonitor:A.SessionMonitor,Global:_.Global,User:O.User},rt.exports=p.default},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.ClockService=function(){function P(){(function(C,m){if(!(C instanceof m))throw new TypeError("Cannot call a class as a function")})(this,P)}return P.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},P}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.ResponseValidator=void 0;var P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},l=N(0),C=N(2),m=N(25),s=N(11),u=N(12),o=N(4);function d(w,j){if(!(w instanceof j))throw new TypeError("Cannot call a class as a function")}var T=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];p.ResponseValidator=function(){function w(j){var k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.MetadataService,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:m.UserInfoService,_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o.JoseUtil,O=arguments.length>4&&arguments[4]!==void 0?arguments[4]:s.TokenClient;if(d(this,w),!j)throw l.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=j,this._metadataService=new k(this._settings),this._userInfoService=new A(this._settings),this._joseUtil=_,this._tokenClient=new O(this._settings)}return w.prototype.validateSigninResponse=function(k,A){var _=this;return l.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(k,A).then(function(O){return l.Log.debug("ResponseValidator.validateSigninResponse: state processed"),_._validateTokens(k,O).then(function(z){return l.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),_._processClaims(k,z).then(function(M){return l.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),M})})})},w.prototype.validateSignoutResponse=function(k,A){return k.id!==A.state?(l.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(l.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),A.state=k.data,A.error?(l.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",A.error),Promise.reject(new u.ErrorResponse(A))):Promise.resolve(A))},w.prototype._processSigninParams=function(k,A){if(k.id!==A.state)return l.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!k.client_id)return l.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!k.authority)return l.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==k.authority)return l.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=k.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==k.client_id)return l.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=k.client_id;return l.Log.debug("ResponseValidator._processSigninParams: state validated"),A.state=k.data,A.error?(l.Log.warn("ResponseValidator._processSigninParams: Response was error",A.error),Promise.reject(new u.ErrorResponse(A))):k.nonce&&!A.id_token?(l.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!k.nonce&&A.id_token?(l.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):k.code_verifier&&!A.code?(l.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!k.code_verifier&&A.code?(l.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(A.scope||(A.scope=k.scope),Promise.resolve(A))},w.prototype._processClaims=function(k,A){var _=this;if(A.isOpenIdConnect){if(l.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),A.profile=this._filterProtocolClaims(A.profile),k.skipUserInfo!==!0&&this._settings.loadUserInfo&&A.access_token)return l.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(A.access_token).then(function(O){return l.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),O.sub!==A.profile.sub?(l.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(A.profile=_._mergeClaims(A.profile,O),l.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",A.profile),A)});l.Log.debug("ResponseValidator._processClaims: not loading user info")}else l.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(A)},w.prototype._mergeClaims=function(k,A){var _=Object.assign({},k);for(var O in A){var z=A[O];Array.isArray(z)||(z=[z]);for(var M=0;M<z.length;M++){var q=z[M];_[O]?Array.isArray(_[O])?_[O].indexOf(q)<0&&_[O].push(q):_[O]!==q&&((q===void 0?"undefined":P(q))==="object"&&this._settings.mergeClaims?_[O]=this._mergeClaims(_[O],q):_[O]=[_[O],q]):_[O]=q}}return _},w.prototype._filterProtocolClaims=function(k){l.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",k);var A=Object.assign({},k);return this._settings._filterProtocolClaims?(T.forEach(function(_){delete A[_]}),l.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",A)):l.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),A},w.prototype._validateTokens=function(k,A){return A.code?(l.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(k,A)):A.id_token?A.access_token?(l.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(k,A)):(l.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(k,A)):(l.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(A))},w.prototype._processCode=function(k,A){var _=this,O={client_id:k.client_id,client_secret:k.client_secret,code:A.code,redirect_uri:k.redirect_uri,code_verifier:k.code_verifier};return k.extraTokenParams&&P(k.extraTokenParams)==="object"&&Object.assign(O,k.extraTokenParams),this._tokenClient.exchangeCode(O).then(function(z){for(var M in z)A[M]=z[M];return A.id_token?(l.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),_._validateIdTokenAttributes(k,A)):(l.Log.debug("ResponseValidator._processCode: token response successful, returning response"),A)})},w.prototype._validateIdTokenAttributes=function(k,A){var _=this;return this._metadataService.getIssuer().then(function(O){var z=k.client_id,M=_._settings.clockSkew;return l.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",M),_._settings.getEpochTime().then(function(q){return _._joseUtil.validateJwtAttributes(A.id_token,O,z,M,q).then(function(B){return k.nonce&&k.nonce!==B.nonce?(l.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):B.sub?(A.profile=B,A):(l.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},w.prototype._validateIdTokenAndAccessToken=function(k,A){var _=this;return this._validateIdToken(k,A).then(function(O){return _._validateAccessToken(O)})},w.prototype._getSigningKeyForJwt=function(k){var A=this;return this._metadataService.getSigningKeys().then(function(_){var O=k.header.kid;if(!_)return l.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));l.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var z=void 0;if(O)z=_.filter(function(M){return M.kid===O})[0];else{if((_=A._filterByAlg(_,k.header.alg)).length>1)return l.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));z=_[0]}return Promise.resolve(z)})},w.prototype._getSigningKeyForJwtWithSingleRetry=function(k){var A=this;return this._getSigningKeyForJwt(k).then(function(_){return _?Promise.resolve(_):(A._metadataService.resetSigningKeys(),A._getSigningKeyForJwt(k))})},w.prototype._validateIdToken=function(k,A){var _=this;if(!k.nonce)return l.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var O=this._joseUtil.parseJwt(A.id_token);return O&&O.header&&O.payload?k.nonce!==O.payload.nonce?(l.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(z){return l.Log.debug("ResponseValidator._validateIdToken: Received issuer"),_._getSigningKeyForJwtWithSingleRetry(O).then(function(M){if(!M)return l.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var q=k.client_id,B=_._settings.clockSkew;return l.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",B),_._joseUtil.validateJwt(A.id_token,M,z,q,B).then(function(){return l.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),O.payload.sub?(A.profile=O.payload,A):(l.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(l.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",O),Promise.reject(new Error("Failed to parse id_token")))},w.prototype._filterByAlg=function(k,A){var _=null;if(A.startsWith("RS"))_="RSA";else if(A.startsWith("PS"))_="PS";else{if(!A.startsWith("ES"))return l.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",A),[];_="EC"}return l.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",_),k=k.filter(function(O){return O.kty===_}),l.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",_,k.length),k},w.prototype._validateAccessToken=function(k){if(!k.profile)return l.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!k.profile.at_hash)return l.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!k.id_token)return l.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var A=this._joseUtil.parseJwt(k.id_token);if(!A||!A.header)return l.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",A),Promise.reject(new Error("Failed to parse id_token"));var _=A.header.alg;if(!_||_.length!==5)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",_),Promise.reject(new Error("Unsupported alg: "+_));var O=_.substr(2,3);if(!O)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",_,O),Promise.reject(new Error("Unsupported alg: "+_));if((O=parseInt(O))!==256&&O!==384&&O!==512)return l.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",_,O),Promise.reject(new Error("Unsupported alg: "+_));var z="sha"+O,M=this._joseUtil.hashString(k.access_token,z);if(!M)return l.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",z),Promise.reject(new Error("Failed to validate at_hash"));var q=M.substr(0,M.length/2),B=this._joseUtil.hexToBase64Url(q);return B!==k.profile.at_hash?(l.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",B,k.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(l.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(k))},w}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.UserInfoService=void 0;var P=N(7),l=N(2),C=N(0),m=N(4);function s(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")}p.UserInfoService=function(){function u(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:P.JsonService,T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:l.MetadataService,w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:m.JoseUtil;if(s(this,u),!o)throw C.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=o,this._jsonService=new d(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new T(this._settings),this._joseUtil=w}return u.prototype.getClaims=function(d){var T=this;return d?this._metadataService.getUserInfoEndpoint().then(function(w){return C.Log.debug("UserInfoService.getClaims: received userinfo url",w),T._jsonService.getJson(w,d).then(function(j){return C.Log.debug("UserInfoService.getClaims: claims received",j),j})}):(C.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},u.prototype._getClaimsFromJwt=function(d){var T=this;try{var w=this._joseUtil.parseJwt(d.responseText);if(!w||!w.header||!w.payload)return C.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",w),Promise.reject(new Error("Failed to parse id_token"));var j=w.header.kid,k=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":k=this._metadataService.getIssuer();break;case"ANY":k=Promise.resolve(w.payload.iss);break;default:k=Promise.resolve(this._settings.userInfoJwtIssuer)}return k.then(function(A){return C.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+A),T._metadataService.getSigningKeys().then(function(_){if(!_)return C.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));C.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var O=void 0;if(j)O=_.filter(function(q){return q.kid===j})[0];else{if((_=T._filterByAlg(_,w.header.alg)).length>1)return C.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));O=_[0]}if(!O)return C.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var z=T._settings.client_id,M=T._settings.clockSkew;return C.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",M),T._joseUtil.validateJwt(d.responseText,O,A,z,M,void 0,!0).then(function(){return C.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),w.payload})})})}catch(A){return C.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",A.message),void reject(A)}},u.prototype._filterByAlg=function(d,T){var w=null;if(T.startsWith("RS"))w="RSA";else if(T.startsWith("PS"))w="PS";else{if(!T.startsWith("ES"))return C.Log.debug("UserInfoService._filterByAlg: alg not supported: ",T),[];w="EC"}return C.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",w),d=d.filter(function(j){return j.kty===w}),C.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",w,d.length),d},u}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.AllowedSigningAlgs=p.b64tohex=p.hextob64u=p.crypto=p.X509=p.KeyUtil=p.jws=void 0;var P=N(27);p.jws=P.jws,p.KeyUtil=P.KEYUTIL,p.X509=P.X509,p.crypto=P.crypto,p.hextob64u=P.hextob64u,p.b64tohex=P.b64tohex,p.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(rt,p,N){(function(P){Object.defineProperty(p,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C={userAgent:!1},m={};/*!
Copyright (c) 2011, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.9.0
*/if(s===void 0)var s={};s.lang={extend:function(t,r,n){if(!r||!t)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var i=function(){};if(i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=r.prototype,r.prototype.constructor==Object.prototype.constructor&&(r.prototype.constructor=r),n){var a;for(a in n)t.prototype[a]=n[a];var f=function(){},b=["toString","valueOf"];try{/MSIE/.test(C.userAgent)&&(f=function(S,F){for(a=0;a<b.length;a+=1){var x=b[a],I=F[x];typeof I=="function"&&I!=Object.prototype[x]&&(S[x]=I)}})}catch{}f(t.prototype,n)}}};/*! CryptoJS v3.1.2 core-fix.js
 * code.google.com/p/crypto-js
 * (c) 2009-2013 by Jeff Mott. All rights reserved.
 * code.google.com/p/crypto-js/wiki/License
 * THIS IS FIX of 'core.js' to fix Hmac issue.
 * https://code.google.com/p/crypto-js/issues/detail?id=84
 * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
 */var u,o,d,T,w,j,k,A,_,O,z,M=M||(u=Math,d=(o={}).lib={},T=d.Base=function(){function e(){}return{extend:function(r){e.prototype=this;var n=new e;return r&&n.mixIn(r),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),w=d.WordArray=T.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r??4*t.length},toString:function(t){return(t||k).stringify(this)},concat:function(t){var r=this.words,n=t.words,i=this.sigBytes,a=t.sigBytes;if(this.clamp(),i%4)for(var f=0;f<a;f++){var b=n[f>>>2]>>>24-f%4*8&255;r[i+f>>>2]|=b<<24-(i+f)%4*8}else for(f=0;f<a;f+=4)r[i+f>>>2]=n[f>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=u.ceil(r/4)},clone:function(){var t=T.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*u.random()|0);return new w.init(r,t)}}),j=o.enc={},k=j.Hex={stringify:function(t){for(var r=t.words,n=t.sigBytes,i=[],a=0;a<n;a++){var f=r[a>>>2]>>>24-a%4*8&255;i.push((f>>>4).toString(16)),i.push((15&f).toString(16))}return i.join("")},parse:function(t){for(var r=t.length,n=[],i=0;i<r;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new w.init(n,r/2)}},A=j.Latin1={stringify:function(t){for(var r=t.words,n=t.sigBytes,i=[],a=0;a<n;a++){var f=r[a>>>2]>>>24-a%4*8&255;i.push(String.fromCharCode(f))}return i.join("")},parse:function(t){for(var r=t.length,n=[],i=0;i<r;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new w.init(n,r)}},_=j.Utf8={stringify:function(t){try{return decodeURIComponent(escape(A.stringify(t)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(t){return A.parse(unescape(encodeURIComponent(t)))}},O=d.BufferedBlockAlgorithm=T.extend({reset:function(){this._data=new w.init,this._nDataBytes=0},_append:function(t){typeof t=="string"&&(t=_.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,f=i/(4*a),b=(f=t?u.ceil(f):u.max((0|f)-this._minBufferSize,0))*a,y=u.min(4*b,i);if(b){for(var S=0;S<b;S+=a)this._doProcessBlock(n,S);var F=n.splice(0,b);r.sigBytes-=y}return new w.init(F,y)},clone:function(){var t=T.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d.Hasher=O.extend({cfg:T.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){O.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(r,n){return new t.init(n).finalize(r)}},_createHmacHelper:function(t){return function(r,n){return new z.HMAC.init(t,n).finalize(r)}}}),z=o.algo={},o);(function(e){var t,r=(t=M).lib,n=r.Base,i=r.WordArray;(t=t.x64={}).Word=n.extend({init:function(f,b){this.high=f,this.low=b}}),t.WordArray=n.extend({init:function(f,b){f=this.words=f||[],this.sigBytes=b??8*f.length},toX32:function(){for(var f=this.words,b=f.length,y=[],S=0;S<b;S++){var F=f[S];y.push(F.high),y.push(F.low)}return i.create(y,this.sigBytes)},clone:function(){for(var f=n.clone.call(this),b=f.words=this.words.slice(0),y=b.length,S=0;S<y;S++)b[S]=b[S].clone();return f}})})(),function(){var e=M,t=e.lib.WordArray;e.enc.Base64={stringify:function(n){var i=n.words,a=n.sigBytes,f=this._map;n.clamp(),n=[];for(var b=0;b<a;b+=3)for(var y=(i[b>>>2]>>>24-b%4*8&255)<<16|(i[b+1>>>2]>>>24-(b+1)%4*8&255)<<8|i[b+2>>>2]>>>24-(b+2)%4*8&255,S=0;4>S&&b+.75*S<a;S++)n.push(f.charAt(y>>>6*(3-S)&63));if(i=f.charAt(64))for(;n.length%4;)n.push(i);return n.join("")},parse:function(n){var i=n.length,a=this._map;(f=a.charAt(64))&&(f=n.indexOf(f))!=-1&&(i=f);for(var f=[],b=0,y=0;y<i;y++)if(y%4){var S=a.indexOf(n.charAt(y-1))<<y%4*2,F=a.indexOf(n.charAt(y))>>>6-y%4*2;f[b>>>2]|=(S|F)<<24-b%4*8,b++}return t.create(f,b)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){for(var t=M,r=(i=t.lib).WordArray,n=i.Hasher,i=t.algo,a=[],f=[],b=function(G){return 4294967296*(G-(0|G))|0},y=2,S=0;64>S;){var F;t:{F=y;for(var x=e.sqrt(F),I=2;I<=x;I++)if(!(F%I)){F=!1;break t}F=!0}F&&(8>S&&(a[S]=b(e.pow(y,.5))),f[S]=b(e.pow(y,1/3)),S++),y++}var H=[];i=i.SHA256=n.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(G,X){for(var g=this._hash.words,E=g[0],R=g[1],D=g[2],Y=g[3],Q=g[4],at=g[5],tt=g[6],ft=g[7],ot=0;64>ot;ot++){if(16>ot)H[ot]=0|G[X+ot];else{var ct=H[ot-15],St=H[ot-2];H[ot]=((ct<<25|ct>>>7)^(ct<<14|ct>>>18)^ct>>>3)+H[ot-7]+((St<<15|St>>>17)^(St<<13|St>>>19)^St>>>10)+H[ot-16]}ct=ft+((Q<<26|Q>>>6)^(Q<<21|Q>>>11)^(Q<<7|Q>>>25))+(Q&at^~Q&tt)+f[ot]+H[ot],St=((E<<30|E>>>2)^(E<<19|E>>>13)^(E<<10|E>>>22))+(E&R^E&D^R&D),ft=tt,tt=at,at=Q,Q=Y+ct|0,Y=D,D=R,R=E,E=ct+St|0}g[0]=g[0]+E|0,g[1]=g[1]+R|0,g[2]=g[2]+D|0,g[3]=g[3]+Y|0,g[4]=g[4]+Q|0,g[5]=g[5]+at|0,g[6]=g[6]+tt|0,g[7]=g[7]+ft|0},_doFinalize:function(){var G=this._data,X=G.words,g=8*this._nDataBytes,E=8*G.sigBytes;return X[E>>>5]|=128<<24-E%32,X[14+(E+64>>>9<<4)]=e.floor(g/4294967296),X[15+(E+64>>>9<<4)]=g,G.sigBytes=4*X.length,this._process(),this._hash},clone:function(){var G=n.clone.call(this);return G._hash=this._hash.clone(),G}}),t.SHA256=n._createHelper(i),t.HmacSHA256=n._createHmacHelper(i)}(Math),function(){function e(){return n.create.apply(n,arguments)}for(var t=M,r=t.lib.Hasher,n=(a=t.x64).Word,i=a.WordArray,a=t.algo,f=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],b=[],y=0;80>y;y++)b[y]=e();a=a.SHA512=r.extend({_doReset:function(){this._hash=new i.init([new n.init(1779033703,4089235720),new n.init(3144134277,2227873595),new n.init(1013904242,4271175723),new n.init(2773480762,1595750129),new n.init(1359893119,2917565137),new n.init(2600822924,725511199),new n.init(528734635,4215389547),new n.init(1541459225,327033209)])},_doProcessBlock:function(F,x){for(var I=(R=this._hash.words)[0],H=R[1],W=R[2],G=R[3],X=R[4],g=R[5],E=R[6],R=R[7],D=I.high,Y=I.low,Q=H.high,at=H.low,tt=W.high,ft=W.low,ot=G.high,ct=G.low,St=X.high,xt=X.low,Ft=g.high,$t=g.low,Kt=E.high,Wt=E.low,Rt=R.high,Ut=R.low,Mt=D,zt=Y,xe=Q,Se=at,Ae=tt,be=ft,Ke=ot,ke=ct,ae=St,ie=xt,Ue=Ft,Pe=$t,Oe=Kt,Ce=Wt,qe=Rt,Te=Ut,ue=0;80>ue;ue++){var ve=b[ue];if(16>ue)var ge=ve.high=0|F[x+2*ue],At=ve.low=0|F[x+2*ue+1];else{ge=((At=(ge=b[ue-15]).high)>>>1|(de=ge.low)<<31)^(At>>>8|de<<24)^At>>>7;var de=(de>>>1|At<<31)^(de>>>8|At<<24)^(de>>>7|At<<25),we=((At=(we=b[ue-2]).high)>>>19|(Ot=we.low)<<13)^(At<<3|Ot>>>29)^At>>>6,Ot=(Ot>>>19|At<<13)^(Ot<<3|At>>>29)^(Ot>>>6|At<<26),Je=(At=b[ue-7]).high,ye=(me=b[ue-16]).high,me=me.low;ge=(ge=(ge=ge+Je+((At=de+At.low)>>>0<de>>>0?1:0))+we+((At=At+Ot)>>>0<Ot>>>0?1:0))+ye+((At=At+me)>>>0<me>>>0?1:0),ve.high=ge,ve.low=At}Je=ae&Ue^~ae&Oe,me=ie&Pe^~ie&Ce,ve=Mt&xe^Mt&Ae^xe&Ae;var Pr=zt&Se^zt&be^Se&be,Cr=(de=(Mt>>>28|zt<<4)^(Mt<<30|zt>>>2)^(Mt<<25|zt>>>7),we=(zt>>>28|Mt<<4)^(zt<<30|Mt>>>2)^(zt<<25|Mt>>>7),(Ot=f[ue]).high),hr=Ot.low;ye=qe+((ae>>>14|ie<<18)^(ae>>>18|ie<<14)^(ae<<23|ie>>>9))+((Ot=Te+((ie>>>14|ae<<18)^(ie>>>18|ae<<14)^(ie<<23|ae>>>9)))>>>0<Te>>>0?1:0),qe=Oe,Te=Ce,Oe=Ue,Ce=Pe,Ue=ae,Pe=ie,ae=Ke+(ye=(ye=(ye=ye+Je+((Ot=Ot+me)>>>0<me>>>0?1:0))+Cr+((Ot=Ot+hr)>>>0<hr>>>0?1:0))+ge+((Ot=Ot+At)>>>0<At>>>0?1:0))+((ie=ke+Ot|0)>>>0<ke>>>0?1:0)|0,Ke=Ae,ke=be,Ae=xe,be=Se,xe=Mt,Se=zt,Mt=ye+(ve=de+ve+((At=we+Pr)>>>0<we>>>0?1:0))+((zt=Ot+At|0)>>>0<Ot>>>0?1:0)|0}Y=I.low=Y+zt,I.high=D+Mt+(Y>>>0<zt>>>0?1:0),at=H.low=at+Se,H.high=Q+xe+(at>>>0<Se>>>0?1:0),ft=W.low=ft+be,W.high=tt+Ae+(ft>>>0<be>>>0?1:0),ct=G.low=ct+ke,G.high=ot+Ke+(ct>>>0<ke>>>0?1:0),xt=X.low=xt+ie,X.high=St+ae+(xt>>>0<ie>>>0?1:0),$t=g.low=$t+Pe,g.high=Ft+Ue+($t>>>0<Pe>>>0?1:0),Wt=E.low=Wt+Ce,E.high=Kt+Oe+(Wt>>>0<Ce>>>0?1:0),Ut=R.low=Ut+Te,R.high=Rt+qe+(Ut>>>0<Te>>>0?1:0)},_doFinalize:function(){var F=this._data,x=F.words,I=8*this._nDataBytes,H=8*F.sigBytes;return x[H>>>5]|=128<<24-H%32,x[30+(H+128>>>10<<5)]=Math.floor(I/4294967296),x[31+(H+128>>>10<<5)]=I,F.sigBytes=4*x.length,this._process(),this._hash.toX32()},clone:function(){var F=r.clone.call(this);return F._hash=this._hash.clone(),F},blockSize:32}),t.SHA512=r._createHelper(a),t.HmacSHA512=r._createHmacHelper(a)}(),function(){var e=M,t=(i=e.x64).Word,r=i.WordArray,n=(i=e.algo).SHA512,i=i.SHA384=n.extend({_doReset:function(){this._hash=new r.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var f=n._doFinalize.call(this);return f.sigBytes-=16,f}});e.SHA384=n._createHelper(i),e.HmacSHA384=n._createHmacHelper(i)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var q,B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function $(e){var t,r,n="";for(t=0;t+3<=e.length;t+=3)r=parseInt(e.substring(t,t+3),16),n+=B.charAt(r>>6)+B.charAt(63&r);for(t+1==e.length?(r=parseInt(e.substring(t,t+1),16),n+=B.charAt(r<<2)):t+2==e.length&&(r=parseInt(e.substring(t,t+2),16),n+=B.charAt(r>>2)+B.charAt((3&r)<<4)),"=";(3&n.length)>0;)n+="=";return n}function et(e){var t,r,n,i="",a=0;for(t=0;t<e.length&&e.charAt(t)!="=";++t)(n=B.indexOf(e.charAt(t)))<0||(a==0?(i+=kt(n>>2),r=3&n,a=1):a==1?(i+=kt(r<<2|n>>4),r=15&n,a=2):a==2?(i+=kt(r),i+=kt(n>>2),r=3&n,a=3):(i+=kt(r<<2|n>>4),i+=kt(15&n),a=0));return a==1&&(i+=kt(r<<2)),i}function it(e){var t,r=et(e),n=new Array;for(t=0;2*t<r.length;++t)n[t]=parseInt(r.substring(2*t,2*t+2),16);return n}function V(e,t,r){e!=null&&(typeof e=="number"?this.fromNumber(e,t,r):t==null&&typeof e!="string"?this.fromString(e,256):this.fromString(e,t))}function ut(){return new V(null)}C.appName=="Microsoft Internet Explorer"?(V.prototype.am=function(t,r,n,i,a,f){for(var b=32767&r,y=r>>15;--f>=0;){var S=32767&this[t],F=this[t++]>>15,x=y*S+F*b;a=((S=b*S+((32767&x)<<15)+n[i]+(1073741823&a))>>>30)+(x>>>15)+y*F+(a>>>30),n[i++]=1073741823&S}return a},q=30):C.appName!="Netscape"?(V.prototype.am=function(t,r,n,i,a,f){for(;--f>=0;){var b=r*this[t++]+n[i]+a;a=Math.floor(b/67108864),n[i++]=67108863&b}return a},q=26):(V.prototype.am=function(t,r,n,i,a,f){for(var b=16383&r,y=r>>14;--f>=0;){var S=16383&this[t],F=this[t++]>>14,x=y*S+F*b;a=((S=b*S+((16383&x)<<14)+n[i]+a)>>28)+(x>>14)+y*F,n[i++]=268435455&S}return a},q=28),V.prototype.DB=q,V.prototype.DM=(1<<q)-1,V.prototype.DV=1<<q,V.prototype.FV=Math.pow(2,52),V.prototype.F1=52-q,V.prototype.F2=2*q-52;var bt,Et,Ht=new Array;for(bt="0".charCodeAt(0),Et=0;Et<=9;++Et)Ht[bt++]=Et;for(bt="a".charCodeAt(0),Et=10;Et<36;++Et)Ht[bt++]=Et;for(bt="A".charCodeAt(0),Et=10;Et<36;++Et)Ht[bt++]=Et;function kt(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function te(e,t){var r=Ht[e.charCodeAt(t)];return r??-1}function It(e){var t=ut();return t.fromInt(e),t}function gt(e){var t,r=1;return(t=e>>>16)!=0&&(e=t,r+=16),(t=e>>8)!=0&&(e=t,r+=8),(t=e>>4)!=0&&(e=t,r+=4),(t=e>>2)!=0&&(e=t,r+=2),(t=e>>1)!=0&&(e=t,r+=1),r}function dt(e){this.m=e}function Pt(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Yt(e,t){return e&t}function qt(e,t){return e|t}function Gt(e,t){return e^t}function ee(e,t){return e&~t}function le(e){if(e==0)return-1;var t=0;return!(65535&e)&&(e>>=16,t+=16),!(255&e)&&(e>>=8,t+=8),!(15&e)&&(e>>=4,t+=4),!(3&e)&&(e>>=2,t+=2),!(1&e)&&++t,t}function ne(e){for(var t=0;e!=0;)e&=e-1,++t;return t}function Bt(){}function Xt(e){return e}function Jt(e){this.r2=ut(),this.q3=ut(),V.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}dt.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},dt.prototype.revert=function(t){return t},dt.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},dt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n),this.reduce(n)},dt.prototype.sqrTo=function(t,r){t.squareTo(r),this.reduce(r)},Pt.prototype.convert=function(t){var r=ut();return t.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),t.s<0&&r.compareTo(V.ZERO)>0&&this.m.subTo(r,r),r},Pt.prototype.revert=function(t){var r=ut();return t.copyTo(r),this.reduce(r),r},Pt.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var r=0;r<this.m.t;++r){var n=32767&t[r],i=n*this.mpl+((n*this.mph+(t[r]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=r+this.m.t]+=this.m.am(0,i,t,r,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},Pt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n),this.reduce(n)},Pt.prototype.sqrTo=function(t,r){t.squareTo(r),this.reduce(r)},V.prototype.copyTo=function(t){for(var r=this.t-1;r>=0;--r)t[r]=this[r];t.t=this.t,t.s=this.s},V.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},V.prototype.fromString=function(t,r){var n;if(r==16)n=4;else if(r==8)n=3;else if(r==256)n=8;else if(r==2)n=1;else if(r==32)n=5;else{if(r!=4)return void this.fromRadix(t,r);n=2}this.t=0,this.s=0;for(var i=t.length,a=!1,f=0;--i>=0;){var b=n==8?255&t[i]:te(t,i);b<0?t.charAt(i)=="-"&&(a=!0):(a=!1,f==0?this[this.t++]=b:f+n>this.DB?(this[this.t-1]|=(b&(1<<this.DB-f)-1)<<f,this[this.t++]=b>>this.DB-f):this[this.t-1]|=b<<f,(f+=n)>=this.DB&&(f-=this.DB))}n==8&&128&t[0]&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),a&&V.ZERO.subTo(this,this)},V.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},V.prototype.dlShiftTo=function(t,r){var n;for(n=this.t-1;n>=0;--n)r[n+t]=this[n];for(n=t-1;n>=0;--n)r[n]=0;r.t=this.t+t,r.s=this.s},V.prototype.drShiftTo=function(t,r){for(var n=t;n<this.t;++n)r[n-t]=this[n];r.t=Math.max(this.t-t,0),r.s=this.s},V.prototype.lShiftTo=function(t,r){var n,i=t%this.DB,a=this.DB-i,f=(1<<a)-1,b=Math.floor(t/this.DB),y=this.s<<i&this.DM;for(n=this.t-1;n>=0;--n)r[n+b+1]=this[n]>>a|y,y=(this[n]&f)<<i;for(n=b-1;n>=0;--n)r[n]=0;r[b]=y,r.t=this.t+b+1,r.s=this.s,r.clamp()},V.prototype.rShiftTo=function(t,r){r.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)r.t=0;else{var i=t%this.DB,a=this.DB-i,f=(1<<i)-1;r[0]=this[n]>>i;for(var b=n+1;b<this.t;++b)r[b-n-1]|=(this[b]&f)<<a,r[b-n]=this[b]>>i;i>0&&(r[this.t-n-1]|=(this.s&f)<<a),r.t=this.t-n,r.clamp()}},V.prototype.subTo=function(t,r){for(var n=0,i=0,a=Math.min(t.t,this.t);n<a;)i+=this[n]-t[n],r[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],r[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],r[n++]=i&this.DM,i>>=this.DB;i-=t.s}r.s=i<0?-1:0,i<-1?r[n++]=this.DV+i:i>0&&(r[n++]=i),r.t=n,r.clamp()},V.prototype.multiplyTo=function(t,r){var n=this.abs(),i=t.abs(),a=n.t;for(r.t=a+i.t;--a>=0;)r[a]=0;for(a=0;a<i.t;++a)r[a+n.t]=n.am(0,i[a],r,a,0,n.t);r.s=0,r.clamp(),this.s!=t.s&&V.ZERO.subTo(r,r)},V.prototype.squareTo=function(t){for(var r=this.abs(),n=t.t=2*r.t;--n>=0;)t[n]=0;for(n=0;n<r.t-1;++n){var i=r.am(n,r[n],t,2*n,0,1);(t[n+r.t]+=r.am(n+1,2*r[n],t,2*n+1,i,r.t-n-1))>=r.DV&&(t[n+r.t]-=r.DV,t[n+r.t+1]=1)}t.t>0&&(t[t.t-1]+=r.am(n,r[n],t,2*n,0,1)),t.s=0,t.clamp()},V.prototype.divRemTo=function(t,r,n){var i=t.abs();if(!(i.t<=0)){var a=this.abs();if(a.t<i.t)return r!=null&&r.fromInt(0),void(n!=null&&this.copyTo(n));n==null&&(n=ut());var f=ut(),b=this.s,y=t.s,S=this.DB-gt(i[i.t-1]);S>0?(i.lShiftTo(S,f),a.lShiftTo(S,n)):(i.copyTo(f),a.copyTo(n));var F=f.t,x=f[F-1];if(x!=0){var I=x*(1<<this.F1)+(F>1?f[F-2]>>this.F2:0),H=this.FV/I,W=(1<<this.F1)/I,G=1<<this.F2,X=n.t,g=X-F,E=r??ut();for(f.dlShiftTo(g,E),n.compareTo(E)>=0&&(n[n.t++]=1,n.subTo(E,n)),V.ONE.dlShiftTo(F,E),E.subTo(f,f);f.t<F;)f[f.t++]=0;for(;--g>=0;){var R=n[--X]==x?this.DM:Math.floor(n[X]*H+(n[X-1]+G)*W);if((n[X]+=f.am(0,R,n,g,0,F))<R)for(f.dlShiftTo(g,E),n.subTo(E,n);n[X]<--R;)n.subTo(E,n)}r!=null&&(n.drShiftTo(F,r),b!=y&&V.ZERO.subTo(r,r)),n.t=F,n.clamp(),S>0&&n.rShiftTo(S,n),b<0&&V.ZERO.subTo(n,n)}}},V.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(!(1&t))return 0;var r=3&t;return(r=(r=(r=(r=r*(2-(15&t)*r)&15)*(2-(255&t)*r)&255)*(2-((65535&t)*r&65535))&65535)*(2-t*r%this.DV)%this.DV)>0?this.DV-r:-r},V.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},V.prototype.exp=function(t,r){if(t>4294967295||t<1)return V.ONE;var n=ut(),i=ut(),a=r.convert(this),f=gt(t)-1;for(a.copyTo(n);--f>=0;)if(r.sqrTo(n,i),(t&1<<f)>0)r.mulTo(i,a,n);else{var b=n;n=i,i=b}return r.revert(n)},V.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var r;if(t==16)r=4;else if(t==8)r=3;else if(t==2)r=1;else if(t==32)r=5;else{if(t!=4)return this.toRadix(t);r=2}var n,i=(1<<r)-1,a=!1,f="",b=this.t,y=this.DB-b*this.DB%r;if(b-- >0)for(y<this.DB&&(n=this[b]>>y)>0&&(a=!0,f=kt(n));b>=0;)y<r?(n=(this[b]&(1<<y)-1)<<r-y,n|=this[--b]>>(y+=this.DB-r)):(n=this[b]>>(y-=r)&i,y<=0&&(y+=this.DB,--b)),n>0&&(a=!0),a&&(f+=kt(n));return a?f:"0"},V.prototype.negate=function(){var t=ut();return V.ZERO.subTo(this,t),t},V.prototype.abs=function(){return this.s<0?this.negate():this},V.prototype.compareTo=function(t){var r=this.s-t.s;if(r!=0)return r;var n=this.t;if((r=n-t.t)!=0)return this.s<0?-r:r;for(;--n>=0;)if((r=this[n]-t[n])!=0)return r;return 0},V.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+gt(this[this.t-1]^this.s&this.DM)},V.prototype.mod=function(t){var r=ut();return this.abs().divRemTo(t,null,r),this.s<0&&r.compareTo(V.ZERO)>0&&t.subTo(r,r),r},V.prototype.modPowInt=function(t,r){var n;return n=t<256||r.isEven()?new dt(r):new Pt(r),this.exp(t,n)},V.ZERO=It(0),V.ONE=It(1),Bt.prototype.convert=Xt,Bt.prototype.revert=Xt,Bt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n)},Bt.prototype.sqrTo=function(t,r){t.squareTo(r)},Jt.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var r=ut();return t.copyTo(r),this.reduce(r),r},Jt.prototype.revert=function(t){return t},Jt.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},Jt.prototype.mulTo=function(t,r,n){t.multiplyTo(r,n),this.reduce(n)},Jt.prototype.sqrTo=function(t,r){t.squareTo(r),this.reduce(r)};var U=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],c=(1<<26)/U[U.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function h(){this.i=0,this.j=0,this.S=new Array}V.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},V.prototype.toRadix=function(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var r=this.chunkSize(t),n=Math.pow(t,r),i=It(n),a=ut(),f=ut(),b="";for(this.divRemTo(i,a,f);a.signum()>0;)b=(n+f.intValue()).toString(t).substr(1)+b,a.divRemTo(i,a,f);return f.intValue().toString(t)+b},V.prototype.fromRadix=function(t,r){this.fromInt(0),r==null&&(r=10);for(var n=this.chunkSize(r),i=Math.pow(r,n),a=!1,f=0,b=0,y=0;y<t.length;++y){var S=te(t,y);S<0?t.charAt(y)=="-"&&this.signum()==0&&(a=!0):(b=r*b+S,++f>=n&&(this.dMultiply(i),this.dAddOffset(b,0),f=0,b=0))}f>0&&(this.dMultiply(Math.pow(r,f)),this.dAddOffset(b,0)),a&&V.ZERO.subTo(this,this)},V.prototype.fromNumber=function(t,r,n){if(typeof r=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(V.ONE.shiftLeft(t-1),qt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(V.ONE.shiftLeft(t-1),this);else{var i=new Array,a=7&t;i.length=1+(t>>3),r.nextBytes(i),a>0?i[0]&=(1<<a)-1:i[0]=0,this.fromString(i,256)}},V.prototype.bitwiseTo=function(t,r,n){var i,a,f=Math.min(t.t,this.t);for(i=0;i<f;++i)n[i]=r(this[i],t[i]);if(t.t<this.t){for(a=t.s&this.DM,i=f;i<this.t;++i)n[i]=r(this[i],a);n.t=this.t}else{for(a=this.s&this.DM,i=f;i<t.t;++i)n[i]=r(a,t[i]);n.t=t.t}n.s=r(this.s,t.s),n.clamp()},V.prototype.changeBit=function(t,r){var n=V.ONE.shiftLeft(t);return this.bitwiseTo(n,r,n),n},V.prototype.addTo=function(t,r){for(var n=0,i=0,a=Math.min(t.t,this.t);n<a;)i+=this[n]+t[n],r[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],r[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],r[n++]=i&this.DM,i>>=this.DB;i+=t.s}r.s=i<0?-1:0,i>0?r[n++]=i:i<-1&&(r[n++]=this.DV+i),r.t=n,r.clamp()},V.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},V.prototype.dAddOffset=function(t,r){if(t!=0){for(;this.t<=r;)this[this.t++]=0;for(this[r]+=t;this[r]>=this.DV;)this[r]-=this.DV,++r>=this.t&&(this[this.t++]=0),++this[r]}},V.prototype.multiplyLowerTo=function(t,r,n){var i,a=Math.min(this.t+t.t,r);for(n.s=0,n.t=a;a>0;)n[--a]=0;for(i=n.t-this.t;a<i;++a)n[a+this.t]=this.am(0,t[a],n,a,0,this.t);for(i=Math.min(t.t,r);a<i;++a)this.am(0,t[a],n,a,0,r-a);n.clamp()},V.prototype.multiplyUpperTo=function(t,r,n){--r;var i=n.t=this.t+t.t-r;for(n.s=0;--i>=0;)n[i]=0;for(i=Math.max(r-this.t,0);i<t.t;++i)n[this.t+i-r]=this.am(r-i,t[i],n,0,0,this.t+i-r);n.clamp(),n.drShiftTo(1,n)},V.prototype.modInt=function(t){if(t<=0)return 0;var r=this.DV%t,n=this.s<0?t-1:0;if(this.t>0)if(r==0)n=this[0]%t;else for(var i=this.t-1;i>=0;--i)n=(r*n+this[i])%t;return n},V.prototype.millerRabin=function(t){var r=this.subtract(V.ONE),n=r.getLowestSetBit();if(n<=0)return!1;var i=r.shiftRight(n);(t=t+1>>1)>U.length&&(t=U.length);for(var a=ut(),f=0;f<t;++f){a.fromInt(U[Math.floor(Math.random()*U.length)]);var b=a.modPow(i,this);if(b.compareTo(V.ONE)!=0&&b.compareTo(r)!=0){for(var y=1;y++<n&&b.compareTo(r)!=0;)if((b=b.modPowInt(2,this)).compareTo(V.ONE)==0)return!1;if(b.compareTo(r)!=0)return!1}}return!0},V.prototype.clone=function(){var t=ut();return this.copyTo(t),t},V.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},V.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},V.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},V.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},V.prototype.toByteArray=function(){var t=this.t,r=new Array;r[0]=this.s;var n,i=this.DB-t*this.DB%8,a=0;if(t-- >0)for(i<this.DB&&(n=this[t]>>i)!=(this.s&this.DM)>>i&&(r[a++]=n|this.s<<this.DB-i);t>=0;)i<8?(n=(this[t]&(1<<i)-1)<<8-i,n|=this[--t]>>(i+=this.DB-8)):(n=this[t]>>(i-=8)&255,i<=0&&(i+=this.DB,--t)),128&n&&(n|=-256),a==0&&(128&this.s)!=(128&n)&&++a,(a>0||n!=this.s)&&(r[a++]=n);return r},V.prototype.equals=function(t){return this.compareTo(t)==0},V.prototype.min=function(t){return this.compareTo(t)<0?this:t},V.prototype.max=function(t){return this.compareTo(t)>0?this:t},V.prototype.and=function(t){var r=ut();return this.bitwiseTo(t,Yt,r),r},V.prototype.or=function(t){var r=ut();return this.bitwiseTo(t,qt,r),r},V.prototype.xor=function(t){var r=ut();return this.bitwiseTo(t,Gt,r),r},V.prototype.andNot=function(t){var r=ut();return this.bitwiseTo(t,ee,r),r},V.prototype.not=function(){for(var t=ut(),r=0;r<this.t;++r)t[r]=this.DM&~this[r];return t.t=this.t,t.s=~this.s,t},V.prototype.shiftLeft=function(t){var r=ut();return t<0?this.rShiftTo(-t,r):this.lShiftTo(t,r),r},V.prototype.shiftRight=function(t){var r=ut();return t<0?this.lShiftTo(-t,r):this.rShiftTo(t,r),r},V.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(this[t]!=0)return t*this.DB+le(this[t]);return this.s<0?this.t*this.DB:-1},V.prototype.bitCount=function(){for(var t=0,r=this.s&this.DM,n=0;n<this.t;++n)t+=ne(this[n]^r);return t},V.prototype.testBit=function(t){var r=Math.floor(t/this.DB);return r>=this.t?this.s!=0:(this[r]&1<<t%this.DB)!=0},V.prototype.setBit=function(t){return this.changeBit(t,qt)},V.prototype.clearBit=function(t){return this.changeBit(t,ee)},V.prototype.flipBit=function(t){return this.changeBit(t,Gt)},V.prototype.add=function(t){var r=ut();return this.addTo(t,r),r},V.prototype.subtract=function(t){var r=ut();return this.subTo(t,r),r},V.prototype.multiply=function(t){var r=ut();return this.multiplyTo(t,r),r},V.prototype.divide=function(t){var r=ut();return this.divRemTo(t,r,null),r},V.prototype.remainder=function(t){var r=ut();return this.divRemTo(t,null,r),r},V.prototype.divideAndRemainder=function(t){var r=ut(),n=ut();return this.divRemTo(t,r,n),new Array(r,n)},V.prototype.modPow=function(t,r){var n,i,a=t.bitLength(),f=It(1);if(a<=0)return f;n=a<18?1:a<48?3:a<144?4:a<768?5:6,i=a<8?new dt(r):r.isEven()?new Jt(r):new Pt(r);var b=new Array,y=3,S=n-1,F=(1<<n)-1;if(b[1]=i.convert(this),n>1){var x=ut();for(i.sqrTo(b[1],x);y<=F;)b[y]=ut(),i.mulTo(x,b[y-2],b[y]),y+=2}var I,H,W=t.t-1,G=!0,X=ut();for(a=gt(t[W])-1;W>=0;){for(a>=S?I=t[W]>>a-S&F:(I=(t[W]&(1<<a+1)-1)<<S-a,W>0&&(I|=t[W-1]>>this.DB+a-S)),y=n;!(1&I);)I>>=1,--y;if((a-=y)<0&&(a+=this.DB,--W),G)b[I].copyTo(f),G=!1;else{for(;y>1;)i.sqrTo(f,X),i.sqrTo(X,f),y-=2;y>0?i.sqrTo(f,X):(H=f,f=X,X=H),i.mulTo(X,b[I],f)}for(;W>=0&&!(t[W]&1<<a);)i.sqrTo(f,X),H=f,f=X,X=H,--a<0&&(a=this.DB-1,--W)}return i.revert(f)},V.prototype.modInverse=function(t){var r=t.isEven();if(this.isEven()&&r||t.signum()==0)return V.ZERO;for(var n=t.clone(),i=this.clone(),a=It(1),f=It(0),b=It(0),y=It(1);n.signum()!=0;){for(;n.isEven();)n.rShiftTo(1,n),r?(a.isEven()&&f.isEven()||(a.addTo(this,a),f.subTo(t,f)),a.rShiftTo(1,a)):f.isEven()||f.subTo(t,f),f.rShiftTo(1,f);for(;i.isEven();)i.rShiftTo(1,i),r?(b.isEven()&&y.isEven()||(b.addTo(this,b),y.subTo(t,y)),b.rShiftTo(1,b)):y.isEven()||y.subTo(t,y),y.rShiftTo(1,y);n.compareTo(i)>=0?(n.subTo(i,n),r&&a.subTo(b,a),f.subTo(y,f)):(i.subTo(n,i),r&&b.subTo(a,b),y.subTo(f,y))}return i.compareTo(V.ONE)!=0?V.ZERO:y.compareTo(t)>=0?y.subtract(t):y.signum()<0?(y.addTo(t,y),y.signum()<0?y.add(t):y):y},V.prototype.pow=function(t){return this.exp(t,new Bt)},V.prototype.gcd=function(t){var r=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();if(r.compareTo(n)<0){var i=r;r=n,n=i}var a=r.getLowestSetBit(),f=n.getLowestSetBit();if(f<0)return r;for(a<f&&(f=a),f>0&&(r.rShiftTo(f,r),n.rShiftTo(f,n));r.signum()>0;)(a=r.getLowestSetBit())>0&&r.rShiftTo(a,r),(a=n.getLowestSetBit())>0&&n.rShiftTo(a,n),r.compareTo(n)>=0?(r.subTo(n,r),r.rShiftTo(1,r)):(n.subTo(r,n),n.rShiftTo(1,n));return f>0&&n.lShiftTo(f,n),n},V.prototype.isProbablePrime=function(t){var r,n=this.abs();if(n.t==1&&n[0]<=U[U.length-1]){for(r=0;r<U.length;++r)if(n[0]==U[r])return!0;return!1}if(n.isEven())return!1;for(r=1;r<U.length;){for(var i=U[r],a=r+1;a<U.length&&i<c;)i*=U[a++];for(i=n.modInt(i);r<a;)if(i%U[r++]==0)return!1}return n.millerRabin(t)},V.prototype.square=function(){var t=ut();return this.squareTo(t),t},h.prototype.init=function(t){var r,n,i;for(r=0;r<256;++r)this.S[r]=r;for(n=0,r=0;r<256;++r)n=n+this.S[r]+t[r%t.length]&255,i=this.S[r],this.S[r]=this.S[n],this.S[n]=i;this.i=0,this.j=0},h.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]};var L,K,J;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Z(){(function(t){K[J++]^=255&t,K[J++]^=t>>8&255,K[J++]^=t>>16&255,K[J++]^=t>>24&255,J>=256&&(J-=256)})(new Date().getTime())}if(K==null){var st;if(K=new Array,J=0,m!==void 0&&(m.crypto!==void 0||m.msCrypto!==void 0)){var lt=m.crypto||m.msCrypto;if(lt.getRandomValues){var mt=new Uint8Array(32);for(lt.getRandomValues(mt),st=0;st<32;++st)K[J++]=mt[st]}else if(C.appName=="Netscape"&&C.appVersion<"5"){var pt=m.crypto.random(32);for(st=0;st<pt.length;++st)K[J++]=255&pt.charCodeAt(st)}}for(;J<256;)st=Math.floor(65536*Math.random()),K[J++]=st>>>8,K[J++]=255&st;J=0,Z()}function Tt(){if(L==null){for(Z(),(L=function(){return new h}()).init(K),J=0;J<K.length;++J)K[J]=0;J=0}return L.next()}function Vt(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Qt(e,t){return new V(e,t)}function oe(e,t,r){for(var n="",i=0;n.length<t;)n+=r(String.fromCharCode.apply(String,e.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return n}function ht(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Ct(e,t){this.x=t,this.q=e}function yt(e,t,r,n){this.curve=e,this.x=t,this.y=r,this.z=n??V.ONE,this.zinv=null}function pe(e,t,r){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(r),this.infinity=new yt(this,null,null)}Vt.prototype.nextBytes=function(t){var r;for(r=0;r<t.length;++r)t[r]=Tt()},ht.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},ht.prototype.setPublic=function(t,r){if(this.isPublic=!0,this.isPrivate=!1,typeof t!="string")this.n=t,this.e=r;else{if(!(t!=null&&r!=null&&t.length>0&&r.length>0))throw"Invalid RSA public key";this.n=Qt(t,16),this.e=parseInt(r,16)}},ht.prototype.encrypt=function(t){var r=function(f,b){if(b<f.length+11)throw"Message too long for RSA";for(var y=new Array,S=f.length-1;S>=0&&b>0;){var F=f.charCodeAt(S--);F<128?y[--b]=F:F>127&&F<2048?(y[--b]=63&F|128,y[--b]=F>>6|192):(y[--b]=63&F|128,y[--b]=F>>6&63|128,y[--b]=F>>12|224)}y[--b]=0;for(var x=new Vt,I=new Array;b>2;){for(I[0]=0;I[0]==0;)x.nextBytes(I);y[--b]=I[0]}return y[--b]=2,y[--b]=0,new V(y)}(t,this.n.bitLength()+7>>3);if(r==null)return null;var n=this.doPublic(r);if(n==null)return null;var i=n.toString(16);return 1&i.length?"0"+i:i},ht.prototype.encryptOAEP=function(t,r,n){var i=function(y,S,F,x){var I=v.crypto.MessageDigest,H=v.crypto.Util,W=null;if(F||(F="sha1"),typeof F=="string"&&(W=I.getCanonicalAlgName(F),x=I.getHashLength(W),F=function(tt){return re(H.hashHex(ce(tt),W))}),y.length+2*x+2>S)throw"Message too long for RSA";var G,X="";for(G=0;G<S-y.length-2*x-2;G+=1)X+="\0";var g=F("")+X+""+y,E=new Array(x);new Vt().nextBytes(E);var R=oe(E,g.length,F),D=[];for(G=0;G<g.length;G+=1)D[G]=g.charCodeAt(G)^R.charCodeAt(G);var Y=oe(D,E.length,F),Q=[0];for(G=0;G<E.length;G+=1)Q[G+1]=E[G]^Y.charCodeAt(G);return new V(Q.concat(D))}(t,this.n.bitLength()+7>>3,r,n);if(i==null)return null;var a=this.doPublic(i);if(a==null)return null;var f=a.toString(16);return 1&f.length?"0"+f:f},ht.prototype.type="RSA",Ct.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.x.equals(t.x)},Ct.prototype.toBigInteger=function(){return this.x},Ct.prototype.negate=function(){return new Ct(this.q,this.x.negate().mod(this.q))},Ct.prototype.add=function(t){return new Ct(this.q,this.x.add(t.toBigInteger()).mod(this.q))},Ct.prototype.subtract=function(t){return new Ct(this.q,this.x.subtract(t.toBigInteger()).mod(this.q))},Ct.prototype.multiply=function(t){return new Ct(this.q,this.x.multiply(t.toBigInteger()).mod(this.q))},Ct.prototype.square=function(){return new Ct(this.q,this.x.square().mod(this.q))},Ct.prototype.divide=function(t){return new Ct(this.q,this.x.multiply(t.toBigInteger().modInverse(this.q)).mod(this.q))},yt.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},yt.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},yt.prototype.equals=function(t){return t==this||(this.isInfinity()?t.isInfinity():t.isInfinity()?this.isInfinity():!!t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(V.ZERO)&&t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q).equals(V.ZERO))},yt.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(V.ZERO)&&!this.y.toBigInteger().equals(V.ZERO)},yt.prototype.negate=function(){return new yt(this.curve,this.x,this.y.negate(),this.z)},yt.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var r=t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q),n=t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q);if(V.ZERO.equals(n))return V.ZERO.equals(r)?this.twice():this.curve.getInfinity();var i=new V("3"),a=this.x.toBigInteger(),f=this.y.toBigInteger(),b=(t.x.toBigInteger(),t.y.toBigInteger(),n.square()),y=b.multiply(n),S=a.multiply(b),F=r.square().multiply(this.z),x=F.subtract(S.shiftLeft(1)).multiply(t.z).subtract(y).multiply(n).mod(this.curve.q),I=S.multiply(i).multiply(r).subtract(f.multiply(y)).subtract(F.multiply(r)).multiply(t.z).add(r.multiply(y)).mod(this.curve.q),H=y.multiply(this.z).multiply(t.z).mod(this.curve.q);return new yt(this.curve,this.curve.fromBigInteger(x),this.curve.fromBigInteger(I),H)},yt.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=new V("3"),r=this.x.toBigInteger(),n=this.y.toBigInteger(),i=n.multiply(this.z),a=i.multiply(n).mod(this.curve.q),f=this.curve.a.toBigInteger(),b=r.square().multiply(t);V.ZERO.equals(f)||(b=b.add(this.z.square().multiply(f)));var y=(b=b.mod(this.curve.q)).square().subtract(r.shiftLeft(3).multiply(a)).shiftLeft(1).multiply(i).mod(this.curve.q),S=b.multiply(t).multiply(r).subtract(a.shiftLeft(1)).shiftLeft(2).multiply(a).subtract(b.square().multiply(b)).mod(this.curve.q),F=i.square().multiply(i).shiftLeft(3).mod(this.curve.q);return new yt(this.curve,this.curve.fromBigInteger(y),this.curve.fromBigInteger(S),F)},yt.prototype.multiply=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var r,n=t,i=n.multiply(new V("3")),a=this.negate(),f=this,b=this.curve.q.subtract(t),y=b.multiply(new V("3")),S=new yt(this.curve,this.x,this.y),F=S.negate();for(r=i.bitLength()-2;r>0;--r){f=f.twice();var x=i.testBit(r);x!=n.testBit(r)&&(f=f.add(x?this:a))}for(r=y.bitLength()-2;r>0;--r){S=S.twice();var I=y.testBit(r);I!=b.testBit(r)&&(S=S.add(I?S:F))}return f},yt.prototype.multiplyTwo=function(t,r,n){var i;i=t.bitLength()>n.bitLength()?t.bitLength()-1:n.bitLength()-1;for(var a=this.curve.getInfinity(),f=this.add(r);i>=0;)a=a.twice(),t.testBit(i)?a=n.testBit(i)?a.add(f):a.add(this):n.testBit(i)&&(a=a.add(r)),--i;return a},pe.prototype.getQ=function(){return this.q},pe.prototype.getA=function(){return this.a},pe.prototype.getB=function(){return this.b},pe.prototype.equals=function(t){return t==this||this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)},pe.prototype.getInfinity=function(){return this.infinity},pe.prototype.fromBigInteger=function(t){return new Ct(this.q,t)},pe.prototype.decodePointHex=function(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var r=(t.length-2)/2,n=t.substr(2,r),i=t.substr(r+2,r);return new yt(this,this.fromBigInteger(new V(n,16)),this.fromBigInteger(new V(i,16)));default:return null}},Ct.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},yt.prototype.getEncoded=function(e){var t=function(f,b){var y=f.toByteArrayUnsigned();if(b<y.length)y=y.slice(y.length-b);else for(;b>y.length;)y.unshift(0);return y},r=this.getX().toBigInteger(),n=this.getY().toBigInteger(),i=t(r,32);return e?n.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(t(n,32))),i},yt.decodeFrom=function(e,t){t[0];var r=t.length-1,n=t.slice(1,1+r/2),i=t.slice(1+r/2,1+r);n.unshift(0),i.unshift(0);var a=new V(n),f=new V(i);return new yt(e,e.fromBigInteger(a),e.fromBigInteger(f))},yt.decodeFromHex=function(e,t){t.substr(0,2);var r=t.length-2,n=t.substr(2,r/2),i=t.substr(2+r/2,r/2),a=new V(n,16),f=new V(i,16);return new yt(e,e.fromBigInteger(a),e.fromBigInteger(f))},yt.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),r=e.y.subtract(this.y).divide(t),n=r.square().subtract(this.x).subtract(e.x),i=r.multiply(this.x.subtract(n)).subtract(this.y);return new yt(this.curve,n,i)},yt.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var e=this.curve.fromBigInteger(V.valueOf(2)),t=this.curve.fromBigInteger(V.valueOf(3)),r=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),n=r.square().subtract(this.x.multiply(e)),i=r.multiply(this.x.subtract(n)).subtract(this.y);return new yt(this.curve,n,i)},yt.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(e.signum()==0)return this.curve.getInfinity();var t,r=e,n=r.multiply(new V("3")),i=this.negate(),a=this;for(t=n.bitLength()-2;t>0;--t){a=a.twice();var f=n.testBit(t);f!=r.testBit(t)&&(a=a.add2D(f?this:i))}return a},yt.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),r=this.curve.getA().toBigInteger(),n=this.curve.getB().toBigInteger(),i=this.curve.getQ(),a=t.multiply(t).mod(i),f=e.multiply(e).multiply(e).add(r.multiply(e)).add(n).mod(i);return a.equals(f)},yt.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},yt.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),r=this.getY().toBigInteger();if(t.compareTo(V.ONE)<0||t.compareTo(e.subtract(V.ONE))>0)throw new Error("x coordinate out of bounds");if(r.compareTo(V.ONE)<0||r.compareTo(e.subtract(V.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var Xe=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),r={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function n(f,b,y){return b?r[b]:String.fromCharCode(parseInt(y,16))}var i=new String(""),a=Object.hasOwnProperty;return function(f,b){var y,S,F=f.match(e),x=F[0],I=!1;x==="{"?y={}:x==="["?y=[]:(y=[],I=!0);for(var H=[y],W=1-I,G=F.length;W<G;++W){var X;switch((x=F[W]).charCodeAt(0)){default:(X=H[0])[S||X.length]=+x,S=void 0;break;case 34:if((x=x.substring(1,x.length-1)).indexOf("\\")!==-1&&(x=x.replace(t,n)),X=H[0],!S){if(!(X instanceof Array)){S=x||i;break}S=X.length}X[S]=x,S=void 0;break;case 91:X=H[0],H.unshift(X[S||X.length]=[]),S=void 0;break;case 93:H.shift();break;case 102:(X=H[0])[S||X.length]=!1,S=void 0;break;case 110:(X=H[0])[S||X.length]=null,S=void 0;break;case 116:(X=H[0])[S||X.length]=!0,S=void 0;break;case 123:X=H[0],H.unshift(X[S||X.length]={}),S=void 0;break;case 125:H.shift()}}if(I){if(H.length!==1)throw new Error;y=y[0]}else if(H.length)throw new Error;return b&&(y=function g(E,R){var D=E[R];if(D&&(D===void 0?"undefined":l(D))==="object"){var Y=null;for(var Q in D)if(a.call(D,Q)&&D!==E){var at=g(D,Q);at!==void 0?D[Q]=at:(Y||(Y=[]),Y.push(Q))}if(Y)for(var tt=Y.length;--tt>=0;)delete D[Y[tt]]}return b.call(E,R,D)}({"":y},"")),y}}();v!==void 0&&v||(p.KJUR=v={}),v.asn1!==void 0&&v.asn1||(v.asn1={}),v.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if(t.substr(0,1)!="-")t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var r=t.substr(1).length;r%2==1?r+=1:t.match(/^[0-7]/)||(r+=2);for(var n="",i=0;i<r;i++)n+="f";t=new V(n,16).xor(e).add(V.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return Zt(e,t)},this.newObject=function(e){var t=v.asn1,r=t.ASN1Object,n=t.DERBoolean,i=t.DERInteger,a=t.DERBitString,f=t.DEROctetString,b=t.DERNull,y=t.DERObjectIdentifier,S=t.DEREnumerated,F=t.DERUTF8String,x=t.DERNumericString,I=t.DERPrintableString,H=t.DERTeletexString,W=t.DERIA5String,G=t.DERUTCTime,X=t.DERGeneralizedTime,g=t.DERVisibleString,E=t.DERBMPString,R=t.DERSequence,D=t.DERSet,Y=t.DERTaggedObject,Q=t.ASN1Util.newObject;if(e instanceof t.ASN1Object)return e;var at=Object.keys(e);if(at.length!=1)throw new Error("key of param shall be only one.");var tt=at[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+tt+":")==-1)throw new Error("undefined key: "+tt);if(tt=="bool")return new n(e[tt]);if(tt=="int")return new i(e[tt]);if(tt=="bitstr")return new a(e[tt]);if(tt=="octstr")return new f(e[tt]);if(tt=="null")return new b(e[tt]);if(tt=="oid")return new y(e[tt]);if(tt=="enum")return new S(e[tt]);if(tt=="utf8str")return new F(e[tt]);if(tt=="numstr")return new x(e[tt]);if(tt=="prnstr")return new I(e[tt]);if(tt=="telstr")return new H(e[tt]);if(tt=="ia5str")return new W(e[tt]);if(tt=="utctime")return new G(e[tt]);if(tt=="gentime")return new X(e[tt]);if(tt=="visstr")return new g(e[tt]);if(tt=="bmpstr")return new E(e[tt]);if(tt=="asn1")return new r(e[tt]);if(tt=="seq"){for(var ft=e[tt],ot=[],ct=0;ct<ft.length;ct++){var St=Q(ft[ct]);ot.push(St)}return new R({array:ot})}if(tt=="set"){for(ft=e[tt],ot=[],ct=0;ct<ft.length;ct++)St=Q(ft[ct]),ot.push(St);return new D({array:ot})}if(tt=="tag"){var xt=e[tt];if(Object.prototype.toString.call(xt)==="[object Array]"&&xt.length==3){var Ft=Q(xt[2]);return new Y({tag:xt[0],explicit:xt[1],obj:Ft})}return new Y(xt)}},this.jsonToASN1HEX=function(e){return this.newObject(e).getEncodedHex()}},v.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",r=parseInt(e.substr(0,2),16),n=(t=Math.floor(r/40)+"."+r%40,""),i=2;i<e.length;i+=2){var a=("00000000"+parseInt(e.substr(i,2),16).toString(2)).slice(-8);n+=a.substr(1,7),a.substr(0,1)=="0"&&(t=t+"."+new V(n,2).toString(10),n="")}return t},v.asn1.ASN1Util.oidIntToHex=function(e){var t=function(y){var S=y.toString(16);return S.length==1&&(S="0"+S),S},r=function(y){var S="",F=new V(y,10).toString(2),x=7-F.length%7;x==7&&(x=0);for(var I="",H=0;H<x;H++)I+="0";for(F=I+F,H=0;H<F.length-1;H+=7){var W=F.substr(H,7);H!=F.length-7&&(W="1"+W),S+=t(parseInt(W,2))}return S};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var n="",i=e.split("."),a=40*parseInt(i[0])+parseInt(i[1]);n+=t(a),i.splice(0,2);for(var f=0;f<i.length;f++)n+=r(i[f]);return n},v.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var t=this.hV.length/2,r=t.toString(16);if(r.length%2==1&&(r="0"+r),t<128)return r;var n=r.length/2;if(n>15)throw"ASN.1 length too long to represent by 8x: n = "+t.toString(16);return(128+n).toString(16)+r},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(t){this.params=t},e!=null&&e.tlv!=null&&(this.hTLV=e.tlv,this.isModified=!1)},v.asn1.DERAbstractString=function(e){v.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=je(this.s).toLowerCase()},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(typeof e=="string"?this.setString(e):e.str!==void 0?this.setString(e.str):e.hex!==void 0&&this.setStringHex(e.hex))},s.lang.extend(v.asn1.DERAbstractString,v.asn1.ASN1Object),v.asn1.DERAbstractTime=function(e){v.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(t){var r=t.getTime()+6e4*t.getTimezoneOffset();return new Date(r)},this.formatDate=function(t,r,n){var i=this.zeroPadding,a=this.localDateToUTC(t),f=String(a.getFullYear());r=="utc"&&(f=f.substr(2,2));var b=f+i(String(a.getMonth()+1),2)+i(String(a.getDate()),2)+i(String(a.getHours()),2)+i(String(a.getMinutes()),2)+i(String(a.getSeconds()),2);if(n===!0){var y=a.getMilliseconds();if(y!=0){var S=i(String(y),3);b=b+"."+(S=S.replace(/[0]+$/,""))}}return b+"Z"},this.zeroPadding=function(t,r){return t.length>=r?t:new Array(r-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=fe(t)},this.setByDateValue=function(t,r,n,i,a,f){var b=new Date(Date.UTC(t,r-1,n,i,a,f,0));this.setByDate(b)},this.getFreshValueHex=function(){return this.hV}},s.lang.extend(v.asn1.DERAbstractTime,v.asn1.ASN1Object),v.asn1.DERAbstractStructured=function(e){v.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,e!==void 0&&e.array!==void 0&&(this.asn1Array=e.array)},s.lang.extend(v.asn1.DERAbstractStructured,v.asn1.ASN1Object),v.asn1.DERBoolean=function(e){v.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=e==0?"010100":"0101ff"},s.lang.extend(v.asn1.DERBoolean,v.asn1.ASN1Object),v.asn1.DERInteger=function(e){v.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=v.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var r=new V(String(t),10);this.setByBigInteger(r)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(e.bigint!==void 0?this.setByBigInteger(e.bigint):e.int!==void 0?this.setByInteger(e.int):typeof e=="number"?this.setByInteger(e):e.hex!==void 0&&this.setValueHex(e.hex))},s.lang.extend(v.asn1.DERInteger,v.asn1.ASN1Object),v.asn1.DERBitString=function(e){if(e!==void 0&&e.obj!==void 0){var t=v.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.getEncodedHex()}v.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(r){this.hTLV=null,this.isModified=!0,this.hV=r},this.setUnusedBitsAndHexValue=function(r,n){if(r<0||7<r)throw"unused bits shall be from 0 to 7: u = "+r;var i="0"+r;this.hTLV=null,this.isModified=!0,this.hV=i+n},this.setByBinaryString=function(r){var n=8-(r=r.replace(/0+$/,"")).length%8;n==8&&(n=0);for(var i=0;i<=n;i++)r+="0";var a="";for(i=0;i<r.length-1;i+=8){var f=r.substr(i,8),b=parseInt(f,2).toString(16);b.length==1&&(b="0"+b),a+=b}this.hTLV=null,this.isModified=!0,this.hV="0"+n+a},this.setByBooleanArray=function(r){for(var n="",i=0;i<r.length;i++)r[i]==1?n+="1":n+="0";this.setByBinaryString(n)},this.newFalseArray=function(r){for(var n=new Array(r),i=0;i<r;i++)n[i]=!1;return n},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(typeof e=="string"&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):e.hex!==void 0?this.setHexValueIncludingUnusedBits(e.hex):e.bin!==void 0?this.setByBinaryString(e.bin):e.array!==void 0&&this.setByBooleanArray(e.array))},s.lang.extend(v.asn1.DERBitString,v.asn1.ASN1Object),v.asn1.DEROctetString=function(e){if(e!==void 0&&e.obj!==void 0){var t=v.asn1.ASN1Util.newObject(e.obj);e.hex=t.getEncodedHex()}v.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},s.lang.extend(v.asn1.DEROctetString,v.asn1.DERAbstractString),v.asn1.DERNull=function(){v.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},s.lang.extend(v.asn1.DERNull,v.asn1.ASN1Object),v.asn1.DERObjectIdentifier=function(e){v.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){var r=function(i){var a=function(I){var H=I.toString(16);return H.length==1&&(H="0"+H),H},f=function(I){var H="",W=parseInt(I,10).toString(2),G=7-W.length%7;G==7&&(G=0);for(var X="",g=0;g<G;g++)X+="0";for(W=X+W,g=0;g<W.length-1;g+=7){var E=W.substr(g,7);g!=W.length-7&&(E="1"+E),H+=a(parseInt(E,2))}return H};try{if(!i.match(/^[0-9.]+$/))return null;var b="",y=i.split("."),S=40*parseInt(y[0],10)+parseInt(y[1],10);b+=a(S),y.splice(0,2);for(var F=0;F<y.length;F++)b+=f(y[F]);return b}catch{return null}}(t);if(r==null)throw new Error("malformed oid string: "+t);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(t){var r=v.asn1.x509.OID.name2oid(t);if(r==="")throw new Error("DERObjectIdentifier oidName undefined: "+t);this.setValueOidString(r)},this.setValueNameOrOid=function(t){t.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(t):this.setValueName(t)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(t){typeof t=="string"?this.setValueNameOrOid(t):t.oid!==void 0?this.setValueNameOrOid(t.oid):t.name!==void 0?this.setValueNameOrOid(t.name):t.hex!==void 0&&this.setValueHex(t.hex)},e!==void 0&&this.setByParam(e)},s.lang.extend(v.asn1.DERObjectIdentifier,v.asn1.ASN1Object),v.asn1.DEREnumerated=function(e){v.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=v.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var r=new V(String(t),10);this.setByBigInteger(r)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},e!==void 0&&(e.int!==void 0?this.setByInteger(e.int):typeof e=="number"?this.setByInteger(e):e.hex!==void 0&&this.setValueHex(e.hex))},s.lang.extend(v.asn1.DEREnumerated,v.asn1.ASN1Object),v.asn1.DERUTF8String=function(e){v.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},s.lang.extend(v.asn1.DERUTF8String,v.asn1.DERAbstractString),v.asn1.DERNumericString=function(e){v.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},s.lang.extend(v.asn1.DERNumericString,v.asn1.DERAbstractString),v.asn1.DERPrintableString=function(e){v.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},s.lang.extend(v.asn1.DERPrintableString,v.asn1.DERAbstractString),v.asn1.DERTeletexString=function(e){v.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},s.lang.extend(v.asn1.DERTeletexString,v.asn1.DERAbstractString),v.asn1.DERIA5String=function(e){v.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},s.lang.extend(v.asn1.DERIA5String,v.asn1.DERAbstractString),v.asn1.DERVisibleString=function(e){v.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},s.lang.extend(v.asn1.DERVisibleString,v.asn1.DERAbstractString),v.asn1.DERBMPString=function(e){v.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},s.lang.extend(v.asn1.DERBMPString,v.asn1.DERAbstractString),v.asn1.DERUTCTime=function(e){v.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=fe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=fe(this.s)),this.hV},e!==void 0&&(e.str!==void 0?this.setString(e.str):typeof e=="string"&&e.match(/^[0-9]{12}Z$/)?this.setString(e):e.hex!==void 0?this.setStringHex(e.hex):e.date!==void 0&&this.setByDate(e.date))},s.lang.extend(v.asn1.DERUTCTime,v.asn1.DERAbstractTime),v.asn1.DERGeneralizedTime=function(e){v.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.withMillis=!1,this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=fe(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=fe(this.s)),this.hV},e!==void 0&&(e.str!==void 0?this.setString(e.str):typeof e=="string"&&e.match(/^[0-9]{14}Z$/)?this.setString(e):e.hex!==void 0?this.setStringHex(e.hex):e.date!==void 0&&this.setByDate(e.date),e.millis===!0&&(this.withMillis=!0))},s.lang.extend(v.asn1.DERGeneralizedTime,v.asn1.DERAbstractTime),v.asn1.DERSequence=function(e){v.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var t="",r=0;r<this.asn1Array.length;r++)t+=this.asn1Array[r].getEncodedHex();return this.hV=t,this.hV}},s.lang.extend(v.asn1.DERSequence,v.asn1.DERAbstractStructured),v.asn1.DERSet=function(e){v.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var t=new Array,r=0;r<this.asn1Array.length;r++){var n=this.asn1Array[r];t.push(n.getEncodedHex())}return this.sortFlag==1&&t.sort(),this.hV=t.join(""),this.hV},e!==void 0&&e.sortflag!==void 0&&e.sortflag==0&&(this.sortFlag=!1)},s.lang.extend(v.asn1.DERSet,v.asn1.DERAbstractStructured),v.asn1.DERTaggedObject=function(e){v.asn1.DERTaggedObject.superclass.constructor.call(this);var t=v.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(r,n,i){this.hT=n,this.isExplicit=r,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,n),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(r){r.tag!=null&&(this.hT=r.tag),r.explicit!=null&&(this.isExplicit=r.explicit),r.tage!=null&&(this.hT=r.tage,this.isExplicit=!0),r.tagi!=null&&(this.hT=r.tagi,this.isExplicit=!1),r.obj!=null&&(r.obj instanceof t.ASN1Object?(this.asn1Object=r.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):l(r.obj)=="object"&&(this.asn1Object=t.ASN1Util.newObject(r.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},e!=null&&this.setByParam(e)},s.lang.extend(v.asn1.DERTaggedObject,v.asn1.ASN1Object);var v,Fe,se,nt=new function(){};function Qe(e){for(var t=new Array,r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function Ze(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function Re(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);n.length==1&&(n="0"+n),t+=n}return t}function fe(e){return Re(Qe(e))}function Ie(e){return e=(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function Ee(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),e=(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function Nt(e){return e.length%2==1&&(e="0"+e),Ie($(e))}function wt(e){return et(Ee(e))}function je(e){return De(Ne(e))}function jt(e){return decodeURIComponent(Le(e))}function re(e){for(var t="",r=0;r<e.length-1;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t}function ce(e){for(var t="",r=0;r<e.length;r++)t+=("0"+e.charCodeAt(r).toString(16)).slice(-2);return t}function $e(e){return $(e)}function tr(e){var t=$e(e).replace(/(.{64})/g,`$1\r
`);return t=t.replace(/\r\n$/,"")}function er(e){return et(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function Zt(e,t){return"-----BEGIN "+t+`-----\r
`+tr(e)+`\r
-----END `+t+`-----\r
`}function he(e,t){if(e.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+t;return er(e=t!==void 0?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Me(e){var t,r,n,i,a,f,b,y,S,F,x;if(x=e.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return y=x[1],t=parseInt(y),y.length===2&&(50<=t&&t<100?t=1900+t:0<=t&&t<50&&(t=2e3+t)),r=parseInt(x[2])-1,n=parseInt(x[3]),i=parseInt(x[4]),a=parseInt(x[5]),f=parseInt(x[6]),b=0,(S=x[7])!==""&&(F=(S.substr(1)+"00").substr(0,3),b=parseInt(F)),Date.UTC(t,r,n,i,a,f,b);throw"unsupported zulu format: "+e}function rr(e){return~~(Me(e)/1e3)}function De(e){return e.replace(/%/g,"")}function Le(e){return e.replace(/(..)/g,"%$1")}function nr(e){var t="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw t;var r=(e=e.toLowerCase()).split(":").length-1;if(r<2)throw t;var n=":".repeat(7-r+2),i=(e=e.replace("::",n)).split(":");if(i.length!=8)throw t;for(var a=0;a<8;a++)i[a]=("0000"+i[a]).slice(-4);return i.join("")}function ir(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var t=(e=e.toLowerCase()).match(/.{1,4}/g),r=0;r<8;r++)t[r]=t[r].replace(/^0+/,""),t[r]==""&&(t[r]="0");var n=(e=":"+t.join(":")+":").match(/:(0:){2,}/g);if(n===null)return e.slice(1,-1);var i="";for(r=0;r<n.length;r++)n[r].length>i.length&&(i=n[r]);return(e=e.replace(i,"::")).slice(1,-1)}function He(e){var t="malformed hex value";if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(e.length!=8)return e.length==32?ir(e):e;try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch{throw t}}function Ne(e){for(var t=encodeURIComponent(e),r="",n=0;n<t.length;n++)t[n]=="%"?(r+=t.substr(n,3),n+=2):r=r+"%"+fe(t[n]);return r}function or(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function Ve(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}nt.getLblen=function(e,t){if(e.substr(t+2,1)!="8")return 1;var r=parseInt(e.substr(t+3,1));return r==0?-1:0<r&&r<10?r+1:-2},nt.getL=function(e,t){var r=nt.getLblen(e,t);return r<1?"":e.substr(t+2,2*r)},nt.getVblen=function(e,t){var r;return(r=nt.getL(e,t))==""?-1:(r.substr(0,1)==="8"?new V(r.substr(2),16):new V(r,16)).intValue()},nt.getVidx=function(e,t){var r=nt.getLblen(e,t);return r<0?r:t+2*(r+1)},nt.getV=function(e,t){var r=nt.getVidx(e,t),n=nt.getVblen(e,t);return e.substr(r,2*n)},nt.getTLV=function(e,t){return e.substr(t,2)+nt.getL(e,t)+nt.getV(e,t)},nt.getTLVblen=function(e,t){return 2+2*nt.getLblen(e,t)+2*nt.getVblen(e,t)},nt.getNextSiblingIdx=function(e,t){return nt.getVidx(e,t)+2*nt.getVblen(e,t)},nt.getChildIdx=function(e,t){var r,n,i,a=nt,f=[];r=a.getVidx(e,t),n=2*a.getVblen(e,t),e.substr(t,2)=="03"&&(r+=2,n-=2),i=0;for(var b=r;i<=n;){var y=a.getTLVblen(e,b);if((i+=y)<=n&&f.push(b),b+=y,i>=n)break}return f},nt.getNthChildIdx=function(e,t,r){return nt.getChildIdx(e,t)[r]},nt.getIdxbyList=function(e,t,r,n){var i,a,f=nt;return r.length==0?n!==void 0&&e.substr(t,2)!==n?-1:t:(i=r.shift())>=(a=f.getChildIdx(e,t)).length?-1:f.getIdxbyList(e,a[i],r,n)},nt.getIdxbyListEx=function(e,t,r,n){var i,a,f=nt;if(r.length==0)return n!==void 0&&e.substr(t,2)!==n?-1:t;i=r.shift(),a=f.getChildIdx(e,t);for(var b=0,y=0;y<a.length;y++){var S=e.substr(a[y],2);if(typeof i=="number"&&!f.isContextTag(S)&&b==i||typeof i=="string"&&f.isContextTag(S,i))return f.getIdxbyListEx(e,a[y],r,n);f.isContextTag(S)||b++}return-1},nt.getTLVbyList=function(e,t,r,n){var i=nt,a=i.getIdxbyList(e,t,r,n);return a==-1||a>=e.length?null:i.getTLV(e,a)},nt.getTLVbyListEx=function(e,t,r,n){var i=nt,a=i.getIdxbyListEx(e,t,r,n);return a==-1?null:i.getTLV(e,a)},nt.getVbyList=function(e,t,r,n,i){var a,f,b=nt;return(a=b.getIdxbyList(e,t,r,n))==-1||a>=e.length?null:(f=b.getV(e,a),i===!0&&(f=f.substr(2)),f)},nt.getVbyListEx=function(e,t,r,n,i){var a,f,b=nt;return(a=b.getIdxbyListEx(e,t,r,n))==-1?null:(f=b.getV(e,a),e.substr(a,2)=="03"&&i!==!1&&(f=f.substr(2)),f)},nt.getInt=function(e,t,r){r==null&&(r=-1);try{var n=e.substr(t,2);if(n!="02"&&n!="03")return r;var i=nt.getV(e,t);return n=="02"?parseInt(i,16):function(f){try{var b=f.substr(0,2);if(b=="00")return parseInt(f.substr(2),16);var y=parseInt(b,16),S=f.substr(2),F=parseInt(S,16).toString(2);return F=="0"&&(F="00000000"),F=F.slice(0,0-y),parseInt(F,2)}catch{return-1}}(i)}catch{return r}},nt.getOID=function(e,t,r){r==null&&(r=null);try{return e.substr(t,2)!="06"?r:function(i){if(!or(i))return null;try{var a=[],f=i.substr(0,2),b=parseInt(f,16);a[0]=new String(Math.floor(b/40)),a[1]=new String(b%40);for(var y=i.substr(2),S=[],F=0;F<y.length/2;F++)S.push(parseInt(y.substr(2*F,2),16));var x=[],I="";for(F=0;F<S.length;F++)128&S[F]?I+=sr((127&S[F]).toString(2),7):(I+=sr((127&S[F]).toString(2),7),x.push(new String(parseInt(I,2))),I="");var H=a.join(".");return x.length>0&&(H=H+"."+x.join(".")),H}catch{return null}}(nt.getV(e,t))}catch{return r}},nt.getOIDName=function(e,t,r){r==null&&(r=null);try{var n=nt.getOID(e,t,r);if(n==r)return r;var i=v.asn1.x509.OID.oid2name(n);return i==""?n:i}catch{return r}},nt.getString=function(e,t,r){r==null&&(r=null);try{return re(nt.getV(e,t))}catch{return r}},nt.hextooidstr=function(e){var t=function(I,H){return I.length>=H?I:new Array(H-I.length+1).join("0")+I},r=[],n=e.substr(0,2),i=parseInt(n,16);r[0]=new String(Math.floor(i/40)),r[1]=new String(i%40);for(var a=e.substr(2),f=[],b=0;b<a.length/2;b++)f.push(parseInt(a.substr(2*b,2),16));var y=[],S="";for(b=0;b<f.length;b++)128&f[b]?S+=t((127&f[b]).toString(2),7):(S+=t((127&f[b]).toString(2),7),y.push(new String(parseInt(S,2))),S="");var F=r.join(".");return y.length>0&&(F=F+"."+y.join(".")),F},nt.dump=function(e,t,r,n){var i=nt,a=i.getV,f=i.dump,b=i.getChildIdx,y=e;e instanceof v.asn1.ASN1Object&&(y=e.getEncodedHex());var S=function(tt,ft){return tt.length<=2*ft?tt:tt.substr(0,ft)+"..(total "+tt.length/2+"bytes).."+tt.substr(tt.length-ft,ft)};t===void 0&&(t={ommit_long_octet:32}),r===void 0&&(r=0),n===void 0&&(n="");var F,x=t.ommit_long_octet;if((F=y.substr(r,2))=="01")return(I=a(y,r))=="00"?n+`BOOLEAN FALSE
`:n+`BOOLEAN TRUE
`;if(F=="02")return n+"INTEGER "+S(I=a(y,r),x)+`
`;if(F=="03"){var I=a(y,r);if(i.isASN1HEX(I.substr(2))){var H=n+`BITSTRING, encapsulates
`;return H+=f(I.substr(2),t,0,n+"  ")}return n+"BITSTRING "+S(I,x)+`
`}if(F=="04")return I=a(y,r),i.isASN1HEX(I)?(H=n+`OCTETSTRING, encapsulates
`,H+=f(I,t,0,n+"  ")):n+"OCTETSTRING "+S(I,x)+`
`;if(F=="05")return n+`NULL
`;if(F=="06"){var W=a(y,r),G=v.asn1.ASN1Util.oidHexToInt(W),X=v.asn1.x509.OID.oid2name(G),g=G.replace(/\./g," ");return X!=""?n+"ObjectIdentifier "+X+" ("+g+`)
`:n+"ObjectIdentifier ("+g+`)
`}if(F=="0a")return n+"ENUMERATED "+parseInt(a(y,r))+`
`;if(F=="0c")return n+"UTF8String '"+jt(a(y,r))+`'
`;if(F=="13")return n+"PrintableString '"+jt(a(y,r))+`'
`;if(F=="14")return n+"TeletexString '"+jt(a(y,r))+`'
`;if(F=="16")return n+"IA5String '"+jt(a(y,r))+`'
`;if(F=="17")return n+"UTCTime "+jt(a(y,r))+`
`;if(F=="18")return n+"GeneralizedTime "+jt(a(y,r))+`
`;if(F=="1a")return n+"VisualString '"+jt(a(y,r))+`'
`;if(F=="1e")return n+"BMPString '"+jt(a(y,r))+`'
`;if(F=="30"){if(y.substr(r,4)=="3000")return n+`SEQUENCE {}
`;H=n+`SEQUENCE
`;var E=t;if(((Y=b(y,r)).length==2||Y.length==3)&&y.substr(Y[0],2)=="06"&&y.substr(Y[Y.length-1],2)=="04"){X=i.oidname(a(y,Y[0]));var R=JSON.parse(JSON.stringify(t));R.x509ExtName=X,E=R}for(var D=0;D<Y.length;D++)H+=f(y,E,Y[D],n+"  ");return H}if(F=="31"){H=n+`SET
`;var Y=b(y,r);for(D=0;D<Y.length;D++)H+=f(y,t,Y[D],n+"  ");return H}if(128&(F=parseInt(F,16))){var Q=31&F;if(32&F){for(H=n+"["+Q+`]
`,Y=b(y,r),D=0;D<Y.length;D++)H+=f(y,t,Y[D],n+"  ");return H}if(I=a(y,r),nt.isASN1HEX(I)){var H=n+"["+Q+`]
`;return H+=f(I,t,0,n+"  ")}return(I.substr(0,8)=="68747470"||t.x509ExtName==="subjectAltName"&&Q==2)&&(I=jt(I)),H=n+"["+Q+"] "+I+`
`}return n+"UNKNOWN("+F+") "+a(y,r)+`
`},nt.isContextTag=function(e,t){var r,n;e=e.toLowerCase();try{r=parseInt(e,16)}catch{return-1}if(t===void 0)return(192&r)==128;try{return t.match(/^\[[0-9]+\]$/)!=null&&!((n=parseInt(t.substr(1,t.length-1),10))>31)&&(192&r)==128&&(31&r)==n}catch{return!1}},nt.isASN1HEX=function(e){var t=nt;if(e.length%2==1)return!1;var r=t.getVblen(e,0),n=e.substr(0,2),i=t.getL(e,0);return e.length-n.length-i.length==2*r},nt.checkStrictDER=function(e,t,r,n,i){var a=nt;if(r===void 0){if(typeof e!="string")throw new Error("not hex string");if(e=e.toLowerCase(),!v.lang.String.isHex(e))throw new Error("not hex string");r=e.length,i=(n=e.length/2)<128?1:Math.ceil(n.toString(16))+1}if(a.getL(e,t).length>2*i)throw new Error("L of TLV too long: idx="+t);var f=a.getVblen(e,t);if(f>n)throw new Error("value of L too long than hex: idx="+t);var b=a.getTLV(e,t),y=b.length-2-a.getL(e,t).length;if(y!==2*f)throw new Error("V string length and L's value not the same:"+y+"/"+2*f);if(t===0&&e.length!=b.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+b.length);var S=e.substr(t,2);if(S==="02"){var F=a.getVidx(e,t);if(e.substr(F,2)=="00"&&e.charCodeAt(F+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(S,16)){for(var x=a.getVblen(e,t),I=0,H=a.getChildIdx(e,t),W=0;W<H.length;W++)I+=a.getTLV(e,H[W]).length,a.checkStrictDER(e,H[W],r,n,i);if(2*x!=I)throw new Error("sum of children's TLV length and L unmatch: "+2*x+"!="+I)}},nt.oidname=function(e){var t=v.asn1;v.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var r=t.x509.OID.oid2name(e);return r===""&&(r=e),r},v!==void 0&&v||(p.KJUR=v={}),v.lang!==void 0&&v.lang||(v.lang={}),v.lang.String=function(){},typeof P=="function"?(p.utf8tob64u=Fe=function(t){return Ie(P.from(t,"utf8").toString("base64"))},p.b64utoutf8=se=function(t){return P.from(Ee(t),"base64").toString("utf8")}):(p.utf8tob64u=Fe=function(t){return Nt(De(Ne(t)))},p.b64utoutf8=se=function(t){return decodeURIComponent(Le(wt(t)))}),v.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},v.lang.String.isHex=function(e){return or(e)},v.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},v.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=Ee(e),v.lang.String.isBase64(e))},v.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},v.lang.String.isPrintable=function(e){return e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},v.lang.String.isIA5=function(e){return e.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},v.lang.String.isMail=function(e){return e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var sr=function(t,r,n){return n==null&&(n="0"),t.length>=r?t:new Array(r-t.length+1).join(n)+t};v!==void 0&&v||(p.KJUR=v={}),v.crypto!==void 0&&v.crypto||(v.crypto={}),v.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:M.algo.MD5,sha1:M.algo.SHA1,sha224:M.algo.SHA224,sha256:M.algo.SHA256,sha384:M.algo.SHA384,sha512:M.algo.SHA512,ripemd160:M.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if(this.DIGESTINFOHEAD[t]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,r){var n=this.getDigestInfoHex(e,t),i=r/4;if(n.length+22>i)throw"key is too short for SigAlg: keylen="+r+","+t;for(var a="0001",f="00"+n,b="",y=i-a.length-f.length,S=0;S<y;S+=2)b+="ff";return a+b+f},this.hashString=function(e,t){return new v.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new v.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof ht||e instanceof v.crypto.DSA||e instanceof v.crypto.ECDSA}},v.crypto.Util.md5=function(e){return new v.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},v.crypto.Util.ripemd160=function(e){return new v.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},v.crypto.Util.SECURERANDOMGEN=new Vt,v.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return v.crypto.Util.SECURERANDOMGEN.nextBytes(t),Re(t)},v.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new V(v.crypto.Util.getRandomHexOfNbytes(e),16)},v.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,r=new Array((e-t)/8+1);return v.crypto.Util.SECURERANDOMGEN.nextBytes(r),r[0]=(255<<t&255^255)&r[0],Re(r)},v.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new V(v.crypto.Util.getRandomHexOfNbits(e),16)},v.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var r=v.crypto.Util.getRandomBigIntegerOfNbits(t);if(e.compareTo(r)!=-1)return r}},v.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var r=e.compareTo(t);if(r==1)throw"biMin is greater than biMax";if(r==0)return e;var n=t.subtract(e);return v.crypto.Util.getRandomBigIntegerZeroToMax(n).add(e)},v.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(t,r){if((t=v.crypto.MessageDigest.getCanonicalAlgName(t))!==null&&r===void 0&&(r=v.crypto.Util.DEFAULTPROVIDER[t]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(t)!=-1&&r=="cryptojs"){try{this.md=v.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[t].create()}catch(n){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var i=M.enc.Hex.parse(n);this.md.update(i)},this.digest=function(){return this.md.finalize().toString(M.enc.Hex)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}if(":sha256:".indexOf(t)!=-1&&r=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(n){throw"setAlgAndProvider hash alg set fail alg="+t+"/"+n}this.updateString=function(n){this.md.update(n)},this.updateHex=function(n){var i=sjcl.codec.hex.toBits(n);this.md.update(i)},this.digest=function(){var n=this.md.finalize();return sjcl.codec.hex.fromBits(n)},this.digestString=function(n){return this.updateString(n),this.digest()},this.digestHex=function(n){return this.updateHex(n),this.digest()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},e!==void 0&&e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0&&(this.provName=v.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},v.crypto.MessageDigest.getCanonicalAlgName=function(e){return typeof e=="string"&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},v.crypto.MessageDigest.getHashLength=function(e){var t=v.crypto.MessageDigest,r=t.getCanonicalAlgName(e);if(t.HASHLENGTH[r]===void 0)throw"not supported algorithm: "+e;return t.HASHLENGTH[r]},v.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},v.crypto.Mac=function(e){this.setAlgAndProvider=function(t,r){if((t=t.toLowerCase())==null&&(t="hmacsha1"),(t=t.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+t;r===void 0&&(r=v.crypto.Util.DEFAULTPROVIDER[t]),this.algProv=t+"/"+r;var n=t.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)!=-1&&r=="cryptojs"){try{var i=v.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=M.algo.HMAC.create(i,this.pass)}catch(a){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+a}this.updateString=function(a){this.mac.update(a)},this.updateHex=function(a){var f=M.enc.Hex.parse(a);this.mac.update(f)},this.doFinal=function(){return this.mac.finalize().toString(M.enc.Hex)},this.doFinalString=function(a){return this.updateString(a),this.doFinal()},this.doFinalHex=function(a){return this.updateHex(a),this.doFinal()}}},this.updateString=function(t){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(t){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(t){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(t){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(t){if(typeof t=="string"){var r=t;return t.length%2!=1&&t.match(/^[0-9A-Fa-f]+$/)||(r=ce(t)),void(this.pass=M.enc.Hex.parse(r))}if((t===void 0?"undefined":l(t))!="object")throw"KJUR.crypto.Mac unsupported password type: "+t;if(r=null,t.hex!==void 0){if(t.hex.length%2!=0||!t.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+t.hex;r=t.hex}if(t.utf8!==void 0&&(r=je(t.utf8)),t.rstr!==void 0&&(r=ce(t.rstr)),t.b64!==void 0&&(r=et(t.b64)),t.b64u!==void 0&&(r=wt(t.b64u)),r==null)throw"KJUR.crypto.Mac unsupported password type: "+t;this.pass=M.enc.Hex.parse(r)},e!==void 0&&(e.pass!==void 0&&this.setPassword(e.pass),e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0&&(this.provName=v.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},v.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var r=this.algName.match(/^(.+)with(.+)$/);r&&(this.mdAlgName=r[1].toLowerCase(),this.pubkeyAlgName=r[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(r,n){for(var i="",a=n/4-r.length,f=0;f<a;f++)i+="0";return i+r},this.setAlgAndProvider=function(r,n){if(this._setAlgNames(),n!="cryptojs/jsrsa")throw new Error("provider not supported: "+n);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new v.crypto.MessageDigest({alg:this.mdAlgName})}catch(i){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+i)}this.init=function(i,a){var f=null;try{f=a===void 0?Dt.getKey(i):Dt.getKey(i,a)}catch(b){throw"init failed:"+b}if(f.isPrivate===!0)this.prvKey=f,this.state="SIGN";else{if(f.isPublic!==!0)throw"init failed.:"+f;this.pubKey=f,this.state="VERIFY"}},this.updateString=function(i){this.md.updateString(i)},this.updateHex=function(i){this.md.updateHex(i)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&v.crypto.ECDSA!==void 0&&(this.prvKey=new v.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof ht&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof ht&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof v.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof v.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(i){return this.updateString(i),this.sign()},this.signHex=function(i){return this.updateHex(i),this.sign()},this.verify=function(i){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&v.crypto.ECDSA!==void 0&&(this.pubKey=new v.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof ht&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,i,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof ht&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,i);if(v.crypto.ECDSA!==void 0&&this.pubKey instanceof v.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,i);if(v.crypto.DSA!==void 0&&this.pubKey instanceof v.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,i);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(r,n){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(r){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(r){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(r){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(r){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(r){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,e!==void 0&&(e.alg!==void 0&&(this.algName=e.alg,e.prov===void 0?this.provName=v.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),e.psssaltlen!==void 0&&(this.pssSaltLen=e.psssaltlen),e.prvkeypem!==void 0)){if(e.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{t=Dt.getKey(e.prvkeypem),this.init(t)}catch(r){throw"fatal error to load pem private key: "+r}}},v.crypto.Cipher=function(e){},v.crypto.Cipher.encrypt=function(e,t,r){if(t instanceof ht&&t.isPublic){var n=v.crypto.Cipher.getAlgByKeyAndName(t,r);if(n==="RSA")return t.encrypt(e);if(n==="RSAOAEP")return t.encryptOAEP(e,"sha1");var i=n.match(/^RSAOAEP(\d+)$/);if(i!==null)return t.encryptOAEP(e,"sha"+i[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.encrypt: unsupported key or algorithm"},v.crypto.Cipher.decrypt=function(e,t,r){if(t instanceof ht&&t.isPrivate){var n=v.crypto.Cipher.getAlgByKeyAndName(t,r);if(n==="RSA")return t.decrypt(e);if(n==="RSAOAEP")return t.decryptOAEP(e,"sha1");var i=n.match(/^RSAOAEP(\d+)$/);if(i!==null)return t.decryptOAEP(e,"sha"+i[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+r}throw"Cipher.decrypt: unsupported key or algorithm"},v.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof ht){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t)!=-1)return t;if(t==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},v.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},v!==void 0&&v||(p.KJUR=v={}),v.crypto!==void 0&&v.crypto||(v.crypto={}),v.crypto.ECDSA=function(e){var t=Error,r=V,n=yt,i=v.crypto.ECDSA,a=v.crypto.ECParameterDB,f=i.getName,b=nt,y=b.getVbyListEx,S=b.isASN1HEX,F=new Vt;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(x){return new r(x.bitLength(),F).mod(x.subtract(r.ONE)).add(r.ONE)},this.setNamedCurve=function(x){this.ecparams=a.getByName(x),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=x},this.setPrivateKeyHex=function(x){this.isPrivate=!0,this.prvKeyHex=x},this.setPublicKeyHex=function(x){this.isPublic=!0,this.pubKeyHex=x},this.getPublicKeyXYHex=function(){var x=this.pubKeyHex;if(x.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var I=this.ecparams.keylen/4;if(x.length!==2+2*I)throw"malformed public key hex length";var H={};return H.x=x.substr(2,I),H.y=x.substr(2+I),H},this.getShortNISTPCurveName=function(){var x=this.curveName;return x==="secp256r1"||x==="NIST P-256"||x==="P-256"||x==="prime256v1"?"P-256":x==="secp384r1"||x==="NIST P-384"||x==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var x=this.ecparams.n,I=this.getBigRandom(x),H=this.ecparams.G.multiply(I),W=H.getX().toBigInteger(),G=H.getY().toBigInteger(),X=this.ecparams.keylen/4,g=("0000000000"+I.toString(16)).slice(-X),E="04"+("0000000000"+W.toString(16)).slice(-X)+("0000000000"+G.toString(16)).slice(-X);return this.setPrivateKeyHex(g),this.setPublicKeyHex(E),{ecprvhex:g,ecpubhex:E}},this.signWithMessageHash=function(x){return this.signHex(x,this.prvKeyHex)},this.signHex=function(x,I){var H=new r(I,16),W=this.ecparams.n,G=new r(x.substring(0,this.ecparams.keylen/4),16);do var X=this.getBigRandom(W),g=this.ecparams.G.multiply(X).getX().toBigInteger().mod(W);while(g.compareTo(r.ZERO)<=0);var E=X.modInverse(W).multiply(G.add(H.multiply(g))).mod(W);return i.biRSSigToASN1Sig(g,E)},this.sign=function(x,I){var H=I,W=this.ecparams.n,G=r.fromByteArrayUnsigned(x);do var X=this.getBigRandom(W),g=this.ecparams.G.multiply(X).getX().toBigInteger().mod(W);while(g.compareTo(V.ZERO)<=0);var E=X.modInverse(W).multiply(G.add(H.multiply(g))).mod(W);return this.serializeSig(g,E)},this.verifyWithMessageHash=function(x,I){return this.verifyHex(x,I,this.pubKeyHex)},this.verifyHex=function(x,I,H){try{var W,G,X=i.parseSigHex(I);W=X.r,G=X.s;var g=n.decodeFromHex(this.ecparams.curve,H),E=new r(x.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(E,W,G,g)}catch{return!1}},this.verify=function(x,I,H){var W,G,X;if(Bitcoin.Util.isArray(I)){var g=this.parseSig(I);W=g.r,G=g.s}else{if((I===void 0?"undefined":l(I))!=="object"||!I.r||!I.s)throw"Invalid value for signature";W=I.r,G=I.s}if(H instanceof yt)X=H;else{if(!Bitcoin.Util.isArray(H))throw"Invalid format for pubkey value, must be byte array or ECPointFp";X=n.decodeFrom(this.ecparams.curve,H)}var E=r.fromByteArrayUnsigned(x);return this.verifyRaw(E,W,G,X)},this.verifyRaw=function(x,I,H,W){var G=this.ecparams.n,X=this.ecparams.G;if(I.compareTo(r.ONE)<0||I.compareTo(G)>=0||H.compareTo(r.ONE)<0||H.compareTo(G)>=0)return!1;var g=H.modInverse(G),E=x.multiply(g).mod(G),R=I.multiply(g).mod(G);return X.multiply(E).add(W.multiply(R)).getX().toBigInteger().mod(G).equals(I)},this.serializeSig=function(x,I){var H=x.toByteArraySigned(),W=I.toByteArraySigned(),G=[];return G.push(2),G.push(H.length),(G=G.concat(H)).push(2),G.push(W.length),(G=G.concat(W)).unshift(G.length),G.unshift(48),G},this.parseSig=function(x){var I;if(x[0]!=48)throw new Error("Signature not a valid DERSequence");if(x[I=2]!=2)throw new Error("First element in signature must be a DERInteger");var H=x.slice(I+2,I+2+x[I+1]);if(x[I+=2+x[I+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var W=x.slice(I+2,I+2+x[I+1]);return I+=2+x[I+1],{r:r.fromByteArrayUnsigned(H),s:r.fromByteArrayUnsigned(W)}},this.parseSigCompact=function(x){if(x.length!==65)throw"Signature has the wrong length";var I=x[0]-27;if(I<0||I>7)throw"Invalid signature type";var H=this.ecparams.n;return{r:r.fromByteArrayUnsigned(x.slice(1,33)).mod(H),s:r.fromByteArrayUnsigned(x.slice(33,65)).mod(H),i:I}},this.readPKCS5PrvKeyHex=function(x){if(S(x)===!1)throw new Error("not ASN.1 hex string");var I,H,W;try{I=y(x,0,["[0]",0],"06"),H=y(x,0,[1],"04");try{W=y(x,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=f(I),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(W),this.setPrivateKeyHex(H),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(x){if(S(x)===!1)throw new t("not ASN.1 hex string");var I,H,W;try{y(x,0,[1,0],"06"),I=y(x,0,[1,1],"06"),H=y(x,0,[2,0,1],"04");try{W=y(x,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=f(I),this.curveName===void 0)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(W),this.setPrivateKeyHex(H),this.isPublic=!1},this.readPKCS8PubKeyHex=function(x){if(S(x)===!1)throw new t("not ASN.1 hex string");var I,H;try{y(x,0,[0,0],"06"),I=y(x,0,[0,1],"06"),H=y(x,0,[1],"03")}catch{throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=f(I),this.curveName===null)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(H)},this.readCertPubKeyHex=function(x,I){if(S(x)===!1)throw new t("not ASN.1 hex string");var H,W;try{H=y(x,0,[0,5,0,1],"06"),W=y(x,0,[0,5,1],"03")}catch{throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=f(H),this.curveName===null)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(W)},e!==void 0&&e.curve!==void 0&&(this.curveName=e.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),e!==void 0&&(e.prv!==void 0&&this.setPrivateKeyHex(e.prv),e.pub!==void 0&&this.setPublicKeyHex(e.pub))},v.crypto.ECDSA.parseSigHex=function(e){var t=v.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new V(t.r,16),s:new V(t.s,16)}},v.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=nt,r=t.getChildIdx,n=t.getV;if(t.checkStrictDER(e,0),e.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var i=r(e,0);if(i.length!=2)throw new Error("signature shall have two elements");var a=i[0],f=i[1];if(e.substr(a,2)!="02")throw new Error("1st item not ASN.1 integer");if(e.substr(f,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:n(e,a),s:n(e,f)}},v.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=v.crypto.ECDSA.parseSigHexInHexRS(e),r=t.r,n=t.s;if(r.substr(0,2)=="00"&&r.length%32==2&&(r=r.substr(2)),n.substr(0,2)=="00"&&n.length%32==2&&(n=n.substr(2)),r.length%32==30&&(r="00"+r),n.length%32==30&&(n="00"+n),r.length%32!=0)throw"unknown ECDSA sig r length error";if(n.length%32!=0)throw"unknown ECDSA sig s length error";return r+n},v.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var t=e.substr(0,e.length/2),r=e.substr(e.length/2);return v.crypto.ECDSA.hexRSSigToASN1Sig(t,r)},v.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var r=new V(e,16),n=new V(t,16);return v.crypto.ECDSA.biRSSigToASN1Sig(r,n)},v.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var r=v.asn1,n=new r.DERInteger({bigint:e}),i=new r.DERInteger({bigint:t});return new r.DERSequence({array:[n,i]}).getEncodedHex()},v.crypto.ECDSA.getName=function(e){return e==="2b8104001f"?"secp192k1":e==="2a8648ce3d030107"?"secp256r1":e==="2b8104000a"?"secp256k1":e==="2b81040021"?"secp224r1":e==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)!==-1?"secp256r1":"|secp256k1|".indexOf(e)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(e)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(e)!==-1?"secp384r1":null},v!==void 0&&v||(p.KJUR=v={}),v.crypto!==void 0&&v.crypto||(v.crypto={}),v.crypto.ECParameterDB=new function(){var e={},t={};function r(n){return new V(n,16)}this.getByName=function(n){var i=n;if(t[i]!==void 0&&(i=t[n]),e[i]!==void 0)return e[i];throw"unregistered EC curve name: "+i},this.regist=function(n,i,a,f,b,y,S,F,x,I,H,W){e[n]={};var G=r(a),X=r(f),g=r(b),E=r(y),R=r(S),D=new pe(G,X,g),Y=D.decodePointHex("04"+F+x);e[n].name=n,e[n].keylen=i,e[n].curve=D,e[n].G=Y,e[n].n=E,e[n].h=R,e[n].oid=H,e[n].info=W;for(var Q=0;Q<I.length;Q++)t[I[Q]]=n}},v.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),v.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),v.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),v.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),v.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),v.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),v.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),v.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),v.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),v.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var Dt=function(){var e=function(S,F,x){return t(M.AES,S,F,x)},t=function(S,F,x,I){var H=M.enc.Hex.parse(F),W=M.enc.Hex.parse(x),G=M.enc.Hex.parse(I),X={};X.key=W,X.iv=G,X.ciphertext=H;var g=S.decrypt(X,W,{iv:G});return M.enc.Hex.stringify(g)},r=function(S,F,x){return n(M.AES,S,F,x)},n=function(S,F,x,I){var H=M.enc.Hex.parse(F),W=M.enc.Hex.parse(x),G=M.enc.Hex.parse(I),X=S.encrypt(H,W,{iv:G}),g=M.enc.Hex.parse(X.toString());return M.enc.Base64.stringify(g)},i={"AES-256-CBC":{proc:e,eproc:r,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:r,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:r,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(S,F,x){return t(M.TripleDES,S,F,x)},eproc:function(S,F,x){return n(M.TripleDES,S,F,x)},keylen:24,ivlen:8},"DES-CBC":{proc:function(S,F,x){return t(M.DES,S,F,x)},eproc:function(S,F,x){return n(M.DES,S,F,x)},keylen:8,ivlen:8}},a=function(S){var F={},x=S.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));x&&(F.cipher=x[1],F.ivsalt=x[2]);var I=S.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));I&&(F.type=I[1]);var H=-1,W=0;S.indexOf(`\r
\r
`)!=-1&&(H=S.indexOf(`\r
\r
`),W=2),S.indexOf(`

`)!=-1&&(H=S.indexOf(`

`),W=1);var G=S.indexOf("-----END");if(H!=-1&&G!=-1){var X=S.substring(H+2*W,G-W);X=X.replace(/\s+/g,""),F.data=X}return F},f=function(S,F,x){for(var I=x.substring(0,16),H=M.enc.Hex.parse(I),W=M.enc.Utf8.parse(F),G=i[S].keylen+i[S].ivlen,X="",g=null;;){var E=M.algo.MD5.create();if(g!=null&&E.update(g),E.update(W),E.update(H),g=E.finalize(),(X+=M.enc.Hex.stringify(g)).length>=2*G)break}var R={};return R.keyhex=X.substr(0,2*i[S].keylen),R.ivhex=X.substr(2*i[S].keylen,2*i[S].ivlen),R},b=function(S,F,x,I){var H=M.enc.Base64.parse(S),W=M.enc.Hex.stringify(H);return(0,i[F].proc)(W,x,I)};return{version:"1.0.0",parsePKCS5PEM:function(S){return a(S)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(S,F,x){return f(S,F,x)},decryptKeyB64:function(S,F,x,I){return b(S,F,x,I)},getDecryptedKeyHex:function(S,F){var x=a(S),I=x.cipher,H=x.ivsalt,W=x.data,G=f(I,F,H).keyhex;return b(W,I,G,H)},getEncryptedPKCS5PEMFromPrvKeyHex:function(S,F,x,I,H){var W="";if(I!==void 0&&I!=null||(I="AES-256-CBC"),i[I]===void 0)throw"KEYUTIL unsupported algorithm: "+I;H!==void 0&&H!=null||(H=function(g){var E=M.lib.WordArray.random(g);return M.enc.Hex.stringify(E)}(i[I].ivlen).toUpperCase());var G=function(g,E,R,D){return(0,i[E].eproc)(g,R,D)}(F,I,f(I,x,H).keyhex,H);return W="-----BEGIN "+S+` PRIVATE KEY-----\r
`,W+=`Proc-Type: 4,ENCRYPTED\r
`,W+="DEK-Info: "+I+","+H+`\r
`,W+=`\r
`,W+=G.replace(/(.{64})/g,`$1\r
`),W+=`\r
-----END `+S+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(S){var F=nt,x=F.getChildIdx,I=F.getV,H={},W=x(S,0);if(W.length!=2)throw"malformed format: SEQUENCE(0).items != 2: "+W.length;H.ciphertext=I(S,W[1]);var G=x(S,W[0]);if(G.length!=2)throw"malformed format: SEQUENCE(0.0).items != 2: "+G.length;if(I(S,G[0])!="2a864886f70d01050d")throw"this only supports pkcs5PBES2";var X=x(S,G[1]);if(G.length!=2)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+X.length;var g=x(S,X[1]);if(g.length!=2)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+g.length;if(I(S,g[0])!="2a864886f70d0307")throw"this only supports TripleDES";H.encryptionSchemeAlg="TripleDES",H.encryptionSchemeIV=I(S,g[1]);var E=x(S,X[0]);if(E.length!=2)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+E.length;if(I(S,E[0])!="2a864886f70d01050c")throw"this only supports pkcs5PBKDF2";var R=x(S,E[1]);if(R.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+R.length;H.pbkdf2Salt=I(S,R[0]);var D=I(S,R[1]);try{H.pbkdf2Iter=parseInt(D,16)}catch{throw"malformed format pbkdf2Iter: "+D}return H},getPBKDF2KeyHexFromParam:function(S,F){var x=M.enc.Hex.parse(S.pbkdf2Salt),I=S.pbkdf2Iter,H=M.PBKDF2(F,x,{keySize:6,iterations:I});return M.enc.Hex.stringify(H)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(S,F){var x=he(S,"ENCRYPTED PRIVATE KEY"),I=this.parseHexOfEncryptedPKCS8(x),H=Dt.getPBKDF2KeyHexFromParam(I,F),W={};W.ciphertext=M.enc.Hex.parse(I.ciphertext);var G=M.enc.Hex.parse(H),X=M.enc.Hex.parse(I.encryptionSchemeIV),g=M.TripleDES.decrypt(W,G,{iv:X});return M.enc.Hex.stringify(g)},getKeyFromEncryptedPKCS8PEM:function(S,F){var x=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(S,F);return this.getKeyFromPlainPrivatePKCS8Hex(x)},parsePlainPrivatePKCS8Hex:function(S){var F=nt,x=F.getChildIdx,I=F.getV,H={algparam:null};if(S.substr(0,2)!="30")throw"malformed plain PKCS8 private key(code:001)";var W=x(S,0);if(W.length!=3)throw"malformed plain PKCS8 private key(code:002)";if(S.substr(W[1],2)!="30")throw"malformed PKCS8 private key(code:003)";var G=x(S,W[1]);if(G.length!=2)throw"malformed PKCS8 private key(code:004)";if(S.substr(G[0],2)!="06")throw"malformed PKCS8 private key(code:005)";if(H.algoid=I(S,G[0]),S.substr(G[1],2)=="06"&&(H.algparam=I(S,G[1])),S.substr(W[2],2)!="04")throw"malformed PKCS8 private key(code:006)";return H.keyidx=F.getVidx(S,W[2]),H},getKeyFromPlainPrivatePKCS8PEM:function(S){var F=he(S,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(F)},getKeyFromPlainPrivatePKCS8Hex:function(S){var F,x=this.parsePlainPrivatePKCS8Hex(S);if(x.algoid=="2a864886f70d010101")F=new ht;else if(x.algoid=="2a8648ce380401")F=new v.crypto.DSA;else{if(x.algoid!="2a8648ce3d0201")throw"unsupported private key algorithm";F=new v.crypto.ECDSA}return F.readPKCS8PrvKeyHex(S),F},_getKeyFromPublicPKCS8Hex:function(S){var F,x=nt.getVbyList(S,0,[0,0],"06");if(x==="2a864886f70d010101")F=new ht;else if(x==="2a8648ce380401")F=new v.crypto.DSA;else{if(x!=="2a8648ce3d0201")throw"unsupported PKCS#8 public key hex";F=new v.crypto.ECDSA}return F.readPKCS8PubKeyHex(S),F},parsePublicRawRSAKeyHex:function(S){var F=nt,x=F.getChildIdx,I=F.getV,H={};if(S.substr(0,2)!="30")throw"malformed RSA key(code:001)";var W=x(S,0);if(W.length!=2)throw"malformed RSA key(code:002)";if(S.substr(W[0],2)!="02")throw"malformed RSA key(code:003)";if(H.n=I(S,W[0]),S.substr(W[1],2)!="02")throw"malformed RSA key(code:004)";return H.e=I(S,W[1]),H},parsePublicPKCS8Hex:function(S){var F=nt,x=F.getChildIdx,I=F.getV,H={algparam:null},W=x(S,0);if(W.length!=2)throw"outer DERSequence shall have 2 elements: "+W.length;var G=W[0];if(S.substr(G,2)!="30")throw"malformed PKCS8 public key(code:001)";var X=x(S,G);if(X.length!=2)throw"malformed PKCS8 public key(code:002)";if(S.substr(X[0],2)!="06")throw"malformed PKCS8 public key(code:003)";if(H.algoid=I(S,X[0]),S.substr(X[1],2)=="06"?H.algparam=I(S,X[1]):S.substr(X[1],2)=="30"&&(H.algparam={},H.algparam.p=F.getVbyList(S,X[1],[0],"02"),H.algparam.q=F.getVbyList(S,X[1],[1],"02"),H.algparam.g=F.getVbyList(S,X[1],[2],"02")),S.substr(W[1],2)!="03")throw"malformed PKCS8 public key(code:004)";return H.key=I(S,W[1]).substr(2),H}}}();Dt.getKey=function(e,t,r){var n=(X=nt).getChildIdx,i=(X.getV,X.getVbyList),a=v.crypto,f=a.ECDSA,b=a.DSA,y=ht,S=he,F=Dt;if(y!==void 0&&e instanceof y||f!==void 0&&e instanceof f||b!==void 0&&e instanceof b)return e;if(e.curve!==void 0&&e.xy!==void 0&&e.d===void 0)return new f({pub:e.xy,curve:e.curve});if(e.curve!==void 0&&e.d!==void 0)return new f({prv:e.d,curve:e.curve});if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d===void 0)return(ct=new y).setPublic(e.n,e.e),ct;if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p!==void 0&&e.q!==void 0&&e.dp!==void 0&&e.dq!==void 0&&e.co!==void 0&&e.qi===void 0)return(ct=new y).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),ct;if(e.kty===void 0&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p===void 0)return(ct=new y).setPrivate(e.n,e.e,e.d),ct;if(e.p!==void 0&&e.q!==void 0&&e.g!==void 0&&e.y!==void 0&&e.x===void 0)return(ct=new b).setPublic(e.p,e.q,e.g,e.y),ct;if(e.p!==void 0&&e.q!==void 0&&e.g!==void 0&&e.y!==void 0&&e.x!==void 0)return(ct=new b).setPrivate(e.p,e.q,e.g,e.y,e.x),ct;if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d===void 0)return(ct=new y).setPublic(wt(e.n),wt(e.e)),ct;if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0&&e.p!==void 0&&e.q!==void 0&&e.dp!==void 0&&e.dq!==void 0&&e.qi!==void 0)return(ct=new y).setPrivateEx(wt(e.n),wt(e.e),wt(e.d),wt(e.p),wt(e.q),wt(e.dp),wt(e.dq),wt(e.qi)),ct;if(e.kty==="RSA"&&e.n!==void 0&&e.e!==void 0&&e.d!==void 0)return(ct=new y).setPrivate(wt(e.n),wt(e.e),wt(e.d)),ct;if(e.kty==="EC"&&e.crv!==void 0&&e.x!==void 0&&e.y!==void 0&&e.d===void 0){var x=(ot=new f({curve:e.crv})).ecparams.keylen/4,I="04"+("0000000000"+wt(e.x)).slice(-x)+("0000000000"+wt(e.y)).slice(-x);return ot.setPublicKeyHex(I),ot}if(e.kty==="EC"&&e.crv!==void 0&&e.x!==void 0&&e.y!==void 0&&e.d!==void 0){x=(ot=new f({curve:e.crv})).ecparams.keylen/4,I="04"+("0000000000"+wt(e.x)).slice(-x)+("0000000000"+wt(e.y)).slice(-x);var H=("0000000000"+wt(e.d)).slice(-x);return ot.setPublicKeyHex(I),ot.setPrivateKeyHex(H),ot}if(r==="pkcs5prv"){var W,G=e,X=nt;if((W=n(G,0)).length===9)(ct=new y).readPKCS5PrvKeyHex(G);else if(W.length===6)(ct=new b).readPKCS5PrvKeyHex(G);else{if(!(W.length>2&&G.substr(W[1],2)==="04"))throw"unsupported PKCS#1/5 hexadecimal key";(ct=new f).readPKCS5PrvKeyHex(G)}return ct}if(r==="pkcs8prv")return ct=F.getKeyFromPlainPrivatePKCS8Hex(e);if(r==="pkcs8pub")return F._getKeyFromPublicPKCS8Hex(e);if(r==="x509pub")return Lt.getPublicKeyFromCertHex(e);if(e.indexOf("-END CERTIFICATE-",0)!=-1||e.indexOf("-END X509 CERTIFICATE-",0)!=-1||e.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return Lt.getPublicKeyFromCertPEM(e);if(e.indexOf("-END PUBLIC KEY-")!=-1){var g=he(e,"PUBLIC KEY");return F._getKeyFromPublicPKCS8Hex(g)}if(e.indexOf("-END RSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var E=S(e,"RSA PRIVATE KEY");return F.getKey(E,null,"pkcs5prv")}if(e.indexOf("-END DSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1){var R=i(Ft=S(e,"DSA PRIVATE KEY"),0,[1],"02"),D=i(Ft,0,[2],"02"),Y=i(Ft,0,[3],"02"),Q=i(Ft,0,[4],"02"),at=i(Ft,0,[5],"02");return(ct=new b).setPrivate(new V(R,16),new V(D,16),new V(Y,16),new V(Q,16),new V(at,16)),ct}if(e.indexOf("-END EC PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")==-1)return E=S(e,"EC PRIVATE KEY"),F.getKey(E,null,"pkcs5prv");if(e.indexOf("-END PRIVATE KEY-")!=-1)return F.getKeyFromPlainPrivatePKCS8PEM(e);if(e.indexOf("-END RSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var tt=F.getDecryptedKeyHex(e,t),ft=new ht;return ft.readPKCS5PrvKeyHex(tt),ft}if(e.indexOf("-END EC PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var ot,ct=i(Ft=F.getDecryptedKeyHex(e,t),0,[1],"04"),St=i(Ft,0,[2,0],"06"),xt=i(Ft,0,[3,0],"03").substr(2);if(v.crypto.OID.oidhex2name[St]===void 0)throw"undefined OID(hex) in KJUR.crypto.OID: "+St;return(ot=new f({curve:v.crypto.OID.oidhex2name[St]})).setPublicKeyHex(xt),ot.setPrivateKeyHex(ct),ot.isPublic=!1,ot}if(e.indexOf("-END DSA PRIVATE KEY-")!=-1&&e.indexOf("4,ENCRYPTED")!=-1){var Ft;return R=i(Ft=F.getDecryptedKeyHex(e,t),0,[1],"02"),D=i(Ft,0,[2],"02"),Y=i(Ft,0,[3],"02"),Q=i(Ft,0,[4],"02"),at=i(Ft,0,[5],"02"),(ct=new b).setPrivate(new V(R,16),new V(D,16),new V(Y,16),new V(Q,16),new V(at,16)),ct}if(e.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return F.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")},Dt.generateKeypair=function(e,t){if(e=="RSA"){var r=t;(f=new ht).generate(r,"10001"),f.isPrivate=!0,f.isPublic=!0;var n=new ht,i=f.n.toString(16),a=f.e.toString(16);return n.setPublic(i,a),n.isPrivate=!1,n.isPublic=!0,(b={}).prvKeyObj=f,b.pubKeyObj=n,b}if(e=="EC"){var f,b,y=t,S=new v.crypto.ECDSA({curve:y}).generateKeyPairHex();return(f=new v.crypto.ECDSA({curve:y})).setPublicKeyHex(S.ecpubhex),f.setPrivateKeyHex(S.ecprvhex),f.isPrivate=!0,f.isPublic=!1,(n=new v.crypto.ECDSA({curve:y})).setPublicKeyHex(S.ecpubhex),n.isPrivate=!1,n.isPublic=!0,(b={}).prvKeyObj=f,b.pubKeyObj=n,b}throw"unknown algorithm: "+e},Dt.getPEM=function(e,t,r,n,i,a){var f=v,b=f.asn1,y=b.DERObjectIdentifier,S=b.DERInteger,F=b.ASN1Util.newObject,x=b.x509.SubjectPublicKeyInfo,I=f.crypto,H=I.DSA,W=I.ECDSA,G=ht;function X(ot){return F({seq:[{int:0},{int:{bigint:ot.n}},{int:ot.e},{int:{bigint:ot.d}},{int:{bigint:ot.p}},{int:{bigint:ot.q}},{int:{bigint:ot.dmp1}},{int:{bigint:ot.dmq1}},{int:{bigint:ot.coeff}}]})}function g(ot){return F({seq:[{int:1},{octstr:{hex:ot.prvKeyHex}},{tag:["a0",!0,{oid:{name:ot.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ot.pubKeyHex}}]}]})}function E(ot){return F({seq:[{int:0},{int:{bigint:ot.p}},{int:{bigint:ot.q}},{int:{bigint:ot.g}},{int:{bigint:ot.y}},{int:{bigint:ot.x}}]})}if((G!==void 0&&e instanceof G||H!==void 0&&e instanceof H||W!==void 0&&e instanceof W)&&e.isPublic==1&&(t===void 0||t=="PKCS8PUB"))return Zt(Q=new x(e).getEncodedHex(),"PUBLIC KEY");if(t=="PKCS1PRV"&&G!==void 0&&e instanceof G&&(r===void 0||r==null)&&e.isPrivate==1)return Zt(Q=X(e).getEncodedHex(),"RSA PRIVATE KEY");if(t=="PKCS1PRV"&&W!==void 0&&e instanceof W&&(r===void 0||r==null)&&e.isPrivate==1){var R=new y({name:e.curveName}).getEncodedHex(),D=g(e).getEncodedHex(),Y="";return Y+=Zt(R,"EC PARAMETERS"),Y+=Zt(D,"EC PRIVATE KEY")}if(t=="PKCS1PRV"&&H!==void 0&&e instanceof H&&(r===void 0||r==null)&&e.isPrivate==1)return Zt(Q=E(e).getEncodedHex(),"DSA PRIVATE KEY");if(t=="PKCS5PRV"&&G!==void 0&&e instanceof G&&r!==void 0&&r!=null&&e.isPrivate==1){var Q=X(e).getEncodedHex();return n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",Q,r,n,a)}if(t=="PKCS5PRV"&&W!==void 0&&e instanceof W&&r!==void 0&&r!=null&&e.isPrivate==1)return Q=g(e).getEncodedHex(),n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",Q,r,n,a);if(t=="PKCS5PRV"&&H!==void 0&&e instanceof H&&r!==void 0&&r!=null&&e.isPrivate==1)return Q=E(e).getEncodedHex(),n===void 0&&(n="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",Q,r,n,a);var at=function(ct,St){var xt=tt(ct,St);return new F({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:xt.pbkdf2Salt}},{int:xt.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:xt.encryptionSchemeIV}}]}]}]},{octstr:{hex:xt.ciphertext}}]}).getEncodedHex()},tt=function(ct,St){var xt=M.lib.WordArray.random(8),Ft=M.lib.WordArray.random(8),$t=M.PBKDF2(St,xt,{keySize:6,iterations:100}),Kt=M.enc.Hex.parse(ct),Wt=M.TripleDES.encrypt(Kt,$t,{iv:Ft})+"",Rt={};return Rt.ciphertext=Wt,Rt.pbkdf2Salt=M.enc.Hex.stringify(xt),Rt.pbkdf2Iter=100,Rt.encryptionSchemeAlg="DES-EDE3-CBC",Rt.encryptionSchemeIV=M.enc.Hex.stringify(Ft),Rt};if(t=="PKCS8PRV"&&G!=null&&e instanceof G&&e.isPrivate==1){var ft=X(e).getEncodedHex();return Q=F({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:ft}}]}).getEncodedHex(),r===void 0||r==null?Zt(Q,"PRIVATE KEY"):Zt(D=at(Q,r),"ENCRYPTED PRIVATE KEY")}if(t=="PKCS8PRV"&&W!==void 0&&e instanceof W&&e.isPrivate==1)return ft=new F({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]}).getEncodedHex(),Q=F({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:ft}}]}).getEncodedHex(),r===void 0||r==null?Zt(Q,"PRIVATE KEY"):Zt(D=at(Q,r),"ENCRYPTED PRIVATE KEY");if(t=="PKCS8PRV"&&H!==void 0&&e instanceof H&&e.isPrivate==1)return ft=new S({bigint:e.x}).getEncodedHex(),Q=F({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:ft}}]}).getEncodedHex(),r===void 0||r==null?Zt(Q,"PRIVATE KEY"):Zt(D=at(Q,r),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},Dt.getKeyFromCSRPEM=function(e){var t=he(e,"CERTIFICATE REQUEST");return Dt.getKeyFromCSRHex(t)},Dt.getKeyFromCSRHex=function(e){var t=Dt.parseCSRHex(e);return Dt.getKey(t.p8pubkeyhex,null,"pkcs8pub")},Dt.parseCSRHex=function(e){var t=nt,r=t.getChildIdx,n=t.getTLV,i={},a=e;if(a.substr(0,2)!="30")throw"malformed CSR(code:001)";var f=r(a,0);if(f.length<1)throw"malformed CSR(code:002)";if(a.substr(f[0],2)!="30")throw"malformed CSR(code:003)";var b=r(a,f[0]);if(b.length<3)throw"malformed CSR(code:004)";return i.p8pubkeyhex=n(a,b[2]),i},Dt.getKeyID=function(e){var t=Dt,r=nt;typeof e=="string"&&e.indexOf("BEGIN ")!=-1&&(e=t.getKey(e));var n=he(t.getPEM(e)),i=r.getIdxbyList(n,0,[1]),a=r.getV(n,i).substring(2);return v.crypto.Util.hashHex(a,"sha1")},Dt.getJWKFromKey=function(e){var t={};if(e instanceof ht&&e.isPrivate)return t.kty="RSA",t.n=Nt(e.n.toString(16)),t.e=Nt(e.e.toString(16)),t.d=Nt(e.d.toString(16)),t.p=Nt(e.p.toString(16)),t.q=Nt(e.q.toString(16)),t.dp=Nt(e.dmp1.toString(16)),t.dq=Nt(e.dmq1.toString(16)),t.qi=Nt(e.coeff.toString(16)),t;if(e instanceof ht&&e.isPublic)return t.kty="RSA",t.n=Nt(e.n.toString(16)),t.e=Nt(e.e.toString(16)),t;if(e instanceof v.crypto.ECDSA&&e.isPrivate){if((n=e.getShortNISTPCurveName())!=="P-256"&&n!=="P-384")throw"unsupported curve name for JWT: "+n;var r=e.getPublicKeyXYHex();return t.kty="EC",t.crv=n,t.x=Nt(r.x),t.y=Nt(r.y),t.d=Nt(e.prvKeyHex),t}if(e instanceof v.crypto.ECDSA&&e.isPublic){var n;if((n=e.getShortNISTPCurveName())!=="P-256"&&n!=="P-384")throw"unsupported curve name for JWT: "+n;return r=e.getPublicKeyXYHex(),t.kty="EC",t.crv=n,t.x=Nt(r.x),t.y=Nt(r.y),t}throw"not supported key object"},ht.getPosArrayOfChildrenFromHex=function(e){return nt.getChildIdx(e,0)},ht.getHexValueArrayOfChildrenFromHex=function(e){var t,r=nt.getV,n=r(e,(t=ht.getPosArrayOfChildrenFromHex(e))[0]),i=r(e,t[1]),a=r(e,t[2]),f=r(e,t[3]),b=r(e,t[4]),y=r(e,t[5]),S=r(e,t[6]),F=r(e,t[7]),x=r(e,t[8]);return(t=new Array).push(n,i,a,f,b,y,S,F,x),t},ht.prototype.readPrivateKeyFromPEMString=function(e){var t=he(e),r=ht.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},ht.prototype.readPKCS5PrvKeyHex=function(e){var t=ht.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},ht.prototype.readPKCS8PrvKeyHex=function(e){var t,r,n,i,a,f,b,y,S=nt,F=S.getVbyListEx;if(S.isASN1HEX(e)===!1)throw new Error("not ASN.1 hex string");try{t=F(e,0,[2,0,1],"02"),r=F(e,0,[2,0,2],"02"),n=F(e,0,[2,0,3],"02"),i=F(e,0,[2,0,4],"02"),a=F(e,0,[2,0,5],"02"),f=F(e,0,[2,0,6],"02"),b=F(e,0,[2,0,7],"02"),y=F(e,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,r,n,i,a,f,b,y)},ht.prototype.readPKCS5PubKeyHex=function(e){var t=nt,r=t.getV;if(t.isASN1HEX(e)===!1)throw new Error("keyHex is not ASN.1 hex string");var n=t.getChildIdx(e,0);if(n.length!==2||e.substr(n[0],2)!=="02"||e.substr(n[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var i=r(e,n[0]),a=r(e,n[1]);this.setPublic(i,a)},ht.prototype.readPKCS8PubKeyHex=function(e){var t=nt;if(t.isASN1HEX(e)===!1)throw new Error("not ASN.1 hex string");if(t.getTLVbyListEx(e,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var r=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(r)},ht.prototype.readCertPubKeyHex=function(e,t){var r,n;(r=new Lt).readCertHex(e),n=r.getPublicKeyHex(),this.readPKCS8PubKeyHex(n)};var yr=new RegExp("[^0-9a-f]","gi");function ar(e,t){for(var r="",n=t/4-e.length,i=0;i<n;i++)r+="0";return r+e}function ur(e,t,r){for(var n="",i=0;n.length<t;)n+=re(r(ce(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])))),i+=1;return n}function cr(e){for(var t in v.crypto.Util.DIGESTINFOHEAD){var r=v.crypto.Util.DIGESTINFOHEAD[t],n=r.length;if(e.substring(0,n)==r)return[t,e.substring(n)]}return[]}function Lt(e){var t,r=nt,n=r.getChildIdx,i=r.getV,a=r.getTLV,f=r.getVbyList,b=r.getVbyListEx,y=r.getTLVbyList,S=r.getTLVbyListEx,F=r.getIdxbyList,x=r.getIdxbyListEx,I=r.getVidx,H=r.oidname,W=r.hextooidstr,G=Lt,X=he;try{t=v.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){return this.hex===null||this.version!==0?this.version:y(this.hex,0,[0,0])!=="a003020102"?(this.version=1,this.foffset=-1,1):(this.version=3,3)},this.getSerialNumberHex=function(){return b(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var g=S(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(g)},this.getAlgorithmIdentifierName=function(g){for(var E in t)if(g===t[E])return E;return H(b(g,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return y(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return G.hex2dn(this.getIssuerHex())},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return y(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return G.hex2dn(this.getSubjectHex())},this.getNotBefore=function(){var g=f(this.hex,0,[0,4+this.foffset,0]);return g=g.replace(/(..)/g,"%$1"),g=decodeURIComponent(g)},this.getNotAfter=function(){var g=f(this.hex,0,[0,4+this.foffset,1]);return g=g.replace(/(..)/g,"%$1"),g=decodeURIComponent(g)},this.getPublicKeyHex=function(){return r.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return F(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var g=this.getPublicKeyIdx();return F(this.hex,g,[1,0],"30")},this.getPublicKey=function(){return Dt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var g=y(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(g)},this.getSignatureValueHex=function(){return f(this.hex,0,[2],"03",!0)},this.verifySignature=function(g){var E=this.getSignatureAlgorithmField(),R=this.getSignatureValueHex(),D=y(this.hex,0,[0],"30"),Y=new v.crypto.Signature({alg:E});return Y.init(g),Y.updateHex(D),Y.verify(R)},this.parseExt=function(g){var E,R,D;if(g===void 0){if(D=this.hex,this.version!==3)return-1;E=F(D,0,[0,7,0],"30"),R=n(D,E)}else{D=he(g);var Y=F(D,0,[0,3,0,0],"06");if(i(D,Y)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);E=F(D,0,[0,3,0,1,0],"30"),R=n(D,E),this.hex=D}this.aExtInfo=new Array;for(var Q=0;Q<R.length;Q++){var at={critical:!1},tt=0;n(D,R[Q]).length===3&&(at.critical=!0,tt=1),at.oid=r.hextooidstr(f(D,R[Q],[0],"06"));var ft=F(D,R[Q],[1+tt]);at.vidx=I(D,ft),this.aExtInfo.push(at)}},this.getExtInfo=function(g){var E=this.aExtInfo,R=g;if(g.match(/^[0-9.]+$/)||(R=v.asn1.x509.OID.name2oid(g)),R!==""){for(var D=0;D<E.length;D++)if(E[D].oid===R)return E[D]}},this.getExtBasicConstraints=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("basicConstraints");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"basicConstraints"};if(E&&(D.critical=!0),g==="3000")return D;if(g==="30030101ff")return D.cA=!0,D;if(g.substr(0,12)==="30060101ff02"){var Y=i(g,10),Q=parseInt(Y,16);return D.cA=!0,D.pathLen=Q,D}throw new Error("hExtV parse error: "+g)},this.getExtKeyUsage=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("keyUsage");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"keyUsage"};return E&&(D.critical=!0),D.names=this.getExtKeyUsageString(g).split(","),D},this.getExtKeyUsageBin=function(g){if(g===void 0){var E=this.getExtInfo("keyUsage");if(E===void 0)return"";g=a(this.hex,E.vidx)}if(g.length!=8&&g.length!=10)throw new Error("malformed key usage value: "+g);var R="000000000000000"+parseInt(g.substr(6),16).toString(2);return g.length==8&&(R=R.slice(-8)),g.length==10&&(R=R.slice(-16)),(R=R.replace(/0+$/,""))==""&&(R="0"),R},this.getExtKeyUsageString=function(g){for(var E=this.getExtKeyUsageBin(g),R=new Array,D=0;D<E.length;D++)E.substr(D,1)=="1"&&R.push(Lt.KEYUSAGE_NAME[D]);return R.join(",")},this.getExtSubjectKeyIdentifier=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("subjectKeyIdentifier");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"subjectKeyIdentifier"};E&&(D.critical=!0);var Y=i(g,0);return D.kid={hex:Y},D},this.getExtAuthorityKeyIdentifier=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("authorityKeyIdentifier");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"authorityKeyIdentifier"};E&&(D.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var at=g.substr(Y[Q],2);if(at==="80"&&(D.kid={hex:i(g,Y[Q])}),at==="a1"){var tt=a(g,Y[Q]),ft=this.getGeneralNames(tt);D.issuer=ft[0].dn}at==="82"&&(D.sn={hex:i(g,Y[Q])})}return D},this.getExtExtKeyUsage=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("extKeyUsage");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"extKeyUsage",array:[]};E&&(D.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++)D.array.push(H(i(g,Y[Q])));return D},this.getExtExtKeyUsageName=function(){var g=this.getExtInfo("extKeyUsage");if(g===void 0)return g;var E=new Array,R=a(this.hex,g.vidx);if(R==="")return E;for(var D=n(R,0),Y=0;Y<D.length;Y++)E.push(H(i(R,D[Y])));return E},this.getExtSubjectAltName=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("subjectAltName");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"subjectAltName",array:[]};return E&&(D.critical=!0),D.array=this.getGeneralNames(g),D},this.getExtIssuerAltName=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("issuerAltName");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"issuerAltName",array:[]};return E&&(D.critical=!0),D.array=this.getGeneralNames(g),D},this.getGeneralNames=function(g){for(var E=n(g,0),R=[],D=0;D<E.length;D++){var Y=this.getGeneralName(a(g,E[D]));Y!==void 0&&R.push(Y)}return R},this.getGeneralName=function(g){var E=g.substr(0,2),R=i(g,0),D=re(R);return E=="81"?{rfc822:D}:E=="82"?{dns:D}:E=="86"?{uri:D}:E=="87"?{ip:He(R)}:E=="a4"?{dn:this.getX500Name(R)}:void 0},this.getExtSubjectAltName2=function(){var g,E,R,D=this.getExtInfo("subjectAltName");if(D===void 0)return D;for(var Y=new Array,Q=a(this.hex,D.vidx),at=n(Q,0),tt=0;tt<at.length;tt++)R=Q.substr(at[tt],2),g=i(Q,at[tt]),R==="81"&&(E=jt(g),Y.push(["MAIL",E])),R==="82"&&(E=jt(g),Y.push(["DNS",E])),R==="84"&&(E=Lt.hex2dn(g,0),Y.push(["DN",E])),R==="86"&&(E=jt(g),Y.push(["URI",E])),R==="87"&&(E=He(g),Y.push(["IP",E]));return Y},this.getExtCRLDistributionPoints=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("cRLDistributionPoints");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"cRLDistributionPoints",array:[]};E&&(D.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var at=a(g,Y[Q]);D.array.push(this.getDistributionPoint(at))}return D},this.getDistributionPoint=function(g){for(var E={},R=n(g,0),D=0;D<R.length;D++){var Y=g.substr(R[D],2),Q=a(g,R[D]);Y=="a0"&&(E.dpname=this.getDistributionPointName(Q))}return E},this.getDistributionPointName=function(g){for(var E={},R=n(g,0),D=0;D<R.length;D++){var Y=g.substr(R[D],2),Q=a(g,R[D]);Y=="a0"&&(E.full=this.getGeneralNames(Q))}return E},this.getExtCRLDistributionPointsURI=function(){var g=this.getExtInfo("cRLDistributionPoints");if(g===void 0)return g;for(var E=new Array,R=n(this.hex,g.vidx),D=0;D<R.length;D++)try{var Y=jt(f(this.hex,R[D],[0,0,0],"86"));E.push(Y)}catch{}return E},this.getExtAIAInfo=function(){var g=this.getExtInfo("authorityInfoAccess");if(g===void 0)return g;for(var E={ocsp:[],caissuer:[]},R=n(this.hex,g.vidx),D=0;D<R.length;D++){var Y=f(this.hex,R[D],[0],"06"),Q=f(this.hex,R[D],[1],"86");Y==="2b06010505073001"&&E.ocsp.push(jt(Q)),Y==="2b06010505073002"&&E.caissuer.push(jt(Q))}return E},this.getExtAuthorityInfoAccess=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("authorityInfoAccess");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"authorityInfoAccess",array:[]};E&&(D.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var at=b(g,Y[Q],[0],"06"),tt=jt(f(g,Y[Q],[1],"86"));if(at=="2b06010505073001")D.array.push({ocsp:tt});else{if(at!="2b06010505073002")throw new Error("unknown method: "+at);D.array.push({caissuer:tt})}}return D},this.getExtCertificatePolicies=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("certificatePolicies");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"certificatePolicies",array:[]};E&&(D.critical=!0);for(var Y=n(g,0),Q=0;Q<Y.length;Q++){var at=a(g,Y[Q]),tt=this.getPolicyInformation(at);D.array.push(tt)}return D},this.getPolicyInformation=function(g){var E={},R=f(g,0,[0],"06");E.policyoid=H(R);var D=x(g,0,[1],"30");if(D!=-1){E.array=[];for(var Y=n(g,D),Q=0;Q<Y.length;Q++){var at=a(g,Y[Q]),tt=this.getPolicyQualifierInfo(at);E.array.push(tt)}}return E},this.getPolicyQualifierInfo=function(g){var E={},R=f(g,0,[0],"06");if(R==="2b06010505070201"){var D=b(g,0,[1],"16");E.cps=re(D)}else if(R==="2b06010505070202"){var Y=y(g,0,[1],"30");E.unotice=this.getUserNotice(Y)}return E},this.getUserNotice=function(g){for(var E={},R=n(g,0),D=0;D<R.length;D++){var Y=a(g,R[D]);Y.substr(0,2)!="30"&&(E.exptext=this.getDisplayText(Y))}return E},this.getDisplayText=function(g){var E={};return E.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[g.substr(0,2)],E.str=re(i(g,0)),E},this.getExtCRLNumber=function(g,E){var R={extname:"cRLNumber"};if(E&&(R.critical=!0),g.substr(0,2)=="02")return R.num={hex:i(g,0)},R;throw new Error("hExtV parse error: "+g)},this.getExtCRLReason=function(g,E){var R={extname:"cRLReason"};if(E&&(R.critical=!0),g.substr(0,2)=="0a")return R.code=parseInt(i(g,0),16),R;throw new Error("hExtV parse error: "+g)},this.getExtOcspNonce=function(g,E){var R={extname:"ocspNonce"};E&&(R.critical=!0);var D=i(g,0);return R.hex=D,R},this.getExtOcspNoCheck=function(g,E){var R={extname:"ocspNoCheck"};return E&&(R.critical=!0),R},this.getExtAdobeTimeStamp=function(g,E){if(g===void 0&&E===void 0){var R=this.getExtInfo("adobeTimeStamp");if(R===void 0)return;g=a(this.hex,R.vidx),E=R.critical}var D={extname:"adobeTimeStamp"};E&&(D.critical=!0);var Y=n(g,0);if(Y.length>1){var Q=a(g,Y[1]),at=this.getGeneralName(Q);at.uri!=null&&(D.uri=at.uri)}if(Y.length>2){var tt=a(g,Y[2]);tt=="0101ff"&&(D.reqauth=!0),tt=="010100"&&(D.reqauth=!1)}return D},this.getX500NameRule=function(g){for(var E=null,R=[],D=0;D<g.length;D++)for(var Y=g[D],Q=0;Q<Y.length;Q++)R.push(Y[Q]);for(D=0;D<R.length;D++){var at=R[D],tt=at.ds,ft=at.value,ot=at.type;if(tt!="prn"&&tt!="utf8"&&tt!="ia5")return"mixed";if(tt=="ia5"){if(ot!="CN")return"mixed";if(v.lang.String.isMail(ft))continue;return"mixed"}if(ot=="C"){if(tt=="prn")continue;return"mixed"}if(E==null)E=tt;else if(E!==tt)return"mixed"}return E??"prn"},this.getX500Name=function(g){var E=this.getX500NameArray(g);return{array:E,str:this.dnarraytostr(E)}},this.getX500NameArray=function(g){for(var E=[],R=n(g,0),D=0;D<R.length;D++)E.push(this.getRDN(a(g,R[D])));return E},this.getRDN=function(g){for(var E=[],R=n(g,0),D=0;D<R.length;D++)E.push(this.getAttrTypeAndValue(a(g,R[D])));return E},this.getAttrTypeAndValue=function(g){var E={type:null,value:null,ds:null},R=n(g,0),D=f(g,R[0],[],"06"),Y=f(g,R[1],[]),Q=v.asn1.ASN1Util.oidHexToInt(D);return E.type=v.asn1.x509.OID.oid2atype(Q),E.value=re(Y),E.ds=this.HEX2STAG[g.substr(R[1],2)],E},this.readCertPEM=function(g){this.readCertHex(X(g))},this.readCertHex=function(g){this.hex=g,this.getVersion();try{F(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var g={};return g.version=this.getVersion(),g.serial={hex:this.getSerialNumberHex()},g.sigalg=this.getSignatureAlgorithmField(),g.issuer=this.getIssuer(),g.notbefore=this.getNotBefore(),g.notafter=this.getNotAfter(),g.subject=this.getSubject(),g.sbjpubkey=Zt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(g.ext=this.getExtParamArray()),g.sighex=this.getSignatureValueHex(),g},this.getExtParamArray=function(g){g==null&&x(this.hex,0,[0,"[3]"])!=-1&&(g=S(this.hex,0,[0,"[3]",0],"30"));for(var E=[],R=n(g,0),D=0;D<R.length;D++){var Y=a(g,R[D]),Q=this.getExtParam(Y);Q!=null&&E.push(Q)}return E},this.getExtParam=function(g){var E=n(g,0).length;if(E!=2&&E!=3)throw new Error("wrong number elements in Extension: "+E+" "+g);var R=W(f(g,0,[0],"06")),D=!1;E==3&&y(g,0,[1])=="0101ff"&&(D=!0);var Y=y(g,0,[E-1,0]),Q=void 0;if(R=="2.5.29.14"?Q=this.getExtSubjectKeyIdentifier(Y,D):R=="2.5.29.15"?Q=this.getExtKeyUsage(Y,D):R=="2.5.29.17"?Q=this.getExtSubjectAltName(Y,D):R=="2.5.29.18"?Q=this.getExtIssuerAltName(Y,D):R=="2.5.29.19"?Q=this.getExtBasicConstraints(Y,D):R=="2.5.29.31"?Q=this.getExtCRLDistributionPoints(Y,D):R=="2.5.29.32"?Q=this.getExtCertificatePolicies(Y,D):R=="2.5.29.35"?Q=this.getExtAuthorityKeyIdentifier(Y,D):R=="2.5.29.37"?Q=this.getExtExtKeyUsage(Y,D):R=="1.3.6.1.5.5.7.1.1"?Q=this.getExtAuthorityInfoAccess(Y,D):R=="2.5.29.20"?Q=this.getExtCRLNumber(Y,D):R=="2.5.29.21"?Q=this.getExtCRLReason(Y,D):R=="1.3.6.1.5.5.7.48.1.2"?Q=this.getExtOcspNonce(Y,D):R=="1.3.6.1.5.5.7.48.1.5"?Q=this.getExtOcspNoCheck(Y,D):R=="1.2.840.113583.1.1.9.1"&&(Q=this.getExtAdobeTimeStamp(Y,D)),Q!=null)return Q;var at={extname:R,extn:Y};return D&&(at.critical=!0),at},this.findExt=function(g,E){for(var R=0;R<g.length;R++)if(g[R].extname==E)return g[R];return null},this.updateExtCDPFullURI=function(g,E){var R=this.findExt(g,"cRLDistributionPoints");if(R!=null&&R.array!=null){for(var D=R.array,Y=0;Y<D.length;Y++)if(D[Y].dpname!=null&&D[Y].dpname.full!=null)for(var Q=D[Y].dpname.full,at=0;at<Q.length;at++){var tt=Q[Y];tt.uri!=null&&(tt.uri=E)}}},this.updateExtAIAOCSP=function(g,E){var R=this.findExt(g,"authorityInfoAccess");if(R!=null&&R.array!=null)for(var D=R.array,Y=0;Y<D.length;Y++)D[Y].ocsp!=null&&(D[Y].ocsp=E)},this.updateExtAIACAIssuer=function(g,E){var R=this.findExt(g,"authorityInfoAccess");if(R!=null&&R.array!=null)for(var D=R.array,Y=0;Y<D.length;Y++)D[Y].caissuer!=null&&(D[Y].caissuer=E)},this.dnarraytostr=function(g){return"/"+g.map(function(E){return function(D){return D.map(function(Y){return function(at){return at.type+"="+at.value}(Y)}).join("+")}(E)}).join("/")},this.getInfo=function(){var g,E,R,D=function($t){return JSON.stringify($t.array).replace(/[\[\]\{\}\"]/g,"")},Y=function($t){for(var Kt="",Wt=$t.array,Rt=0;Rt<Wt.length;Rt++){var Ut=Wt[Rt];if(Kt+="    policy oid: "+Ut.policyoid+`
`,Ut.array!==void 0)for(var Mt=0;Mt<Ut.array.length;Mt++){var zt=Ut.array[Mt];zt.cps!==void 0&&(Kt+="    cps: "+zt.cps+`
`)}}return Kt},Q=function($t){for(var Kt="",Wt=$t.array,Rt=0;Rt<Wt.length;Rt++){var Ut=Wt[Rt];try{Ut.dpname.full[0].uri!==void 0&&(Kt+="    "+Ut.dpname.full[0].uri+`
`)}catch{}try{Ut.dname.full[0].dn.hex!==void 0&&(Kt+="    "+Lt.hex2dn(Ut.dpname.full[0].dn.hex)+`
`)}catch{}}return Kt},at=function($t){for(var Kt="",Wt=$t.array,Rt=0;Rt<Wt.length;Rt++){var Ut=Wt[Rt];Ut.caissuer!==void 0&&(Kt+="    caissuer: "+Ut.caissuer+`
`),Ut.ocsp!==void 0&&(Kt+="    ocsp: "+Ut.ocsp+`
`)}return Kt};if(g=`Basic Fields
`,g+="  serial number: "+this.getSerialNumberHex()+`
`,g+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,g+="  issuer: "+this.getIssuerString()+`
`,g+="  notBefore: "+this.getNotBefore()+`
`,g+="  notAfter: "+this.getNotAfter()+`
`,g+="  subject: "+this.getSubjectString()+`
`,g+=`  subject public key info: 
`,g+="    key algorithm: "+(E=this.getPublicKey()).type+`
`,E.type==="RSA"&&(g+="    n="+Ve(E.n.toString(16)).substr(0,16)+`...
`,g+="    e="+Ve(E.e.toString(16))+`
`),(R=this.aExtInfo)!=null){g+=`X509v3 Extensions:
`;for(var tt=0;tt<R.length;tt++){var ft=R[tt],ot=v.asn1.x509.OID.oid2name(ft.oid);ot===""&&(ot=ft.oid);var ct="";if(ft.critical===!0&&(ct="CRITICAL"),g+="  "+ot+" "+ct+`:
`,ot==="basicConstraints"){var St=this.getExtBasicConstraints();St.cA===void 0?g+=`    {}
`:(g+="    cA=true",St.pathLen!==void 0&&(g+=", pathLen="+St.pathLen),g+=`
`)}else if(ot==="keyUsage")g+="    "+this.getExtKeyUsageString()+`
`;else if(ot==="subjectKeyIdentifier")g+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ot==="authorityKeyIdentifier"){var xt=this.getExtAuthorityKeyIdentifier();xt.kid!==void 0&&(g+="    kid="+xt.kid.hex+`
`)}else ot==="extKeyUsage"?g+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ot==="subjectAltName"?g+="    "+D(this.getExtSubjectAltName())+`
`:ot==="cRLDistributionPoints"?g+=Q(this.getExtCRLDistributionPoints()):ot==="authorityInfoAccess"?g+=at(this.getExtAuthorityInfoAccess()):ot==="certificatePolicies"&&(g+=Y(this.getExtCertificatePolicies()))}}return g+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,g+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof e=="string"&&(e.indexOf("-----BEGIN")!=-1?this.readCertPEM(e):v.lang.String.isHex(e)&&this.readCertHex(e))}ht.prototype.sign=function(e,t){var r=function(i){return v.crypto.Util.hashString(i,t)}(e);return this.signWithMessageHash(r,t)},ht.prototype.signWithMessageHash=function(e,t){var r=Qt(v.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return ar(this.doPrivate(r).toString(16),this.n.bitLength())},ht.prototype.signPSS=function(e,t,r){var n=function(a){return v.crypto.Util.hashHex(a,t)}(ce(e));return r===void 0&&(r=-1),this.signWithMessageHashPSS(n,t,r)},ht.prototype.signWithMessageHashPSS=function(e,t,r){var n,i=re(e),a=i.length,f=this.n.bitLength()-1,b=Math.ceil(f/8),y=function(g){return v.crypto.Util.hashHex(g,t)};if(r===-1||r===void 0)r=a;else if(r===-2)r=b-a-2;else if(r<-2)throw new Error("invalid salt length");if(b<a+r+2)throw new Error("data too long");var S="";r>0&&(S=new Array(r),new Vt().nextBytes(S),S=String.fromCharCode.apply(String,S));var F=re(y(ce("\0\0\0\0\0\0\0\0"+i+S))),x=[];for(n=0;n<b-r-a-2;n+=1)x[n]=0;var I=String.fromCharCode.apply(String,x)+""+S,H=ur(F,I.length,y),W=[];for(n=0;n<I.length;n+=1)W[n]=I.charCodeAt(n)^H.charCodeAt(n);var G=65280>>8*b-f&255;for(W[0]&=~G,n=0;n<a;n++)W.push(F.charCodeAt(n));return W.push(188),ar(this.doPrivate(new V(W)).toString(16),this.n.bitLength())},ht.prototype.verify=function(e,t){var r=Qt(t=(t=t.replace(yr,"")).replace(/[ \n]+/g,""),16);if(r.bitLength()>this.n.bitLength())return 0;var n=cr(this.doPublic(r).toString(16).replace(/^1f+00/,""));if(n.length==0)return!1;var i=n[0];return n[1]==function(f){return v.crypto.Util.hashString(f,i)}(e)},ht.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var r=Qt(t,16);if(r.bitLength()>this.n.bitLength())return 0;var n=cr(this.doPublic(r).toString(16).replace(/^1f+00/,""));return n.length==0?!1:(n[0],n[1]==e)},ht.prototype.verifyPSS=function(e,t,r,n){var i=function(f){return v.crypto.Util.hashHex(f,r)}(ce(e));return n===void 0&&(n=-1),this.verifyWithMessageHashPSS(i,t,r,n)},ht.prototype.verifyWithMessageHashPSS=function(e,t,r,n){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var i,a=new V(t,16),f=function(R){return v.crypto.Util.hashHex(R,r)},b=re(e),y=b.length,S=this.n.bitLength()-1,F=Math.ceil(S/8);if(n===-1||n===void 0)n=y;else if(n===-2)n=F-y-2;else if(n<-2)throw new Error("invalid salt length");if(F<y+n+2)throw new Error("data too long");var x=this.doPublic(a).toByteArray();for(i=0;i<x.length;i+=1)x[i]&=255;for(;x.length<F;)x.unshift(0);if(x[F-1]!==188)throw new Error("encoded message does not end in 0xbc");var I=(x=String.fromCharCode.apply(String,x)).substr(0,F-y-1),H=x.substr(I.length,y),W=65280>>8*F-S&255;if(I.charCodeAt(0)&W)throw new Error("bits beyond keysize not zero");var G=ur(H,I.length,f),X=[];for(i=0;i<I.length;i+=1)X[i]=I.charCodeAt(i)^G.charCodeAt(i);X[0]&=~W;var g=F-y-n-2;for(i=0;i<g;i+=1)if(X[i]!==0)throw new Error("leftmost octets not zero");if(X[g]!==1)throw new Error("0x01 marker not found");return H===re(f(ce("\0\0\0\0\0\0\0\0"+b+String.fromCharCode.apply(String,X.slice(-n)))))},ht.SALT_LEN_HLEN=-1,ht.SALT_LEN_MAX=-2,ht.SALT_LEN_RECOVER=-2,Lt.hex2dn=function(e,t){if(t===void 0&&(t=0),e.substr(t,2)!=="30")throw new Error("malformed DN");for(var r=new Array,n=nt.getChildIdx(e,t),i=0;i<n.length;i++)r.push(Lt.hex2rdn(e,n[i]));return"/"+(r=r.map(function(a){return a.replace("/","\\/")})).join("/")},Lt.hex2rdn=function(e,t){if(t===void 0&&(t=0),e.substr(t,2)!=="31")throw new Error("malformed RDN");for(var r=new Array,n=nt.getChildIdx(e,t),i=0;i<n.length;i++)r.push(Lt.hex2attrTypeValue(e,n[i]));return(r=r.map(function(a){return a.replace("+","\\+")})).join("+")},Lt.hex2attrTypeValue=function(e,t){var r=nt,n=r.getV;if(t===void 0&&(t=0),e.substr(t,2)!=="30")throw new Error("malformed attribute type and value");var i=r.getChildIdx(e,t);i.length!==2||e.substr(i[0],2);var a=n(e,i[0]),f=v.asn1.ASN1Util.oidHexToInt(a);return v.asn1.x509.OID.oid2atype(f)+"="+re(n(e,i[1]))},Lt.getPublicKeyFromCertHex=function(e){var t=new Lt;return t.readCertHex(e),t.getPublicKey()},Lt.getPublicKeyFromCertPEM=function(e){var t=new Lt;return t.readCertPEM(e),t.getPublicKey()},Lt.getPublicKeyInfoPropOfCertPEM=function(e){var t,r,n=nt.getVbyList,i={};return i.algparam=null,(t=new Lt).readCertPEM(e),r=t.getPublicKeyHex(),i.keyhex=n(r,0,[1],"03").substr(2),i.algoid=n(r,0,[0,0],"06"),i.algoid==="2a8648ce3d0201"&&(i.algparam=n(r,0,[0,1],"06")),i},Lt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],v!==void 0&&v||(p.KJUR=v={}),v.jws!==void 0&&v.jws||(v.jws={}),v.jws.JWS=function(){var e=v.jws.JWS.isSafeJSONString;this.parseJWS=function(t,r){if(this.parsedJWS===void 0||!r&&this.parsedJWS.sigvalH===void 0){var n=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(n==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var i=n[1],a=n[2],f=n[3],b=i+"."+a;if(this.parsedJWS={},this.parsedJWS.headB64U=i,this.parsedJWS.payloadB64U=a,this.parsedJWS.sigvalB64U=f,this.parsedJWS.si=b,!r){var y=wt(f),S=Qt(y,16);this.parsedJWS.sigvalH=y,this.parsedJWS.sigvalBI=S}var F=se(i),x=se(a);if(this.parsedJWS.headS=F,this.parsedJWS.payloadS=x,!e(F,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+F}}},v.jws.JWS.sign=function(e,t,r,n,i){var a,f,b,y=v,S=y.jws.JWS,F=S.readSafeJSONString,x=S.isSafeJSONString,I=y.crypto,H=(I.ECDSA,I.Mac),W=I.Signature,G=JSON;if(typeof t!="string"&&(t===void 0?"undefined":l(t))!="object")throw"spHeader must be JSON string or object: "+t;if((t===void 0?"undefined":l(t))=="object"&&(f=t,a=G.stringify(f)),typeof t=="string"){if(!x(a=t))throw"JWS Head is not safe JSON string: "+a;f=F(a)}if(b=r,(r===void 0?"undefined":l(r))=="object"&&(b=G.stringify(r)),e!=""&&e!=null||f.alg===void 0||(e=f.alg),e!=""&&e!=null&&f.alg===void 0&&(f.alg=e,a=G.stringify(f)),e!==f.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+f.alg;var X=null;if(S.jwsalg2sigalg[e]===void 0)throw"unsupported alg name: "+e;X=S.jwsalg2sigalg[e];var g=Fe(a)+"."+Fe(b),E="";if(X.substr(0,4)=="Hmac"){if(n===void 0)throw"mac key shall be specified for HS* alg";var R=new H({alg:X,prov:"cryptojs",pass:n});R.updateString(g),E=R.doFinal()}else if(X.indexOf("withECDSA")!=-1){(Y=new W({alg:X})).init(n,i),Y.updateString(g);var D=Y.sign();E=v.crypto.ECDSA.asn1SigToConcatSig(D)}else{var Y;X!="none"&&((Y=new W({alg:X})).init(n,i),Y.updateString(g),E=Y.sign())}return g+"."+Nt(E)},v.jws.JWS.verify=function(e,t,r){var n,i=v,a=i.jws.JWS,f=a.readSafeJSONString,b=i.crypto,y=b.ECDSA,S=b.Mac,F=b.Signature;l(ht)!==void 0&&(n=ht);var x=e.split(".");if(x.length!==3)return!1;var I=x[0]+"."+x[1],H=wt(x[2]),W=f(se(x[0])),G=null,X=null;if(W.alg===void 0)throw"algorithm not specified in header";if(X=(G=W.alg).substr(0,2),r!=null&&Object.prototype.toString.call(r)==="[object Array]"&&r.length>0&&(":"+r.join(":")+":").indexOf(":"+G+":")==-1)throw"algorithm '"+G+"' not accepted in the list";if(G!="none"&&t===null)throw"key shall be specified to verify.";if(typeof t=="string"&&t.indexOf("-----BEGIN ")!=-1&&(t=Dt.getKey(t)),!(X!="RS"&&X!="PS"||t instanceof n))throw"key shall be a RSAKey obj for RS* and PS* algs";if(X=="ES"&&!(t instanceof y))throw"key shall be a ECDSA obj for ES* algs";var g=null;if(a.jwsalg2sigalg[W.alg]===void 0)throw"unsupported alg name: "+G;if((g=a.jwsalg2sigalg[G])=="none")throw"not supported";if(g.substr(0,4)=="Hmac"){if(t===void 0)throw"hexadecimal key shall be specified for HMAC";var E=new S({alg:g,pass:t});return E.updateString(I),H==E.doFinal()}if(g.indexOf("withECDSA")!=-1){var R,D=null;try{D=y.concatSigToASN1Sig(H)}catch{return!1}return(R=new F({alg:g})).init(t),R.updateString(I),R.verify(D)}return(R=new F({alg:g})).init(t),R.updateString(I),R.verify(H)},v.jws.JWS.parse=function(e){var t,r,n,i=e.split("."),a={};if(i.length!=2&&i.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return t=i[0],r=i[1],i.length==3&&(n=i[2]),a.headerObj=v.jws.JWS.readSafeJSONString(se(t)),a.payloadObj=v.jws.JWS.readSafeJSONString(se(r)),a.headerPP=JSON.stringify(a.headerObj,null,"  "),a.payloadObj==null?a.payloadPP=se(r):a.payloadPP=JSON.stringify(a.payloadObj,null,"  "),n!==void 0&&(a.sigHex=wt(n)),a},v.jws.JWS.verifyJWT=function(e,t,r){var n=v.jws,i=n.JWS,a=i.readSafeJSONString,f=i.inArray,b=i.includedArray,y=e.split("."),S=y[0],F=y[1],x=(wt(y[2]),a(se(S))),I=a(se(F));if(x.alg===void 0)return!1;if(r.alg===void 0)throw"acceptField.alg shall be specified";if(!f(x.alg,r.alg)||I.iss!==void 0&&l(r.iss)==="object"&&!f(I.iss,r.iss)||I.sub!==void 0&&l(r.sub)==="object"&&!f(I.sub,r.sub))return!1;if(I.aud!==void 0&&l(r.aud)==="object"){if(typeof I.aud=="string"){if(!f(I.aud,r.aud))return!1}else if(l(I.aud)=="object"&&!b(I.aud,r.aud))return!1}var H=n.IntDate.getNow();return r.verifyAt!==void 0&&typeof r.verifyAt=="number"&&(H=r.verifyAt),r.gracePeriod!==void 0&&typeof r.gracePeriod=="number"||(r.gracePeriod=0),!(I.exp!==void 0&&typeof I.exp=="number"&&I.exp+r.gracePeriod<H)&&!(I.nbf!==void 0&&typeof I.nbf=="number"&&H<I.nbf-r.gracePeriod)&&!(I.iat!==void 0&&typeof I.iat=="number"&&H<I.iat-r.gracePeriod)&&(I.jti===void 0||r.jti===void 0||I.jti===r.jti)&&!!i.verify(e,t,r.alg)},v.jws.JWS.includedArray=function(e,t){var r=v.jws.JWS.inArray;if(e===null||(e===void 0?"undefined":l(e))!=="object"||typeof e.length!="number")return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t))return!1;return!0},v.jws.JWS.inArray=function(e,t){if(t===null||(t===void 0?"undefined":l(t))!=="object"||typeof t.length!="number")return!1;for(var r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},v.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},v.jws.JWS.isSafeJSONString=function(e,t,r){var n=null;try{return((n=Xe(e))===void 0?"undefined":l(n))!="object"||n.constructor===Array?0:(t&&(t[r]=n),1)}catch{return 0}},v.jws.JWS.readSafeJSONString=function(e){var t=null;try{return((t=Xe(e))===void 0?"undefined":l(t))!="object"||t.constructor===Array?null:t}catch{return null}},v.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(t==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},v.jws.JWS.getJWKthumbprint=function(e){if(e.kty!=="RSA"&&e.kty!=="EC"&&e.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var t="{";if(e.kty==="RSA"){if(typeof e.n!="string"||typeof e.e!="string")throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if(e.kty==="EC"){if(typeof e.crv!="string"||typeof e.x!="string"||typeof e.y!="string")throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if(e.kty==="oct"){if(typeof e.k!="string")throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var r=ce(t);return Nt(v.crypto.Util.hashHex(r,"sha256"))},v.jws.IntDate={},v.jws.IntDate.get=function(e){var t=v.jws.IntDate,r=t.getNow,n=t.getZulu;if(e=="now")return r();if(e=="now + 1hour")return r()+3600;if(e=="now + 1day")return r()+86400;if(e=="now + 1month")return r()+2592e3;if(e=="now + 1year")return r()+31536e3;if(e.match(/Z$/))return n(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},v.jws.IntDate.getZulu=function(e){return rr(e)},v.jws.IntDate.getNow=function(){return~~(new Date/1e3)},v.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},v.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},p.SecureRandom=Vt,p.rng_seed_time=Z,p.BigInteger=V,p.RSAKey=ht;var mr=v.crypto.EDSA;p.EDSA=mr;var _r=v.crypto.DSA;p.DSA=_r;var Sr=v.crypto.Signature;p.Signature=Sr;var br=v.crypto.MessageDigest;p.MessageDigest=br;var wr=v.crypto.Mac;p.Mac=wr;var Fr=v.crypto.Cipher;p.Cipher=Fr,p.KEYUTIL=Dt,p.ASN1HEX=nt,p.X509=Lt,p.CryptoJS=M,p.b64tohex=et,p.b64toBA=it,p.stoBA=Qe,p.BAtos=Ze,p.BAtohex=Re,p.stohex=fe,p.stob64=function(t){return $(fe(t))},p.stob64u=function(t){return Ie($(fe(t)))},p.b64utos=function(t){return Ze(it(Ee(t)))},p.b64tob64u=Ie,p.b64utob64=Ee,p.hex2b64=$,p.hextob64u=Nt,p.b64utohex=wt,p.utf8tob64u=Fe,p.b64utoutf8=se,p.utf8tob64=function(t){return $(De(Ne(t)))},p.b64toutf8=function(t){return decodeURIComponent(Le(et(t)))},p.utf8tohex=je,p.hextoutf8=jt,p.hextorstr=re,p.rstrtohex=ce,p.hextob64=$e,p.hextob64nl=tr,p.b64nltohex=er,p.hextopem=Zt,p.pemtohex=he,p.hextoArrayBuffer=function(t){if(t.length%2!=0)throw"input is not even length";if(t.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var r=new ArrayBuffer(t.length/2),n=new DataView(r),i=0;i<t.length/2;i++)n.setUint8(i,parseInt(t.substr(2*i,2),16));return r},p.ArrayBuffertohex=function(t){for(var r="",n=new DataView(t),i=0;i<t.byteLength;i++)r+=("00"+n.getUint8(i).toString(16)).slice(-2);return r},p.zulutomsec=Me,p.zulutosec=rr,p.zulutodate=function(t){return new Date(Me(t))},p.datetozulu=function(t,r,n){var i,a=t.getUTCFullYear();if(r){if(a<1950||2049<a)throw"not proper year for UTCTime: "+a;i=(""+a).slice(-2)}else i=("000"+a).slice(-4);if(i+=("0"+(t.getUTCMonth()+1)).slice(-2),i+=("0"+t.getUTCDate()).slice(-2),i+=("0"+t.getUTCHours()).slice(-2),i+=("0"+t.getUTCMinutes()).slice(-2),i+=("0"+t.getUTCSeconds()).slice(-2),n){var f=t.getUTCMilliseconds();f!==0&&(i+="."+(f=(f=("00"+f).slice(-3)).replace(/0+$/g,"")))}return i+="Z"},p.uricmptohex=De,p.hextouricmp=Le,p.ipv6tohex=nr,p.hextoipv6=ir,p.hextoip=He,p.iptohex=function(t){var r="malformed IP address";if(!(t=t.toLowerCase(t)).match(/^[0-9.]+$/)){if(t.match(/^[0-9a-f:]+$/)&&t.indexOf(":")!==-1)return nr(t);throw r}var n=t.split(".");if(n.length!==4)throw r;var i="";try{for(var a=0;a<4;a++)i+=("0"+parseInt(n[a]).toString(16)).slice(-2);return i}catch{throw r}},p.encodeURIComponentAll=Ne,p.newline_toUnix=function(t){return t=t.replace(/\r\n/gm,`
`)},p.newline_toDos=function(t){return t=(t=t.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},p.hextoposhex=Ve,p.intarystrtohex=function(t){t=(t=(t=t.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return t.split(/,/).map(function(r,n,i){var a=parseInt(r);if(a<0||255<a)throw"integer not in range 0-255";return("00"+a.toString(16)).slice(-2)}).join("")}catch(r){throw"malformed integer array string: "+r}},p.strdiffidx=function(t,r){var n=t.length;t.length>r.length&&(n=r.length);for(var i=0;i<n;i++)if(t.charCodeAt(i)!=r.charCodeAt(i))return i;return t.length!=r.length?n:-1},p.KJUR=v;var Er=v.crypto;p.crypto=Er;var xr=v.asn1;p.asn1=xr;var Ar=v.jws;p.jws=Ar;var kr=v.lang;p.lang=kr}).call(this,N(28).Buffer)},function(rt,p,N){(function(P){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var l=N(30),C=N(31),m=N(32);function s(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(U,c){if(s()<c)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(U=new Uint8Array(c)).__proto__=o.prototype:(U===null&&(U=new o(c)),U.length=c),U}function o(U,c,h){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(U,c,h);if(typeof U=="number"){if(typeof c=="string")throw new Error("If encoding is specified then the first argument must be a string");return w(this,U)}return d(this,U,c,h)}function d(U,c,h,L){if(typeof c=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&c instanceof ArrayBuffer?function(J,Z,st,lt){if(Z.byteLength,st<0||Z.byteLength<st)throw new RangeError("'offset' is out of bounds");if(Z.byteLength<st+(lt||0))throw new RangeError("'length' is out of bounds");return Z=st===void 0&&lt===void 0?new Uint8Array(Z):lt===void 0?new Uint8Array(Z,st):new Uint8Array(Z,st,lt),o.TYPED_ARRAY_SUPPORT?(J=Z).__proto__=o.prototype:J=j(J,Z),J}(U,c,h,L):typeof c=="string"?function(J,Z,st){if(typeof st=="string"&&st!==""||(st="utf8"),!o.isEncoding(st))throw new TypeError('"encoding" must be a valid string encoding');var lt=0|A(Z,st),mt=(J=u(J,lt)).write(Z,st);return mt!==lt&&(J=J.slice(0,mt)),J}(U,c,h):function(J,Z){if(o.isBuffer(Z)){var st=0|k(Z.length);return(J=u(J,st)).length===0||Z.copy(J,0,0,st),J}if(Z){if(typeof ArrayBuffer<"u"&&Z.buffer instanceof ArrayBuffer||"length"in Z)return typeof Z.length!="number"||function(mt){return mt!=mt}(Z.length)?u(J,0):j(J,Z);if(Z.type==="Buffer"&&m(Z.data))return j(J,Z.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(U,c)}function T(U){if(typeof U!="number")throw new TypeError('"size" argument must be a number');if(U<0)throw new RangeError('"size" argument must not be negative')}function w(U,c){if(T(c),U=u(U,c<0?0:0|k(c)),!o.TYPED_ARRAY_SUPPORT)for(var h=0;h<c;++h)U[h]=0;return U}function j(U,c){var h=c.length<0?0:0|k(c.length);U=u(U,h);for(var L=0;L<h;L+=1)U[L]=255&c[L];return U}function k(U){if(U>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|U}function A(U,c){if(o.isBuffer(U))return U.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(U)||U instanceof ArrayBuffer))return U.byteLength;typeof U!="string"&&(U=""+U);var h=U.length;if(h===0)return 0;for(var L=!1;;)switch(c){case"ascii":case"latin1":case"binary":return h;case"utf8":case"utf-8":case void 0:return Bt(U).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*h;case"hex":return h>>>1;case"base64":return Xt(U).length;default:if(L)return Bt(U).length;c=(""+c).toLowerCase(),L=!0}}function _(U,c,h){var L=!1;if((c===void 0||c<0)&&(c=0),c>this.length||((h===void 0||h>this.length)&&(h=this.length),h<=0)||(h>>>=0)<=(c>>>=0))return"";for(U||(U="utf8");;)switch(U){case"hex":return te(this,c,h);case"utf8":case"utf-8":return bt(this,c,h);case"ascii":return Ht(this,c,h);case"latin1":case"binary":return kt(this,c,h);case"base64":return ut(this,c,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return It(this,c,h);default:if(L)throw new TypeError("Unknown encoding: "+U);U=(U+"").toLowerCase(),L=!0}}function O(U,c,h){var L=U[c];U[c]=U[h],U[h]=L}function z(U,c,h,L,K){if(U.length===0)return-1;if(typeof h=="string"?(L=h,h=0):h>2147483647?h=2147483647:h<-2147483648&&(h=-2147483648),h=+h,isNaN(h)&&(h=K?0:U.length-1),h<0&&(h=U.length+h),h>=U.length){if(K)return-1;h=U.length-1}else if(h<0){if(!K)return-1;h=0}if(typeof c=="string"&&(c=o.from(c,L)),o.isBuffer(c))return c.length===0?-1:M(U,c,h,L,K);if(typeof c=="number")return c&=255,o.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?K?Uint8Array.prototype.indexOf.call(U,c,h):Uint8Array.prototype.lastIndexOf.call(U,c,h):M(U,[c],h,L,K);throw new TypeError("val must be string, number or Buffer")}function M(U,c,h,L,K){var J,Z=1,st=U.length,lt=c.length;if(L!==void 0&&((L=String(L).toLowerCase())==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(U.length<2||c.length<2)return-1;Z=2,st/=2,lt/=2,h/=2}function mt(Qt,oe){return Z===1?Qt[oe]:Qt.readUInt16BE(oe*Z)}if(K){var pt=-1;for(J=h;J<st;J++)if(mt(U,J)===mt(c,pt===-1?0:J-pt)){if(pt===-1&&(pt=J),J-pt+1===lt)return pt*Z}else pt!==-1&&(J-=J-pt),pt=-1}else for(h+lt>st&&(h=st-lt),J=h;J>=0;J--){for(var Tt=!0,Vt=0;Vt<lt;Vt++)if(mt(U,J+Vt)!==mt(c,Vt)){Tt=!1;break}if(Tt)return J}return-1}function q(U,c,h,L){h=Number(h)||0;var K=U.length-h;L?(L=Number(L))>K&&(L=K):L=K;var J=c.length;if(J%2!=0)throw new TypeError("Invalid hex string");L>J/2&&(L=J/2);for(var Z=0;Z<L;++Z){var st=parseInt(c.substr(2*Z,2),16);if(isNaN(st))return Z;U[h+Z]=st}return Z}function B(U,c,h,L){return Jt(Bt(c,U.length-h),U,h,L)}function $(U,c,h,L){return Jt(function(J){for(var Z=[],st=0;st<J.length;++st)Z.push(255&J.charCodeAt(st));return Z}(c),U,h,L)}function et(U,c,h,L){return $(U,c,h,L)}function it(U,c,h,L){return Jt(Xt(c),U,h,L)}function V(U,c,h,L){return Jt(function(J,Z){for(var st,lt,mt,pt=[],Tt=0;Tt<J.length&&!((Z-=2)<0);++Tt)lt=(st=J.charCodeAt(Tt))>>8,mt=st%256,pt.push(mt),pt.push(lt);return pt}(c,U.length-h),U,h,L)}function ut(U,c,h){return c===0&&h===U.length?l.fromByteArray(U):l.fromByteArray(U.slice(c,h))}function bt(U,c,h){h=Math.min(U.length,h);for(var L=[],K=c;K<h;){var J,Z,st,lt,mt=U[K],pt=null,Tt=mt>239?4:mt>223?3:mt>191?2:1;if(K+Tt<=h)switch(Tt){case 1:mt<128&&(pt=mt);break;case 2:(192&(J=U[K+1]))==128&&(lt=(31&mt)<<6|63&J)>127&&(pt=lt);break;case 3:J=U[K+1],Z=U[K+2],(192&J)==128&&(192&Z)==128&&(lt=(15&mt)<<12|(63&J)<<6|63&Z)>2047&&(lt<55296||lt>57343)&&(pt=lt);break;case 4:J=U[K+1],Z=U[K+2],st=U[K+3],(192&J)==128&&(192&Z)==128&&(192&st)==128&&(lt=(15&mt)<<18|(63&J)<<12|(63&Z)<<6|63&st)>65535&&lt<1114112&&(pt=lt)}pt===null?(pt=65533,Tt=1):pt>65535&&(pt-=65536,L.push(pt>>>10&1023|55296),pt=56320|1023&pt),L.push(pt),K+=Tt}return function(Qt){var oe=Qt.length;if(oe<=Et)return String.fromCharCode.apply(String,Qt);for(var ht="",Ct=0;Ct<oe;)ht+=String.fromCharCode.apply(String,Qt.slice(Ct,Ct+=Et));return ht}(L)}p.Buffer=o,p.SlowBuffer=function(c){return+c!=c&&(c=0),o.alloc(+c)},p.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=P.TYPED_ARRAY_SUPPORT!==void 0?P.TYPED_ARRAY_SUPPORT:function(){try{var c=new Uint8Array(1);return c.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},c.foo()===42&&typeof c.subarray=="function"&&c.subarray(1,1).byteLength===0}catch{return!1}}(),p.kMaxLength=s(),o.poolSize=8192,o._augment=function(U){return U.__proto__=o.prototype,U},o.from=function(U,c,h){return d(null,U,c,h)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(U,c,h){return function(K,J,Z,st){return T(J),J<=0?u(K,J):Z!==void 0?typeof st=="string"?u(K,J).fill(Z,st):u(K,J).fill(Z):u(K,J)}(null,U,c,h)},o.allocUnsafe=function(U){return w(null,U)},o.allocUnsafeSlow=function(U){return w(null,U)},o.isBuffer=function(c){return!(c==null||!c._isBuffer)},o.compare=function(c,h){if(!o.isBuffer(c)||!o.isBuffer(h))throw new TypeError("Arguments must be Buffers");if(c===h)return 0;for(var L=c.length,K=h.length,J=0,Z=Math.min(L,K);J<Z;++J)if(c[J]!==h[J]){L=c[J],K=h[J];break}return L<K?-1:K<L?1:0},o.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(c,h){if(!m(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return o.alloc(0);var L;if(h===void 0)for(h=0,L=0;L<c.length;++L)h+=c[L].length;var K=o.allocUnsafe(h),J=0;for(L=0;L<c.length;++L){var Z=c[L];if(!o.isBuffer(Z))throw new TypeError('"list" argument must be an Array of Buffers');Z.copy(K,J),J+=Z.length}return K},o.byteLength=A,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var c=this.length;if(c%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var h=0;h<c;h+=2)O(this,h,h+1);return this},o.prototype.swap32=function(){var c=this.length;if(c%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var h=0;h<c;h+=4)O(this,h,h+3),O(this,h+1,h+2);return this},o.prototype.swap64=function(){var c=this.length;if(c%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var h=0;h<c;h+=8)O(this,h,h+7),O(this,h+1,h+6),O(this,h+2,h+5),O(this,h+3,h+4);return this},o.prototype.toString=function(){var c=0|this.length;return c===0?"":arguments.length===0?bt(this,0,c):_.apply(this,arguments)},o.prototype.equals=function(c){if(!o.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c||o.compare(this,c)===0},o.prototype.inspect=function(){var c="",h=p.INSPECT_MAX_BYTES;return this.length>0&&(c=this.toString("hex",0,h).match(/.{2}/g).join(" "),this.length>h&&(c+=" ... ")),"<Buffer "+c+">"},o.prototype.compare=function(c,h,L,K,J){if(!o.isBuffer(c))throw new TypeError("Argument must be a Buffer");if(h===void 0&&(h=0),L===void 0&&(L=c?c.length:0),K===void 0&&(K=0),J===void 0&&(J=this.length),h<0||L>c.length||K<0||J>this.length)throw new RangeError("out of range index");if(K>=J&&h>=L)return 0;if(K>=J)return-1;if(h>=L)return 1;if(this===c)return 0;for(var Z=(J>>>=0)-(K>>>=0),st=(L>>>=0)-(h>>>=0),lt=Math.min(Z,st),mt=this.slice(K,J),pt=c.slice(h,L),Tt=0;Tt<lt;++Tt)if(mt[Tt]!==pt[Tt]){Z=mt[Tt],st=pt[Tt];break}return Z<st?-1:st<Z?1:0},o.prototype.includes=function(c,h,L){return this.indexOf(c,h,L)!==-1},o.prototype.indexOf=function(c,h,L){return z(this,c,h,L,!0)},o.prototype.lastIndexOf=function(c,h,L){return z(this,c,h,L,!1)},o.prototype.write=function(c,h,L,K){if(h===void 0)K="utf8",L=this.length,h=0;else if(L===void 0&&typeof h=="string")K=h,L=this.length,h=0;else{if(!isFinite(h))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");h|=0,isFinite(L)?(L|=0,K===void 0&&(K="utf8")):(K=L,L=void 0)}var J=this.length-h;if((L===void 0||L>J)&&(L=J),c.length>0&&(L<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");K||(K="utf8");for(var Z=!1;;)switch(K){case"hex":return q(this,c,h,L);case"utf8":case"utf-8":return B(this,c,h,L);case"ascii":return $(this,c,h,L);case"latin1":case"binary":return et(this,c,h,L);case"base64":return it(this,c,h,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,c,h,L);default:if(Z)throw new TypeError("Unknown encoding: "+K);K=(""+K).toLowerCase(),Z=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Et=4096;function Ht(U,c,h){var L="";h=Math.min(U.length,h);for(var K=c;K<h;++K)L+=String.fromCharCode(127&U[K]);return L}function kt(U,c,h){var L="";h=Math.min(U.length,h);for(var K=c;K<h;++K)L+=String.fromCharCode(U[K]);return L}function te(U,c,h){var L=U.length;(!c||c<0)&&(c=0),(!h||h<0||h>L)&&(h=L);for(var K="",J=c;J<h;++J)K+=ne(U[J]);return K}function It(U,c,h){for(var L=U.slice(c,h),K="",J=0;J<L.length;J+=2)K+=String.fromCharCode(L[J]+256*L[J+1]);return K}function gt(U,c,h){if(U%1!=0||U<0)throw new RangeError("offset is not uint");if(U+c>h)throw new RangeError("Trying to access beyond buffer length")}function dt(U,c,h,L,K,J){if(!o.isBuffer(U))throw new TypeError('"buffer" argument must be a Buffer instance');if(c>K||c<J)throw new RangeError('"value" argument is out of bounds');if(h+L>U.length)throw new RangeError("Index out of range")}function Pt(U,c,h,L){c<0&&(c=65535+c+1);for(var K=0,J=Math.min(U.length-h,2);K<J;++K)U[h+K]=(c&255<<8*(L?K:1-K))>>>8*(L?K:1-K)}function Yt(U,c,h,L){c<0&&(c=4294967295+c+1);for(var K=0,J=Math.min(U.length-h,4);K<J;++K)U[h+K]=c>>>8*(L?K:3-K)&255}function qt(U,c,h,L,K,J){if(h+L>U.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("Index out of range")}function Gt(U,c,h,L,K){return K||qt(U,0,h,4),C.write(U,c,h,L,23,4),h+4}function ee(U,c,h,L,K){return K||qt(U,0,h,8),C.write(U,c,h,L,52,8),h+8}o.prototype.slice=function(c,h){var L,K=this.length;if((c=~~c)<0?(c+=K)<0&&(c=0):c>K&&(c=K),(h=h===void 0?K:~~h)<0?(h+=K)<0&&(h=0):h>K&&(h=K),h<c&&(h=c),o.TYPED_ARRAY_SUPPORT)(L=this.subarray(c,h)).__proto__=o.prototype;else{var J=h-c;L=new o(J,void 0);for(var Z=0;Z<J;++Z)L[Z]=this[Z+c]}return L},o.prototype.readUIntLE=function(c,h,L){c|=0,h|=0,L||gt(c,h,this.length);for(var K=this[c],J=1,Z=0;++Z<h&&(J*=256);)K+=this[c+Z]*J;return K},o.prototype.readUIntBE=function(c,h,L){c|=0,h|=0,L||gt(c,h,this.length);for(var K=this[c+--h],J=1;h>0&&(J*=256);)K+=this[c+--h]*J;return K},o.prototype.readUInt8=function(c,h){return h||gt(c,1,this.length),this[c]},o.prototype.readUInt16LE=function(c,h){return h||gt(c,2,this.length),this[c]|this[c+1]<<8},o.prototype.readUInt16BE=function(c,h){return h||gt(c,2,this.length),this[c]<<8|this[c+1]},o.prototype.readUInt32LE=function(c,h){return h||gt(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+16777216*this[c+3]},o.prototype.readUInt32BE=function(c,h){return h||gt(c,4,this.length),16777216*this[c]+(this[c+1]<<16|this[c+2]<<8|this[c+3])},o.prototype.readIntLE=function(c,h,L){c|=0,h|=0,L||gt(c,h,this.length);for(var K=this[c],J=1,Z=0;++Z<h&&(J*=256);)K+=this[c+Z]*J;return K>=(J*=128)&&(K-=Math.pow(2,8*h)),K},o.prototype.readIntBE=function(c,h,L){c|=0,h|=0,L||gt(c,h,this.length);for(var K=h,J=1,Z=this[c+--K];K>0&&(J*=256);)Z+=this[c+--K]*J;return Z>=(J*=128)&&(Z-=Math.pow(2,8*h)),Z},o.prototype.readInt8=function(c,h){return h||gt(c,1,this.length),128&this[c]?-1*(255-this[c]+1):this[c]},o.prototype.readInt16LE=function(c,h){h||gt(c,2,this.length);var L=this[c]|this[c+1]<<8;return 32768&L?4294901760|L:L},o.prototype.readInt16BE=function(c,h){h||gt(c,2,this.length);var L=this[c+1]|this[c]<<8;return 32768&L?4294901760|L:L},o.prototype.readInt32LE=function(c,h){return h||gt(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},o.prototype.readInt32BE=function(c,h){return h||gt(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},o.prototype.readFloatLE=function(c,h){return h||gt(c,4,this.length),C.read(this,c,!0,23,4)},o.prototype.readFloatBE=function(c,h){return h||gt(c,4,this.length),C.read(this,c,!1,23,4)},o.prototype.readDoubleLE=function(c,h){return h||gt(c,8,this.length),C.read(this,c,!0,52,8)},o.prototype.readDoubleBE=function(c,h){return h||gt(c,8,this.length),C.read(this,c,!1,52,8)},o.prototype.writeUIntLE=function(c,h,L,K){c=+c,h|=0,L|=0,K||dt(this,c,h,L,Math.pow(2,8*L)-1,0);var J=1,Z=0;for(this[h]=255&c;++Z<L&&(J*=256);)this[h+Z]=c/J&255;return h+L},o.prototype.writeUIntBE=function(c,h,L,K){c=+c,h|=0,L|=0,K||dt(this,c,h,L,Math.pow(2,8*L)-1,0);var J=L-1,Z=1;for(this[h+J]=255&c;--J>=0&&(Z*=256);)this[h+J]=c/Z&255;return h+L},o.prototype.writeUInt8=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,1,255,0),o.TYPED_ARRAY_SUPPORT||(c=Math.floor(c)),this[h]=255&c,h+1},o.prototype.writeUInt16LE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[h]=255&c,this[h+1]=c>>>8):Pt(this,c,h,!0),h+2},o.prototype.writeUInt16BE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>8,this[h+1]=255&c):Pt(this,c,h,!1),h+2},o.prototype.writeUInt32LE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[h+3]=c>>>24,this[h+2]=c>>>16,this[h+1]=c>>>8,this[h]=255&c):Yt(this,c,h,!0),h+4},o.prototype.writeUInt32BE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>24,this[h+1]=c>>>16,this[h+2]=c>>>8,this[h+3]=255&c):Yt(this,c,h,!1),h+4},o.prototype.writeIntLE=function(c,h,L,K){if(c=+c,h|=0,!K){var J=Math.pow(2,8*L-1);dt(this,c,h,L,J-1,-J)}var Z=0,st=1,lt=0;for(this[h]=255&c;++Z<L&&(st*=256);)c<0&&lt===0&&this[h+Z-1]!==0&&(lt=1),this[h+Z]=(c/st>>0)-lt&255;return h+L},o.prototype.writeIntBE=function(c,h,L,K){if(c=+c,h|=0,!K){var J=Math.pow(2,8*L-1);dt(this,c,h,L,J-1,-J)}var Z=L-1,st=1,lt=0;for(this[h+Z]=255&c;--Z>=0&&(st*=256);)c<0&&lt===0&&this[h+Z+1]!==0&&(lt=1),this[h+Z]=(c/st>>0)-lt&255;return h+L},o.prototype.writeInt8=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,1,127,-128),o.TYPED_ARRAY_SUPPORT||(c=Math.floor(c)),c<0&&(c=255+c+1),this[h]=255&c,h+1},o.prototype.writeInt16LE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[h]=255&c,this[h+1]=c>>>8):Pt(this,c,h,!0),h+2},o.prototype.writeInt16BE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>8,this[h+1]=255&c):Pt(this,c,h,!1),h+2},o.prototype.writeInt32LE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[h]=255&c,this[h+1]=c>>>8,this[h+2]=c>>>16,this[h+3]=c>>>24):Yt(this,c,h,!0),h+4},o.prototype.writeInt32BE=function(c,h,L){return c=+c,h|=0,L||dt(this,c,h,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),o.TYPED_ARRAY_SUPPORT?(this[h]=c>>>24,this[h+1]=c>>>16,this[h+2]=c>>>8,this[h+3]=255&c):Yt(this,c,h,!1),h+4},o.prototype.writeFloatLE=function(c,h,L){return Gt(this,c,h,!0,L)},o.prototype.writeFloatBE=function(c,h,L){return Gt(this,c,h,!1,L)},o.prototype.writeDoubleLE=function(c,h,L){return ee(this,c,h,!0,L)},o.prototype.writeDoubleBE=function(c,h,L){return ee(this,c,h,!1,L)},o.prototype.copy=function(c,h,L,K){if(L||(L=0),K||K===0||(K=this.length),h>=c.length&&(h=c.length),h||(h=0),K>0&&K<L&&(K=L),K===L||c.length===0||this.length===0)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("sourceStart out of bounds");if(K<0)throw new RangeError("sourceEnd out of bounds");K>this.length&&(K=this.length),c.length-h<K-L&&(K=c.length-h+L);var J,Z=K-L;if(this===c&&L<h&&h<K)for(J=Z-1;J>=0;--J)c[J+h]=this[J+L];else if(Z<1e3||!o.TYPED_ARRAY_SUPPORT)for(J=0;J<Z;++J)c[J+h]=this[J+L];else Uint8Array.prototype.set.call(c,this.subarray(L,L+Z),h);return Z},o.prototype.fill=function(c,h,L,K){if(typeof c=="string"){if(typeof h=="string"?(K=h,h=0,L=this.length):typeof L=="string"&&(K=L,L=this.length),c.length===1){var J=c.charCodeAt(0);J<256&&(c=J)}if(K!==void 0&&typeof K!="string")throw new TypeError("encoding must be a string");if(typeof K=="string"&&!o.isEncoding(K))throw new TypeError("Unknown encoding: "+K)}else typeof c=="number"&&(c&=255);if(h<0||this.length<h||this.length<L)throw new RangeError("Out of range index");if(L<=h)return this;var Z;if(h>>>=0,L=L===void 0?this.length:L>>>0,c||(c=0),typeof c=="number")for(Z=h;Z<L;++Z)this[Z]=c;else{var st=o.isBuffer(c)?c:Bt(new o(c,K).toString()),lt=st.length;for(Z=0;Z<L-h;++Z)this[Z+h]=st[Z%lt]}return this};var le=/[^+\/0-9A-Za-z-_]/g;function ne(U){return U<16?"0"+U.toString(16):U.toString(16)}function Bt(U,c){var h;c=c||1/0;for(var L=U.length,K=null,J=[],Z=0;Z<L;++Z){if((h=U.charCodeAt(Z))>55295&&h<57344){if(!K){if(h>56319){(c-=3)>-1&&J.push(239,191,189);continue}if(Z+1===L){(c-=3)>-1&&J.push(239,191,189);continue}K=h;continue}if(h<56320){(c-=3)>-1&&J.push(239,191,189),K=h;continue}h=65536+(K-55296<<10|h-56320)}else K&&(c-=3)>-1&&J.push(239,191,189);if(K=null,h<128){if((c-=1)<0)break;J.push(h)}else if(h<2048){if((c-=2)<0)break;J.push(h>>6|192,63&h|128)}else if(h<65536){if((c-=3)<0)break;J.push(h>>12|224,h>>6&63|128,63&h|128)}else{if(!(h<1114112))throw new Error("Invalid code point");if((c-=4)<0)break;J.push(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}}return J}function Xt(U){return l.toByteArray(function(h){if((h=function(K){return K.trim?K.trim():K.replace(/^\s+|\s+$/g,"")}(h).replace(le,"")).length<2)return"";for(;h.length%4!=0;)h+="=";return h}(U))}function Jt(U,c,h,L){for(var K=0;K<L&&!(K+h>=c.length||K>=U.length);++K)c[K+h]=U[K];return K}}).call(this,N(29))},function(rt,p){var N;N=function(){return this}();try{N=N||new Function("return this")()}catch{typeof window=="object"&&(N=window)}rt.exports=N},function(rt,p,N){p.byteLength=function(w){var j=o(w),k=j[0],A=j[1];return 3*(k+A)/4-A},p.toByteArray=function(w){var j,k,A=o(w),_=A[0],O=A[1],z=new C(function($,et,it){return 3*(et+it)/4-it}(0,_,O)),M=0,q=O>0?_-4:_;for(k=0;k<q;k+=4)j=l[w.charCodeAt(k)]<<18|l[w.charCodeAt(k+1)]<<12|l[w.charCodeAt(k+2)]<<6|l[w.charCodeAt(k+3)],z[M++]=j>>16&255,z[M++]=j>>8&255,z[M++]=255&j;return O===2&&(j=l[w.charCodeAt(k)]<<2|l[w.charCodeAt(k+1)]>>4,z[M++]=255&j),O===1&&(j=l[w.charCodeAt(k)]<<10|l[w.charCodeAt(k+1)]<<4|l[w.charCodeAt(k+2)]>>2,z[M++]=j>>8&255,z[M++]=255&j),z},p.fromByteArray=function(w){for(var j,k=w.length,A=k%3,_=[],O=16383,z=0,M=k-A;z<M;z+=O)_.push(d(w,z,z+O>M?M:z+O));return A===1?(j=w[k-1],_.push(P[j>>2]+P[j<<4&63]+"==")):A===2&&(j=(w[k-2]<<8)+w[k-1],_.push(P[j>>10]+P[j>>4&63]+P[j<<2&63]+"=")),_.join("")};for(var P=[],l=[],C=typeof Uint8Array<"u"?Uint8Array:Array,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=m.length;s<u;++s)P[s]=m[s],l[m.charCodeAt(s)]=s;function o(T){var w=T.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var j=T.indexOf("=");return j===-1&&(j=w),[j,j===w?0:4-j%4]}function d(T,w,j){for(var k,A,_=[],O=w;O<j;O+=3)k=(T[O]<<16&16711680)+(T[O+1]<<8&65280)+(255&T[O+2]),_.push(P[(A=k)>>18&63]+P[A>>12&63]+P[A>>6&63]+P[63&A]);return _.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(rt,p){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */p.read=function(N,P,l,C,m){var s,u,o=8*m-C-1,d=(1<<o)-1,T=d>>1,w=-7,j=l?m-1:0,k=l?-1:1,A=N[P+j];for(j+=k,s=A&(1<<-w)-1,A>>=-w,w+=o;w>0;s=256*s+N[P+j],j+=k,w-=8);for(u=s&(1<<-w)-1,s>>=-w,w+=C;w>0;u=256*u+N[P+j],j+=k,w-=8);if(s===0)s=1-T;else{if(s===d)return u?NaN:1/0*(A?-1:1);u+=Math.pow(2,C),s-=T}return(A?-1:1)*u*Math.pow(2,s-C)},p.write=function(N,P,l,C,m,s){var u,o,d,T=8*s-m-1,w=(1<<T)-1,j=w>>1,k=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=C?0:s-1,_=C?1:-1,O=P<0||P===0&&1/P<0?1:0;for(P=Math.abs(P),isNaN(P)||P===1/0?(o=isNaN(P)?1:0,u=w):(u=Math.floor(Math.log(P)/Math.LN2),P*(d=Math.pow(2,-u))<1&&(u--,d*=2),(P+=u+j>=1?k/d:k*Math.pow(2,1-j))*d>=2&&(u++,d/=2),u+j>=w?(o=0,u=w):u+j>=1?(o=(P*d-1)*Math.pow(2,m),u+=j):(o=P*Math.pow(2,j-1)*Math.pow(2,m),u=0));m>=8;N[l+A]=255&o,A+=_,o/=256,m-=8);for(u=u<<m|o,T+=m;T>0;N[l+A]=255&u,A+=_,u/=256,T-=8);N[l+A-_]|=128*O}},function(rt,p){var N={}.toString;rt.exports=Array.isArray||function(P){return N.call(P)=="[object Array]"}},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.default=function(C){var m=C.jws,s=C.KeyUtil,u=C.X509,o=C.crypto,d=C.hextob64u,T=C.b64tohex,w=C.AllowedSigningAlgs;return function(){function j(){(function(A,_){if(!(A instanceof _))throw new TypeError("Cannot call a class as a function")})(this,j)}return j.parseJwt=function(A){P.Log.debug("JoseUtil.parseJwt");try{var _=m.JWS.parse(A);return{header:_.headerObj,payload:_.payloadObj}}catch(O){P.Log.error(O)}},j.validateJwt=function(A,_,O,z,M,q,B){P.Log.debug("JoseUtil.validateJwt");try{if(_.kty==="RSA")if(_.e&&_.n)_=s.getKey(_);else{if(!_.x5c||!_.x5c.length)return P.Log.error("JoseUtil.validateJwt: RSA key missing key material",_),Promise.reject(new Error("RSA key missing key material"));var $=T(_.x5c[0]);_=u.getPublicKeyFromCertHex($)}else{if(_.kty!=="EC")return P.Log.error("JoseUtil.validateJwt: Unsupported key type",_&&_.kty),Promise.reject(new Error(_.kty));if(!(_.crv&&_.x&&_.y))return P.Log.error("JoseUtil.validateJwt: EC key missing key material",_),Promise.reject(new Error("EC key missing key material"));_=s.getKey(_)}return j._validateJwt(A,_,O,z,M,q,B)}catch(et){return P.Log.error(et&&et.message||et),Promise.reject("JWT validation failed")}},j.validateJwtAttributes=function(A,_,O,z,M,q){z||(z=0),M||(M=parseInt(Date.now()/1e3));var B=j.parseJwt(A).payload;if(!B.iss)return P.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(B.iss!==_)return P.Log.error("JoseUtil._validateJwt: Invalid issuer in token",B.iss),Promise.reject(new Error("Invalid issuer in token: "+B.iss));if(!B.aud)return P.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(B.aud===O||Array.isArray(B.aud)&&B.aud.indexOf(O)>=0))return P.Log.error("JoseUtil._validateJwt: Invalid audience in token",B.aud),Promise.reject(new Error("Invalid audience in token: "+B.aud));if(B.azp&&B.azp!==O)return P.Log.error("JoseUtil._validateJwt: Invalid azp in token",B.azp),Promise.reject(new Error("Invalid azp in token: "+B.azp));if(!q){var $=M+z,et=M-z;if(!B.iat)return P.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if($<B.iat)return P.Log.error("JoseUtil._validateJwt: iat is in the future",B.iat),Promise.reject(new Error("iat is in the future: "+B.iat));if(B.nbf&&$<B.nbf)return P.Log.error("JoseUtil._validateJwt: nbf is in the future",B.nbf),Promise.reject(new Error("nbf is in the future: "+B.nbf));if(!B.exp)return P.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(B.exp<et)return P.Log.error("JoseUtil._validateJwt: exp is in the past",B.exp),Promise.reject(new Error("exp is in the past:"+B.exp))}return Promise.resolve(B)},j._validateJwt=function(A,_,O,z,M,q,B){return j.validateJwtAttributes(A,O,z,M,q,B).then(function($){try{return m.JWS.verify(A,_,w)?$:(P.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(et){return P.Log.error(et&&et.message||et),Promise.reject(new Error("signature validation failed"))}})},j.hashString=function(A,_){try{return o.Util.hashString(A,_)}catch(O){P.Log.error(O)}},j.hexToBase64Url=function(A){try{return d(A)}catch(_){P.Log.error(_)}},j}()};var P=N(0);rt.exports=p.default},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SigninResponse=void 0;var P=function(){function m(s,u){for(var o=0;o<u.length;o++){var d=u[o];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,d.key,d)}}return function(s,u,o){return u&&m(s.prototype,u),o&&m(s,o),s}}(),l=N(3);function C(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")}p.SigninResponse=function(){function m(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";C(this,m);var o=l.UrlUtility.parseUrlFragment(s,u);this.error=o.error,this.error_description=o.error_description,this.error_uri=o.error_uri,this.code=o.code,this.state=o.state,this.id_token=o.id_token,this.session_state=o.session_state,this.access_token=o.access_token,this.token_type=o.token_type,this.scope=o.scope,this.profile=void 0,this.expires_in=o.expires_in}return P(m,[{key:"expires_in",get:function(){if(this.expires_at){var u=parseInt(Date.now()/1e3);return this.expires_at-u}},set:function(u){var o=parseInt(u);if(typeof o=="number"&&o>0){var d=parseInt(Date.now()/1e3);this.expires_at=d+o}}},{key:"expired",get:function(){var u=this.expires_in;if(u!==void 0)return u<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),m}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SignoutRequest=void 0;var P=N(0),l=N(3),C=N(9);p.SignoutRequest=function m(s){var u=s.url,o=s.id_token_hint,d=s.post_logout_redirect_uri,T=s.data,w=s.extraQueryParams,j=s.request_type;if(function(_,O){if(!(_ instanceof O))throw new TypeError("Cannot call a class as a function")}(this,m),!u)throw P.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var k in o&&(u=l.UrlUtility.addQueryParam(u,"id_token_hint",o)),d&&(u=l.UrlUtility.addQueryParam(u,"post_logout_redirect_uri",d),T&&(this.state=new C.State({data:T,request_type:j}),u=l.UrlUtility.addQueryParam(u,"state",this.state.id))),w)u=l.UrlUtility.addQueryParam(u,k,w[k]);this.url=u}},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SignoutResponse=void 0;var P=N(3);p.SignoutResponse=function l(C){(function(u,o){if(!(u instanceof o))throw new TypeError("Cannot call a class as a function")})(this,l);var m=P.UrlUtility.parseUrlFragment(C,"?");this.error=m.error,this.error_description=m.error_description,this.error_uri=m.error_uri,this.state=m.state}},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.InMemoryWebStorage=void 0;var P=function(){function C(m,s){for(var u=0;u<s.length;u++){var o=s[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}return function(m,s,u){return s&&C(m.prototype,s),u&&C(m,u),m}}(),l=N(0);p.InMemoryWebStorage=function(){function C(){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,C),this._data={}}return C.prototype.getItem=function(s){return l.Log.debug("InMemoryWebStorage.getItem",s),this._data[s]},C.prototype.setItem=function(s,u){l.Log.debug("InMemoryWebStorage.setItem",s),this._data[s]=u},C.prototype.removeItem=function(s){l.Log.debug("InMemoryWebStorage.removeItem",s),delete this._data[s]},C.prototype.key=function(s){return Object.getOwnPropertyNames(this._data)[s]},P(C,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.UserManager=void 0;var P=function(){function O(z,M){for(var q=0;q<M.length;q++){var B=M[q];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}}return function(z,M,q){return M&&O(z.prototype,M),q&&O(z,q),z}}(),l=N(0),C=N(10),m=N(39),s=N(15),u=N(45),o=N(47),d=N(18),T=N(8),w=N(20),j=N(11),k=N(4);function A(O,z){if(!(O instanceof z))throw new TypeError("Cannot call a class as a function")}function _(O,z){if(!O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!z||typeof z!="object"&&typeof z!="function"?O:z}p.UserManager=function(O){function z(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:o.SilentRenewService,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:d.SessionMonitor,$=arguments.length>3&&arguments[3]!==void 0?arguments[3]:w.TokenRevocationClient,et=arguments.length>4&&arguments[4]!==void 0?arguments[4]:j.TokenClient,it=arguments.length>5&&arguments[5]!==void 0?arguments[5]:k.JoseUtil;A(this,z),M instanceof m.UserManagerSettings||(M=new m.UserManagerSettings(M));var V=_(this,O.call(this,M));return V._events=new u.UserManagerEvents(M),V._silentRenewService=new q(V),V.settings.automaticSilentRenew&&(l.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),V.startSilentRenew()),V.settings.monitorSession&&(l.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),V._sessionMonitor=new B(V)),V._tokenRevocationClient=new $(V._settings),V._tokenClient=new et(V._settings),V._joseUtil=it,V}return function(q,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);q.prototype=Object.create(B&&B.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(q,B):q.__proto__=B)}(z,O),z.prototype.getUser=function(){var q=this;return this._loadUser().then(function(B){return B?(l.Log.info("UserManager.getUser: user loaded"),q._events.load(B,!1),B):(l.Log.info("UserManager.getUser: user not found in storage"),null)})},z.prototype.removeUser=function(){var q=this;return this.storeUser(null).then(function(){l.Log.info("UserManager.removeUser: user removed from storage"),q._events.unload()})},z.prototype.signinRedirect=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(q=Object.assign({},q)).request_type="si:r";var B={useReplaceToNavigate:q.useReplaceToNavigate};return this._signinStart(q,this._redirectNavigator,B).then(function(){l.Log.info("UserManager.signinRedirect: successful")})},z.prototype.signinRedirectCallback=function(q){return this._signinEnd(q||this._redirectNavigator.url).then(function(B){return B.profile&&B.profile.sub?l.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",B.profile.sub):l.Log.info("UserManager.signinRedirectCallback: no sub"),B})},z.prototype.signinPopup=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(q=Object.assign({},q)).request_type="si:p";var B=q.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return B?(q.redirect_uri=B,q.display="popup",this._signin(q,this._popupNavigator,{startUrl:B,popupWindowFeatures:q.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:q.popupWindowTarget||this.settings.popupWindowTarget}).then(function($){return $&&($.profile&&$.profile.sub?l.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",$.profile.sub):l.Log.info("UserManager.signinPopup: no sub")),$})):(l.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},z.prototype.signinPopupCallback=function(q){return this._signinCallback(q,this._popupNavigator).then(function(B){return B&&(B.profile&&B.profile.sub?l.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",B.profile.sub):l.Log.info("UserManager.signinPopupCallback: no sub")),B}).catch(function(B){l.Log.error(B.message)})},z.prototype.signinSilent=function(){var q=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return B=Object.assign({},B),this._loadUser().then(function($){return $&&$.refresh_token?(B.refresh_token=$.refresh_token,q._useRefreshToken(B)):(B.request_type="si:s",B.id_token_hint=B.id_token_hint||q.settings.includeIdTokenInSilentRenew&&$&&$.id_token,$&&q._settings.validateSubOnSilentRenew&&(l.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",$.profile.sub),B.current_sub=$.profile.sub),q._signinSilentIframe(B))})},z.prototype._useRefreshToken=function(){var q=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(B).then(function($){return $?$.access_token?q._loadUser().then(function(et){if(et){var it=Promise.resolve();return $.id_token&&(it=q._validateIdTokenFromTokenRefreshToken(et.profile,$.id_token)),it.then(function(){return l.Log.debug("UserManager._useRefreshToken: refresh token response success"),et.id_token=$.id_token||et.id_token,et.access_token=$.access_token,et.refresh_token=$.refresh_token||et.refresh_token,et.expires_in=$.expires_in,q.storeUser(et).then(function(){return q._events.load(et),et})})}return null}):(l.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(l.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},z.prototype._validateIdTokenFromTokenRefreshToken=function(q,B){var $=this;return this._metadataService.getIssuer().then(function(et){return $.settings.getEpochTime().then(function(it){return $._joseUtil.validateJwtAttributes(B,et,$._settings.client_id,$._settings.clockSkew,it).then(function(V){return V?V.sub!==q.sub?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):V.auth_time&&V.auth_time!==q.auth_time?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):V.azp&&V.azp!==q.azp?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!V.azp&&q.azp?(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(l.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},z.prototype._signinSilentIframe=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=q.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return B?(q.redirect_uri=B,q.prompt=q.prompt||"none",this._signin(q,this._iframeNavigator,{startUrl:B,silentRequestTimeout:q.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function($){return $&&($.profile&&$.profile.sub?l.Log.info("UserManager.signinSilent: successful, signed in sub: ",$.profile.sub):l.Log.info("UserManager.signinSilent: no sub")),$})):(l.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},z.prototype.signinSilentCallback=function(q){return this._signinCallback(q,this._iframeNavigator).then(function(B){return B&&(B.profile&&B.profile.sub?l.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",B.profile.sub):l.Log.info("UserManager.signinSilentCallback: no sub")),B})},z.prototype.signinCallback=function(q){var B=this;return this.readSigninResponseState(q).then(function($){var et=$.state;return $.response,et.request_type==="si:r"?B.signinRedirectCallback(q):et.request_type==="si:p"?B.signinPopupCallback(q):et.request_type==="si:s"?B.signinSilentCallback(q):Promise.reject(new Error("invalid response_type in state"))})},z.prototype.signoutCallback=function(q,B){var $=this;return this.readSignoutResponseState(q).then(function(et){var it=et.state,V=et.response;return it?it.request_type==="so:r"?$.signoutRedirectCallback(q):it.request_type==="so:p"?$.signoutPopupCallback(q,B):Promise.reject(new Error("invalid response_type in state")):V})},z.prototype.querySessionStatus=function(){var q=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(B=Object.assign({},B)).request_type="si:s";var $=B.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return $?(B.redirect_uri=$,B.prompt="none",B.response_type=B.response_type||this.settings.query_status_response_type,B.scope=B.scope||"openid",B.skipUserInfo=!0,this._signinStart(B,this._iframeNavigator,{startUrl:$,silentRequestTimeout:B.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(et){return q.processSigninResponse(et.url).then(function(it){if(l.Log.debug("UserManager.querySessionStatus: got signin response"),it.session_state&&it.profile.sub)return l.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",it.profile.sub),{session_state:it.session_state,sub:it.profile.sub,sid:it.profile.sid};l.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(it){if(it.session_state&&q.settings.monitorAnonymousSession&&(it.message=="login_required"||it.message=="consent_required"||it.message=="interaction_required"||it.message=="account_selection_required"))return l.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:it.session_state};throw it})})):(l.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},z.prototype._signin=function(q,B){var $=this,et=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(q,B,et).then(function(it){return $._signinEnd(it.url,q)})},z.prototype._signinStart=function(q,B){var $=this,et=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return B.prepare(et).then(function(it){return l.Log.debug("UserManager._signinStart: got navigator window handle"),$.createSigninRequest(q).then(function(V){return l.Log.debug("UserManager._signinStart: got signin request"),et.url=V.url,et.id=V.state.id,it.navigate(et)}).catch(function(V){throw it.close&&(l.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),it.close()),V})})},z.prototype._signinEnd=function(q){var B=this,$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(q).then(function(et){l.Log.debug("UserManager._signinEnd: got signin response");var it=new s.User(et);if($.current_sub){if($.current_sub!==it.profile.sub)return l.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",it.profile.sub),Promise.reject(new Error("login_required"));l.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return B.storeUser(it).then(function(){return l.Log.debug("UserManager._signinEnd: user stored"),B._events.load(it),it})})},z.prototype._signinCallback=function(q,B){l.Log.debug("UserManager._signinCallback");var $=this._settings.response_mode==="query"||!this._settings.response_mode&&T.SigninRequest.isCode(this._settings.response_type)?"?":"#";return B.callback(q,void 0,$)},z.prototype.signoutRedirect=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(q=Object.assign({},q)).request_type="so:r";var B=q.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;B&&(q.post_logout_redirect_uri=B);var $={useReplaceToNavigate:q.useReplaceToNavigate};return this._signoutStart(q,this._redirectNavigator,$).then(function(){l.Log.info("UserManager.signoutRedirect: successful")})},z.prototype.signoutRedirectCallback=function(q){return this._signoutEnd(q||this._redirectNavigator.url).then(function(B){return l.Log.info("UserManager.signoutRedirectCallback: successful"),B})},z.prototype.signoutPopup=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(q=Object.assign({},q)).request_type="so:p";var B=q.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return q.post_logout_redirect_uri=B,q.display="popup",q.post_logout_redirect_uri&&(q.state=q.state||{}),this._signout(q,this._popupNavigator,{startUrl:B,popupWindowFeatures:q.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:q.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){l.Log.info("UserManager.signoutPopup: successful")})},z.prototype.signoutPopupCallback=function(q,B){return B===void 0&&typeof q=="boolean"&&(B=q,q=null),this._popupNavigator.callback(q,B,"?").then(function(){l.Log.info("UserManager.signoutPopupCallback: successful")})},z.prototype._signout=function(q,B){var $=this,et=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(q,B,et).then(function(it){return $._signoutEnd(it.url)})},z.prototype._signoutStart=function(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=this,$=arguments[1],et=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return $.prepare(et).then(function(it){return l.Log.debug("UserManager._signoutStart: got navigator window handle"),B._loadUser().then(function(V){return l.Log.debug("UserManager._signoutStart: loaded current user from storage"),(B._settings.revokeAccessTokenOnSignout?B._revokeInternal(V):Promise.resolve()).then(function(){var ut=q.id_token_hint||V&&V.id_token;return ut&&(l.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),q.id_token_hint=ut),B.removeUser().then(function(){return l.Log.debug("UserManager._signoutStart: user removed, creating signout request"),B.createSignoutRequest(q).then(function(bt){return l.Log.debug("UserManager._signoutStart: got signout request"),et.url=bt.url,bt.state&&(et.id=bt.state.id),it.navigate(et)})})})}).catch(function(V){throw it.close&&(l.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),it.close()),V})})},z.prototype._signoutEnd=function(q){return this.processSignoutResponse(q).then(function(B){return l.Log.debug("UserManager._signoutEnd: got signout response"),B})},z.prototype.revokeAccessToken=function(){var q=this;return this._loadUser().then(function(B){return q._revokeInternal(B,!0).then(function($){if($)return l.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),B.access_token=null,B.refresh_token=null,B.expires_at=null,B.token_type=null,q.storeUser(B).then(function(){l.Log.debug("UserManager.revokeAccessToken: user stored"),q._events.load(B)})})}).then(function(){l.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},z.prototype._revokeInternal=function(q,B){var $=this;if(q){var et=q.access_token,it=q.refresh_token;return this._revokeAccessTokenInternal(et,B).then(function(V){return $._revokeRefreshTokenInternal(it,B).then(function(ut){return V||ut||l.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),V||ut})})}return Promise.resolve(!1)},z.prototype._revokeAccessTokenInternal=function(q,B){return!q||q.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(q,B).then(function(){return!0})},z.prototype._revokeRefreshTokenInternal=function(q,B){return q?this._tokenRevocationClient.revoke(q,B,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},z.prototype.startSilentRenew=function(){this._silentRenewService.start()},z.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},z.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(q){return q?(l.Log.debug("UserManager._loadUser: user storageString loaded"),s.User.fromStorageString(q)):(l.Log.debug("UserManager._loadUser: no user storageString"),null)})},z.prototype.storeUser=function(q){if(q){l.Log.debug("UserManager.storeUser: storing user");var B=q.toStorageString();return this._userStore.set(this._userStoreKey,B)}return l.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},P(z,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),z}(C.OidcClient)},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.UserManagerSettings=void 0;var P=function(){function j(k,A){for(var _=0;_<A.length;_++){var O=A[_];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(k,O.key,O)}}return function(k,A,_){return A&&j(k.prototype,A),_&&j(k,_),k}}(),l=(N(0),N(5)),C=N(40),m=N(41),s=N(43),u=N(6),o=N(1),d=N(8);function T(j,k){if(!(j instanceof k))throw new TypeError("Cannot call a class as a function")}function w(j,k){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!k||typeof k!="object"&&typeof k!="function"?j:k}p.UserManagerSettings=function(j){function k(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=A.popup_redirect_uri,O=A.popup_post_logout_redirect_uri,z=A.popupWindowFeatures,M=A.popupWindowTarget,q=A.silent_redirect_uri,B=A.silentRequestTimeout,$=A.automaticSilentRenew,et=$!==void 0&&$,it=A.validateSubOnSilentRenew,V=it!==void 0&&it,ut=A.includeIdTokenInSilentRenew,bt=ut===void 0||ut,Et=A.monitorSession,Ht=Et===void 0||Et,kt=A.monitorAnonymousSession,te=kt!==void 0&&kt,It=A.checkSessionInterval,gt=It===void 0?2e3:It,dt=A.stopCheckSessionOnError,Pt=dt===void 0||dt,Yt=A.query_status_response_type,qt=A.revokeAccessTokenOnSignout,Gt=qt!==void 0&&qt,ee=A.accessTokenExpiringNotificationTime,le=ee===void 0?60:ee,ne=A.redirectNavigator,Bt=ne===void 0?new C.RedirectNavigator:ne,Xt=A.popupNavigator,Jt=Xt===void 0?new m.PopupNavigator:Xt,U=A.iframeNavigator,c=U===void 0?new s.IFrameNavigator:U,h=A.userStore,L=h===void 0?new u.WebStorageStateStore({store:o.Global.sessionStorage}):h;T(this,k);var K=w(this,j.call(this,arguments[0]));return K._popup_redirect_uri=_,K._popup_post_logout_redirect_uri=O,K._popupWindowFeatures=z,K._popupWindowTarget=M,K._silent_redirect_uri=q,K._silentRequestTimeout=B,K._automaticSilentRenew=et,K._validateSubOnSilentRenew=V,K._includeIdTokenInSilentRenew=bt,K._accessTokenExpiringNotificationTime=le,K._monitorSession=Ht,K._monitorAnonymousSession=te,K._checkSessionInterval=gt,K._stopCheckSessionOnError=Pt,Yt?K._query_status_response_type=Yt:arguments[0]&&arguments[0].response_type?K._query_status_response_type=d.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":K._query_status_response_type="id_token",K._revokeAccessTokenOnSignout=Gt,K._redirectNavigator=Bt,K._popupNavigator=Jt,K._iframeNavigator=c,K._userStore=L,K}return function(_,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof O);_.prototype=Object.create(O&&O.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(_,O):_.__proto__=O)}(k,j),P(k,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),k}(l.OidcClientSettings)},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.RedirectNavigator=void 0;var P=function(){function C(m,s){for(var u=0;u<s.length;u++){var o=s[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}return function(m,s,u){return s&&C(m.prototype,s),u&&C(m,u),m}}(),l=N(0);p.RedirectNavigator=function(){function C(){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,C)}return C.prototype.prepare=function(){return Promise.resolve(this)},C.prototype.navigate=function(s){return s&&s.url?(s.useReplaceToNavigate?window.location.replace(s.url):window.location=s.url,Promise.resolve()):(l.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},P(C,[{key:"url",get:function(){return window.location.href}}]),C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.PopupNavigator=void 0;var P=N(0),l=N(42);p.PopupNavigator=function(){function C(){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,C)}return C.prototype.prepare=function(s){var u=new l.PopupWindow(s);return Promise.resolve(u)},C.prototype.callback=function(s,u,o){P.Log.debug("PopupNavigator.callback");try{return l.PopupWindow.notifyOpener(s,u,o),Promise.resolve()}catch(d){return Promise.reject(d)}},C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.PopupWindow=void 0;var P=function(){function m(s,u){for(var o=0;o<u.length;o++){var d=u[o];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,d.key,d)}}return function(s,u,o){return u&&m(s.prototype,u),o&&m(s,o),s}}(),l=N(0),C=N(3);p.PopupWindow=function(){function m(s){var u=this;(function(w,j){if(!(w instanceof j))throw new TypeError("Cannot call a class as a function")})(this,m),this._promise=new Promise(function(T,w){u._resolve=T,u._reject=w});var o=s.popupWindowTarget||"_blank",d=s.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",o,d),this._popup&&(l.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return m.prototype.navigate=function(u){return this._popup?u&&u.url?(l.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=u.id,this._id&&(window["popupCallback_"+u.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=u.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},m.prototype._success=function(u){l.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(u)},m.prototype._error=function(u){l.Log.error("PopupWindow.error: ",u),this._cleanup(),this._reject(new Error(u))},m.prototype.close=function(){this._cleanup(!1)},m.prototype._cleanup=function(u){l.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!u&&this._popup.close(),this._popup=null},m.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},m.prototype._callback=function(u,o){this._cleanup(o),u?(l.Log.debug("PopupWindow.callback success"),this._success({url:u})):(l.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},m.notifyOpener=function(u,o,d){if(window.opener){if(u=u||window.location.href){var T=C.UrlUtility.parseUrlFragment(u,d);if(T.state){var w="popupCallback_"+T.state,j=window.opener[w];j?(l.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),j(u,o)):l.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else l.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else l.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},P(m,[{key:"promise",get:function(){return this._promise}}]),m}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.IFrameNavigator=void 0;var P=N(0),l=N(44);p.IFrameNavigator=function(){function C(){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,C)}return C.prototype.prepare=function(s){var u=new l.IFrameWindow(s);return Promise.resolve(u)},C.prototype.callback=function(s){P.Log.debug("IFrameNavigator.callback");try{return l.IFrameWindow.notifyParent(s),Promise.resolve()}catch(u){return Promise.reject(u)}},C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.IFrameWindow=void 0;var P=function(){function C(m,s){for(var u=0;u<s.length;u++){var o=s[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}return function(m,s,u){return s&&C(m.prototype,s),u&&C(m,u),m}}(),l=N(0);p.IFrameWindow=function(){function C(m){var s=this;(function(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")})(this,C),this._promise=new Promise(function(u,o){s._resolve=u,s._reject=o}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return C.prototype.navigate=function(s){if(s&&s.url){var u=s.silentRequestTimeout||1e4;l.Log.debug("IFrameWindow.navigate: Using timeout of:",u),this._timer=window.setTimeout(this._timeout.bind(this),u),this._frame.src=s.url}else this._error("No url provided");return this.promise},C.prototype._success=function(s){this._cleanup(),l.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(s)},C.prototype._error=function(s){this._cleanup(),l.Log.error(s),this._reject(new Error(s))},C.prototype.close=function(){this._cleanup()},C.prototype._cleanup=function(){this._frame&&(l.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},C.prototype._timeout=function(){l.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},C.prototype._message=function(s){if(l.Log.debug("IFrameWindow.message"),this._timer&&s.origin===this._origin&&s.source===this._frame.contentWindow&&typeof s.data=="string"&&(s.data.startsWith("http://")||s.data.startsWith("https://"))){var u=s.data;u?this._success({url:u}):this._error("Invalid response from frame")}},C.notifyParent=function(s){l.Log.debug("IFrameWindow.notifyParent"),(s=s||window.location.href)&&(l.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(s,location.protocol+"//"+location.host))},P(C,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),C}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.UserManagerEvents=void 0;var P=N(0),l=N(16),C=N(17);p.UserManagerEvents=function(m){function s(u){(function(T,w){if(!(T instanceof w))throw new TypeError("Cannot call a class as a function")})(this,s);var o=function(T,w){if(!T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!w||typeof w!="object"&&typeof w!="function"?T:w}(this,m.call(this,u));return o._userLoaded=new C.Event("User loaded"),o._userUnloaded=new C.Event("User unloaded"),o._silentRenewError=new C.Event("Silent renew error"),o._userSignedIn=new C.Event("User signed in"),o._userSignedOut=new C.Event("User signed out"),o._userSessionChanged=new C.Event("User session changed"),o}return function(o,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);o.prototype=Object.create(d&&d.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(o,d):o.__proto__=d)}(s,m),s.prototype.load=function(o){var d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];P.Log.debug("UserManagerEvents.load"),m.prototype.load.call(this,o),d&&this._userLoaded.raise(o)},s.prototype.unload=function(){P.Log.debug("UserManagerEvents.unload"),m.prototype.unload.call(this),this._userUnloaded.raise()},s.prototype.addUserLoaded=function(o){this._userLoaded.addHandler(o)},s.prototype.removeUserLoaded=function(o){this._userLoaded.removeHandler(o)},s.prototype.addUserUnloaded=function(o){this._userUnloaded.addHandler(o)},s.prototype.removeUserUnloaded=function(o){this._userUnloaded.removeHandler(o)},s.prototype.addSilentRenewError=function(o){this._silentRenewError.addHandler(o)},s.prototype.removeSilentRenewError=function(o){this._silentRenewError.removeHandler(o)},s.prototype._raiseSilentRenewError=function(o){P.Log.debug("UserManagerEvents._raiseSilentRenewError",o.message),this._silentRenewError.raise(o)},s.prototype.addUserSignedIn=function(o){this._userSignedIn.addHandler(o)},s.prototype.removeUserSignedIn=function(o){this._userSignedIn.removeHandler(o)},s.prototype._raiseUserSignedIn=function(){P.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},s.prototype.addUserSignedOut=function(o){this._userSignedOut.addHandler(o)},s.prototype.removeUserSignedOut=function(o){this._userSignedOut.removeHandler(o)},s.prototype._raiseUserSignedOut=function(){P.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},s.prototype.addUserSessionChanged=function(o){this._userSessionChanged.addHandler(o)},s.prototype.removeUserSessionChanged=function(o){this._userSessionChanged.removeHandler(o)},s.prototype._raiseUserSessionChanged=function(){P.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},s}(l.AccessTokenEvents)},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.Timer=void 0;var P=function(){function o(d,T){for(var w=0;w<T.length;w++){var j=T[w];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(d,j.key,j)}}return function(d,T,w){return T&&o(d.prototype,T),w&&o(d,w),d}}(),l=N(0),C=N(1),m=N(17);function s(o,d){if(!(o instanceof d))throw new TypeError("Cannot call a class as a function")}function u(o,d){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||typeof d!="object"&&typeof d!="function"?o:d}p.Timer=function(o){function d(T){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.Global.timer,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;s(this,d);var k=u(this,o.call(this,T));return k._timer=w,k._nowFunc=j||function(){return Date.now()/1e3},k}return function(w,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);w.prototype=Object.create(j&&j.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(w,j):w.__proto__=j)}(d,o),d.prototype.init=function(w){w<=0&&(w=1),w=parseInt(w);var j=this.now+w;if(this.expiration===j&&this._timerHandle)l.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),l.Log.debug("Timer.init timer "+this._name+" for duration:",w),this._expiration=j;var k=5;w<k&&(k=w),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*k)}},d.prototype.cancel=function(){this._timerHandle&&(l.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},d.prototype._callback=function(){var w=this._expiration-this.now;l.Log.debug("Timer.callback; "+this._name+" timer expires in:",w),this._expiration<=this.now&&(this.cancel(),o.prototype.raise.call(this))},P(d,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),d}(m.Event)},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.SilentRenewService=void 0;var P=N(0);p.SilentRenewService=function(){function l(C){(function(s,u){if(!(s instanceof u))throw new TypeError("Cannot call a class as a function")})(this,l),this._userManager=C}return l.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(m){}).catch(function(m){P.Log.error("SilentRenewService.start: Error from getUser:",m.message)}))},l.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},l.prototype._tokenExpiring=function(){var m=this;this._userManager.signinSilent().then(function(s){P.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(s){P.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",s.message),m._userManager.events._raiseSilentRenewError(s)})},l}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.CordovaPopupNavigator=void 0;var P=N(21);p.CordovaPopupNavigator=function(){function l(){(function(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(m){var s=new P.CordovaPopupWindow(m);return Promise.resolve(s)},l}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.CordovaIFrameNavigator=void 0;var P=N(21);p.CordovaIFrameNavigator=function(){function l(){(function(m,s){if(!(m instanceof s))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.prepare=function(m){m.popupWindowFeatures="hidden=yes";var s=new P.CordovaPopupWindow(m);return Promise.resolve(s)},l}()},function(rt,p,N){Object.defineProperty(p,"__esModule",{value:!0}),p.Version="1.11.5"}])})})(vr);var Yr=vr.exports;const Gr=zr(Yr);function Xr(vt){let _t;const rt=vt[7].default,p=Dr(rt,vt,vt[6],null);return{c(){p&&p.c()},l(N){p&&p.l(N)},m(N,P){p&&p.m(N,P),_t=!0},p(N,[P]){p&&p.p&&(!_t||P&64)&&Lr(p,rt,N,N[6],_t?Ur(rt,N[6],P,null):Nr(N[6]),null)},i(N){_t||(Kr(p,N),_t=!0)},o(N){qr(p,N),_t=!1},d(N){p&&p.d(N)}}}const Qr=_e(!0),Ye=_e(!1),fr=_e(""),gr=_e(""),dr=_e({}),Be=_e(null),Zr={},$r={},tn={};async function en(vt){try{return await(await vt).signinSilent(),!0}catch(_t){return Be.set(_t.message),!1}}async function cn(vt,_t=!0,rt=null){const p=await vt,N=rt||window.location.href,P=_t?{pathname:window.location.pathname,search:window.location.search}:{};await p.signinRedirect({redirect_uri:N,appState:P})}async function hn(vt,_t=null){const rt=await vt,p=_t||window.location.href;rt.signoutRedirect({returnTo:p});try{const N=await rt.signoutRedirect({returnTo:p})}catch(N){if(N.message!=="no end session endpoint")throw N;const P=rt._settings._authority;if(P.endsWith("auth0.com")){const l=rt._settings._client_id,C=`${P}/v2/logout?client_id=${l}&returnTo=${encodeURIComponent(p)}`;window.location=C}else throw N}}async function rn(){}function nn(vt,_t,rt){let p,N=Mr;Or(vt,Ye,_=>rt(8,p=_)),vt.$$.on_destroy.push(()=>N());let{$$slots:P={},$$scope:l}=_t,{issuer:C}=_t,{client_id:m}=_t,{redirect_uri:s}=_t,{post_logout_redirect_uri:u}=_t,{extraOptions:o={}}=_t,{scope:d="openid profile email"}=_t;We($r,s),We(tn,u);const T={authority:C,client_id:m,redirect_uri:s,post_logout_redirect_uri:u,response_type:"code",scope:d,automaticSilentRenew:!0,...o},w=new Gr.UserManager(T);w.events.addUserLoaded(function(_){Ye.set(!0),fr.set(_.access_token),gr.set(_.id_token),dr.set(_.profile)}),w.events.addUserUnloaded(function(){Ye.set(!1),gr.set(""),fr.set(""),dr.set({})}),w.events.addSilentRenewError(function(_){Be.set(`SilentRenewError: ${_.message}`)});let j=Promise.resolve(w);We(Zr,j);const k=new URLSearchParams(window.location.search);!k.has("error")&&!k.has("code")&&!p&&en(j);async function A(){const _=await j;if(k.has("error")&&Be.set(new Error(k.get("error_description"))),k.has("code")){const O=await _.signinCallback();let z=O&&O.state||{};const M=z&&z.targetUrl?z.targetUrl:window.location.pathname;z={...z,isRedirectCallback:!0},history.replaceState(z,"",M),Be.set(null)}else if(k.has("state")){const O=await _.signinCallback();console.log("oidc.signinCallback::response",O)}Qr.set(!1)}return Br(A),jr(rn),vt.$$set=_=>{"issuer"in _&&rt(0,C=_.issuer),"client_id"in _&&rt(1,m=_.client_id),"redirect_uri"in _&&rt(2,s=_.redirect_uri),"post_logout_redirect_uri"in _&&rt(3,u=_.post_logout_redirect_uri),"extraOptions"in _&&rt(4,o=_.extraOptions),"scope"in _&&rt(5,d=_.scope),"$$scope"in _&&rt(6,l=_.$$scope)},[C,m,s,u,o,d,l,P]}class ln extends Hr{constructor(_t){super(),Vr(this,_t,nn,Xr,Ir,{issuer:0,client_id:1,redirect_uri:2,post_logout_redirect_uri:3,extraOptions:4,scope:5})}}export{Zr as O,$r as a,tn as b,hn as c,ln as d,Qr as e,fr as f,Ye as i,cn as l,un as p,dr as u};
